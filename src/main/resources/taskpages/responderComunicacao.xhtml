<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:wi="http://www.itx.com.br/jsf"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a="http://richfaces.org/a4j"
      xmlns:s="http://jboss.org/schema/seam/taglib">
<h:head />
<h:body>
	<rich:collapsiblePanel header="#{eppmessages['comunicacao.comunicacao']}" switchType="client">
		<wi:outputText id="meioExpedicao" value="#{respostaComunicacaoAction.meioExpedicao.label}"
			label="#{eppmessages['comunicacao.meioExpedicao']}" />
		<wi:outputText id="prazoResposta" label="Prazo de Resposta"
			value="#{not empty respostaComunicacaoAction.prazoResposta ? respostaComunicacaoAction.prazoResposta : '-' }">
			<f:convertDateTime pattern="dd/MM/yyyy" />
		</wi:outputText>
		<h:form>
			<h:commandButton value="#{eppmessages['comunicacao.visualizarComunicacao']}" styleClass="buttons" 
				action="#{respostaComunicacaoAction.downloadComunicacao}" />
		</h:form>
		<s:div />
		<wi:dataTable id="documentosComunicacao" values="#{documentoComunicacaoList.list(10)}" bean="#{documentoComunicacaoList}"
			tableTitle="#{eppmessages['comunicacao.documentosComunicacao']}" showSearchForm="false" rowId="#{row.id}" hideOrder="true">
			<ui:define name="headerToolBar" />
			<ui:define name="toolBar">
				<h:form>
					<h:commandLink action="#{respostaComunicacaoAction.downloadDocumento(row)}"
  						rendered="#{not empty row.documentoBin.extensao}">
						<h:graphicImage url="#{wiSkin.imageFolder}/jbpm/down.gif" title="#{eppmessages['comunicacao.baixarDocumento']}"/>
					</h:commandLink>
					<a:commandLink rendered="#{empty row.documentoBin.extensao}"
						onclick="infox.openPopUp('doc#{row.documentoBin.id}', '#{pathResolver.contextPath}/Painel/documentoHTML.seam?idBin=#{row.documentoBin.id}','1024'); return false;">
						<h:graphicImage url="#{wiSkin.imageFolder}/jbpm/down.gif" title="#{eppmessages['comunicacao.baixarDocumento']}"/>
					</a:commandLink>
				</h:form>
			</ui:define>
			<wi:columnOutputText columnHeader="#{eppmessages['documentoProcesso.descricao']}" value="#{row.descricao}" />
			<wi:columnOutputText columnHeader="#{eppmessages['processoDocumento.classificacaoDocumento']}" value="#{row.classificacaoDocumento.descricao}" />
			<wi:columnOutputText columnHeader="#{eppmessages['processoDocumento.tamanho']}" value="#{row.documentoBin.sizeFormatado}" />
		</wi:dataTable>
	</rich:collapsiblePanel>
	<h:form rendered="#{respostaComunicacaoAction.possuiProcessoResposta}">
		<rich:collapsiblePanel header="#{eppmessages['comunicacao.editor']}" switchType="client" id="painelEditor">
			<ui:param name="minuta" 
				value="#{empty respostaComunicacaoAction.documentoEdicao.id or 
							respostaComunicacaoAction.documentoEdicao.documentoBin.minuta}" />
			<s:div>
				<wi:inputText id="descricao" value="#{respostaComunicacaoAction.documentoEdicao.descricao}"
					required="true" label="#{eppmessages['processo.anexarDocumentoDescricao']}" 
					readonly="#{not minuta}" disabled="#{not minuta}"/>
			</s:div>
			<wi:selectOneMenuEntity id="modeloDocumento" value="#{respostaComunicacaoAction.modeloDocumento}" 
				label="#{eppmessages['modeloDocumento.modeloDocumento']}"
				noSelectionLabel="[Selecione o modelo]" items="#{respostaComunicacaoAction.modelosDocumento}"
				readonly="#{not minuta}" disabled="#{not minuta}">
				<a:ajax event="change" render="respostaComunicacaoDiv" execute="@this" limitRender="true"
					listener="#{respostaComunicacaoAction.assignModeloDocumento}"/>
			</wi:selectOneMenuEntity>
			
			<s:div>
 				<wi:selectOneMenuEntity id="classificacao"
	  				label="#{eppmessages['processoDocumento.classificacaoDocumento']}"
		      		items="#{respostaComunicacaoAction.classificacoesEditor}"
		      		showLabelSelecione="true"
		      		required="true"
		      		value="#{respostaComunicacaoAction.documentoEdicao.classificacaoDocumento}"
		      		readonly="#{not minuta}"
   					disabled="#{not minuta}">
   					<a:ajax event="change"
      					render="tooltipComunicacao"
      					execute="@this"
      					limitRender="true" />
  				</wi:selectOneMenuEntity>
			</s:div>
					
			<s:div id="tooltipComunicacao">
		   		<s:div styleClass="tooltip-parent" style="width: 10px" 
		  			rendered="#{not empty respostaComunicacaoAction.documentoEdicao.classificacaoDocumento.observacao}">
		  		<h:graphicImage url="#{wiSkin.imageFolder}/help.gif" />
					<div class="epp-tooltip">
						<div class="tooltip-panel">
							<div><h:outputText value="Observação:"/></div>
							<h:outputText value="#{respostaComunicacaoAction.documentoEdicao.classificacaoDocumento.observacao}"/>
						</div>
					</div>
		   		</s:div>
			</s:div>
			<wi:selectBooleanRadio id="minuta" value="#{respostaComunicacaoAction.documentoEdicao.documentoBin.minuta}" 
				label="#{eppmessages['processoDocumentoBin.minuta']}" readonly="#{not minuta}" disabled="#{not minuta}"/>
			<s:div id="respostaComunicacaoDiv">
				<wi:editor id="respostaComunicacao" readonly="#{not minuta}" 
					value="#{respostaComunicacaoAction.documentoEdicao.documentoBin.modeloDocumento}" />
			</s:div>
			<wi:commandButton id="gravarResposta" action="respostaComunicacaoAction.gravarResposta" 
				value="#{eppmessages['crud.update']}" reRender="pageBodyDialogMessage, @form, respostasPanel, taskButtonsForm"
				rendered="#{minuta}"/>
			<wi:commandButton id="newDocumento" action="respostaComunicacaoAction.newDocumentoEdicao" 
				value="#{eppmessages['crud.new']}" reRender="pageBodyDialogMessage, @form" execute="@this"/>
		</rich:collapsiblePanel>
	</h:form>
	
	<h:form rendered="#{respostaComunicacaoAction.possuiProcessoResposta}">
		<rich:collapsiblePanel header="#{eppmessages['anexosProcesso.titleView']}" switchType="client">
			<wi:inputText id="descricaoAnexo" value="#{respostaComunicacaoAction.descricaoAnexo}"
				label="#{eppmessages['documentoProcesso.descricao']}" showRequired="true">
				<a:ajax event="change" execute="@this" limitRender="true" render="uploadDiv"/>
			</wi:inputText>
			<wi:selectOneMenuEntity id="classificacaoAnexo" label="#{eppmessages['processoDocumento.classificacaoDocumento']}"
		      	items="#{respostaComunicacaoAction.classificacoesAnexo}" showLabelSelecione="true"
		      	showRequired="true"	value="#{respostaComunicacaoAction.classificacaoAnexo}">
				<a:ajax event="change" execute="@this" limitRender="true" render="uploadDiv"/>
			</wi:selectOneMenuEntity>
			<s:div id="tooltipClassificacaoAnexo">
		   		<s:div styleClass="tooltip-parent" style="width: 10px" 
		  			rendered="#{not empty respostaComunicacaoAction.classificacaoAnexo.observacao}">
		  		<h:graphicImage url="#{wiSkin.imageFolder}/help.gif" />
					<div class="epp-tooltip">
						<div class="tooltip-panel">
							<div><h:outputText value="Observação:"/></div>
							<h:outputText value="#{respostaComunicacaoAction.classificacaoAnexo.observacao}"/>
						</div>
					</div>
		   		</s:div>
			</s:div>
			<s:div id="uploadDiv">
				<wi:fileUpload id="documentoResposta"
					reRender="pageBodyDialogMessage, @form"
					accept="#{respostaComunicacaoAction.classificacaoAnexo.acceptedTypes}"
					rendered="#{not empty respostaComunicacaoAction.classificacaoAnexo 
						and not empty respostaComunicacaoAction.descricaoAnexo
						and not empty respostaComunicacaoAction.classificacaoAnexo.extensaoArquivosList}" />
			</s:div>
			<s:div id="uploadButton">
				<wi:commandButton id="gravarResposta"
					action="respostaComunicacaoAction.gravarAnexoResposta"
					value="#{eppmessages['crud.update']}"
					reRender="pageBodyDialogMessage, @form, respostasPanel, taskButtonsForm"
					rendered="#{respostaComunicacaoAction.anexoValido}" />
			</s:div>
		</rich:collapsiblePanel>
	</h:form>
	
	<wi:assinaturaPopup id="assinaturaDocumentoPopup" afterRender="respostasPanel" />
	
	<wi:dataTable id="respostas" tableTitle="#{eppmessages['comunicacao.documentosResposta']}" bean="#{respostaComunicacaoList}"
		values="#{respostaComunicacaoList.list(10)}" rowId="#{row.id}" hideOrder="true"
		showGrid="#{respostaComunicacaoAction.possuiProcessoResposta}"
		showSearchForm="#{respostaComunicacaoAction.possuiProcessoResposta}">
		<ui:define name="searchForm">
			<wi:searchForm formId="respostasForm" searchReRender="respostasPanel, respostasSearchForm"
				clearReRender="respostasPanel, respostasSearchForm" formTitle="#{eppmessages['searchForm.title']}">
				<wi:inputText value="#{respostaComunicacaoList.entity.descricao}" label="#{eppmessages['documentoProcesso.descricao']}" />
			</wi:searchForm>
		</ui:define>
		<ui:define name="headerToolBar" />
		<ui:define name="toolBar">
			<h:form>
				<wi:toolBarAssinatura idDocumento="#{row.id}" idAssinatura="assinaturaDocumentoPopup"
			    	renderedLock="#{not empty row.documentoBin.assinaturas}" />
				<a:commandLink action="#{respostaComunicacaoAction.setDocumentoEdicao(row)}"
					render="painelEditor" rendered="#{empty row.documentoBin.extensao}">
					<h:graphicImage url="#{wiSkin.imageFolder}/view.png" title="#{eppmessages['button.selecionar']}"/>
				</a:commandLink>
				<h:commandLink action="#{respostaComunicacaoAction.downloadDocumento(row)}"
					rendered="#{not empty row.documentoBin.extensao}">
					<h:graphicImage url="#{wiSkin.imageFolder}/view.png" title="#{eppmessages['button.selecionar']}"/>
				</h:commandLink>
				<a:commandLink action="#{respostaComunicacaoAction.removerDocumento(row)}"
					render="respostasPanel, painelEditor, pageBodyDialogMessage, taskButtonsForm"
					onclick="return confirm('#{eppmessages['crud.confirmRemove']}')">
					<h:graphicImage url="#{wiSkin.imageFolder}/remove.png" title="#{eppmessages['crud.remove']}" />
				</a:commandLink>
			</h:form>
		</ui:define>
		<wi:columnOutputText columnHeader="#{eppmessages['documentoProcesso.descricao']}" value="#{row.descricao}" />
		<wi:columnOutputText columnHeader="#{eppmessages['processoDocumento.classificacaoDocumento']}" value="#{row.classificacaoDocumento.descricao}" />
		<wi:columnOutputText columnHeader="#{eppmessages['processoDocumento.tamanho']}" value="#{row.documentoBin.sizeFormatado}" />
	</wi:dataTable>
	
	<h:form id="taskButtonsForm">
		<s:div rendered="#{respostaComunicacaoAction.possuiResposta}">
			<ui:include src="/WEB-INF/xhtml/components/form/buttons/taskButtonsTaskPage.xhtml">
				<ui:param name="taskEndAction" value="respostaComunicacaoAction.endTask" />
			</ui:include>
		</s:div>
	</h:form>
</h:body>
</html>