<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:infox="http://www.infox.com.br/jsf"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/core/defaultTemplate.xhtml">
    <ui:define name="title">#{messages['estrutura.titlePage']}</ui:define>
    <ui:param
        name="home"
        value="#{estruturaCrudAction}" />
    <ui:define name="searchGrid">
        <wi:dataTable
            values="#{estruturaList.list(15)}"
            bean="#{estruturaList}"
            tableTitle="#{messages['estrutura.tableTitle']}"
            id="estruturaList"
            rowId="#{row.id}">
            <ui:define name="searchForm">
                <wi:searchForm
                    formId="pesquisarEstruturaForm"
                    formTitle="#{messages['searchForm.title']}">
                    <wi:inputText
                        id="nome"
                        value="#{estruturaList.entity.nome}"
                        label="#{messages['estrutura.nome']}" />
                    <wi:selectSituacaoOneMenu
                        id="ativo"
                        label="#{messages['field.situacao']}"
                        value="#{estruturaList.entity.ativo}" />
                </wi:searchForm>
            </ui:define>
            <wi:columnOutputText
                columnId="nome"
                columnHeader="#{messages['estrutura.nome']}"
                value="#{row.nome}" />
            <wi:columnSituacao
                columnId="ativo"
                columnHeader="#{messages['field.situacao']}"
                value="#{row.ativo}" />
        </wi:dataTable>
    </ui:define>
    <ui:define name="form">
        <wi:dataForm
            formId="estruturaForm"
            formTitle="#{messages['form.title']}">
            <wi:inputText
                id="nome"
                required="true"
                label="#{messages['estrutura.nome']}"
                value="#{estruturaCrudAction.instance.nome}" />
            <wi:selectSituacaoRadio
                id="ativo"
                label="#{messages['field.situacao']}"
                value="#{estruturaCrudAction.instance.ativo}" />
        </wi:dataForm>
    </ui:define>
    <ui:define name="tabs">
        <infox:tab id="localizacoesTab" name="localizacoesTab" title="#{messages['estrutura.localizacoesFilhas']}"
            rendered="#{estruturaCrudAction.managed}" action="#{estruturaCrudAction.novaLocalizacao()}">
            <wi:dataForm formId="localizacoesForm" formTitle="#{messages['form.title']}">
                 <wi:inputText
                    id="localizacao"
                    required="true"
                    label="#{messages['localizacao.localizacao']}"
                    value="#{estruturaCrudAction.localizacaoFilho.localizacao}" />
                <wi:tree
                    id="localizacaoPai"
                    assignTo="estruturaCrudAction.localizacaoFilho.localizacaoPai"
                    tree="#{localizacoesDaEstruturaTree}"
                    icon="#{a4jSkin.imgFolder}/nivelTree.gif"
                    iconLeaf="#{a4jSkin.imgFolder}/file.gif"
                    label="#{messages['localizacao.localizacaoPai']}" />
                 <wi:selectSituacaoRadio
                    columnId="ativoLocalizacao"
                    label="#{messages['field.situacao']}"
                    value="#{estruturaCrudAction.localizacaoFilho.ativo}" />
                 
                 <ui:define name="buttons">
                     <wi:commandButton rendered="#{not empty estruturaCrudAction.localizacaoFilho.idLocalizacao}" execute="@this" 
                        reRender="localizacoesTab, pageBodyDialogMessage" action="estruturaCrudAction.novaLocalizacao"
                        value="#{messages['crud.new']}" id="newLocalizacaoButton"/>
                     
                     <wi:commandButton rendered="#{empty estruturaCrudAction.localizacaoFilho.idLocalizacao}" 
                        reRender="localizacoesTab, pageBodyDialogMessage" action="estruturaCrudAction.adicionarLocalizacao"
                        id="persistLocalizacaoButton" value="#{messages['crud.persist']}"/>
                        
                     <wi:commandButton rendered="#{not empty estruturaCrudAction.localizacaoFilho.idLocalizacao}" 
                        reRender="localizacoesTab, pageBodyDialogMessage" action="estruturaCrudAction.atualizarLocalizacao"
                        id="updateLocalizacaoButton" value="#{messages['crud.update']}"/>
                 </ui:define>
             </wi:dataForm>                        
             <wi:dataTable id="localizacoesList" values="#{localizacaoComEstruturaList.list(5)}" 
                bean="#{localizacaoComEstruturaList}" rowId="#{row.idLocalizacao}"
                tableTitle="#{messages['estrutura.localizacoesFilhas']}" panelStyleClass="rf-dt-crud">
                <ui:define name="headerToolBar" />
                <ui:define name="toolBar">
                    <wi:toolBar url="#{a4jSkin.imgFolder}/view.gif" title="#{messages['button.selecionar']}" id="toolBarEdit" 
                        action="#{estruturaCrudAction.setLocalizacaoFilho(row)}" render="localizacoesTab, pageBodyDialogMessage"/>
                    <wi:toolBar url="#{a4jSkin.imgFolder}/remove.png" title="#{messages['button.inactive']}" id="toolBarInactive"
                        action="#{estruturaCrudAction.inativarLocalizacao(row)}" render="localizacoesTab, pageBodyDialogMessage"
                        onclick="return confirm('#{messages['estrutura.confirmaRemocaoLocalizacao']}')"
                        rendered="#{row.ativo}"/>
                </ui:define>
                <wi:columnOutputText id="caminhoCompleto" value="#{estruturaCrudAction.formatCaminhoCompleto(row)}" 
                    columnHeader="#{messages['localizacao.localizacao']}" styleClass="rf-tr" hideOrder="true"/>
             </wi:dataTable>
        </infox:tab>
        <infox:tab id="visaoHierarquicaTab" name="visaoHierarquicaTab" title="#{messages['estrutura.visaoHierarquica']}"
            rendered="#{estruturaCrudAction.managed}" action="#{estruturaCrudAction.novaLocalizacao()}">
            <h:form>
                <rich:tree data="#{item}" selectionType="ajax" render="@form, pageBodyDialogMessage"
                      var="item" selectionChangeListener="#{estruturaLocalizacaoTree.processTreeSelectionChange}">
                      <rich:treeModelRecursiveAdaptor roots="#{estruturaLocalizacaoTree.roots}" nodes="#{item.nodes}">
                        <rich:treeNode>
                            <h:outputText styleClass="#{not item.entity.ativo ? 'tree-inactive' : ''}" value="#{item.entity}" />
                        </rich:treeNode>
                      </rich:treeModelRecursiveAdaptor>
                </rich:tree>
            </h:form>
        </infox:tab>
    </ui:define>
</ui:composition>
