<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:wi="http://www.itx.com.br/jsf" xmlns:p="http://primefaces.org/ui"
	xmlns:i="http://java.sun.com/jsf/composite/infox"
	template="/WEB-INF/xhtml/templates/core/menuTemplate.xhtml"
	xmlns:infox="http://www.infox.com.br/jsf">

	<ui:define name="title">#{infoxMessages['redistribuicao.label']}</ui:define>
	<ui:param name="home" value="#{redistribuicaoList}" />
	<ui:param name="inForm" value="true" />

	<ui:define name="body">
		<a:region>
			<infox:div id="formulario">
				<h:form id="redistribuicaoListForm">
					<wi:dataTable id="redistribuicaoList"
						values="#{redistribuicaoList.list(10)}"
						bean="#{redistribuicaoList}" rowId="#{row.idProcesso}"
						tableTitle="#{infoxMessages['redistribuicao.label']}"
						showToolbarColumn="false">
						<ui:define name="headerToolBar" />

						<ui:define name="searchForm">
							<wi:searchForm formId="redistribuicaoSearchForm"
								formTitle="#{infoxMessages['searchForm.title']}"
								searchAction="#{redistribuicaoList.limparSelecionados()}">
								<i:selectOneMenu
									label="#{infoxMessages['redistribuicao.natureza']}"
									value="#{redistribuicaoList.natureza}"
									items="#{redistribuicaoList.naturezas}"
									selectStyle="max-width: 260px;"
									converterId="br.com.infox.jsf.converter.EntityConverter" />
								<i:selectOneMenu
									label="#{infoxMessages['redistribuicao.categoria']}"
									value="#{redistribuicaoList.categoria}"
									items="#{redistribuicaoList.categorias}"
									selectStyle="max-width: 260px;"
									converterId="br.com.infox.jsf.converter.EntityConverter" />
								<i:selectOneMenu
									label="#{infoxMessages['redistribuicao.tipoProcesso']}"
									value="#{redistribuicaoList.tipoProcesso}"
									items="#{redistribuicaoList.tiposProcessos}"
									selectStyle="max-width: 260px;"
									converterId="br.com.infox.jsf.converter.EntityConverter" />
								<c:forEach items="#{redistribuicaoList.extensaoFiltrosRedistribuicao}" var="extensao">
                                    <ui:include src="#{extensao}" />
                                </c:forEach>
								<i:selectOneMenu
									label="#{infoxMessages['redistribuicao.relator']}"
									value="#{redistribuicaoList.relatorAtual}"
									items="#{redistribuicaoList.relatores}"
									selectStyle="max-width: 260px;"
									converterId="br.com.infox.jsf.converter.EntityConverter" />
								<i:selectOneMenu
									label="#{infoxMessages['redistribuicao.udm']}"
									value="#{redistribuicaoList.udmFiltro}"
									items="#{redistribuicaoList.udmsFiltro}"
									selectStyle="max-width: 260px;"
									converterId="br.com.infox.jsf.converter.EntityConverter" 
									rendered="#{not authenticator.usuarioLogadoInMonocratica}"/>
							</wi:searchForm>
						</ui:define>

						<rich:column id="checkboxColumn">
							<f:facet name="header">
								<h:selectBooleanCheckbox onclick="checkAllChildrenBoxes();"
									styleClass="checkButtonMarcarTodos" />
							</f:facet>
							<h:selectBooleanCheckbox
								value="#{redistribuicaoList.processosSelecionados[row]}"
								onclick="updateMarcarTodos($(this));"
								styleClass="checkButtonProcesso">
							</h:selectBooleanCheckbox>
						</rich:column>

						<wi:columnOutputText columnId="relator"
							columnHeader="#{infoxMessages['redistribuicao.relator']}"
							value="#{empty row.getMetadado('relator') ? '-' : row.getMetadado('relator')}" />

						<wi:columnOutputText columnId="natureza"
							columnHeader="#{infoxMessages['redistribuicao.natureza']}"
							value="#{row.naturezaCategoriaFluxo.natureza}" />

						<wi:columnOutputText columnId="categoria"
							columnHeader="#{infoxMessages['redistribuicao.categoria']}"
							value="#{row.naturezaCategoriaFluxo.categoria}" />

						<wi:columnOutputText columnId="tipoProcesso"
							columnHeader="#{infoxMessages['redistribuicao.tipoProcesso']}"
							value="#{row.naturezaCategoriaFluxo.fluxo}" />

						<wi:column columnId="variaveisFluxo" hideOrder="true"
							columnHeader="#{infoxMessages['redistribuicao.variaveisFluxo']}">
							<ui:repeat var="variavel"
								value="#{redistribuicaoList.getVariaveis(row)}">
								<p style="text-align: justify; margin: 2px">
									<h:outputText style="font-weight: bolder"
										rendered="#{not empty(variavel)}" value="#{variavel.label}:" />
									<h:outputText value=" #{variavel.valor}" />
								</p>
							</ui:repeat>
						</wi:column>
						<ui:define name="conteudoAdicional">
							<infox:div id="conteudoAdicionalDiv" style="margin: 1em 0em;">
								<fieldset>
									<legend>#{infoxMessages['redistribuicao.redistribuir']}</legend>
                                    <i:selectOneMenu
                                        label="#{infoxMessages['redistribuicao.udm']}"
                                        value="#{redistribuicaoList.novaUdm}"
                                        items="#{redistribuicaoList.udms}"
										converterId="org.jboss.seam.ui.EntityConverter"
                                        ajax="true" execute="@this" render="@form:panelRelator" immediate="true"
                                        required="true" />

                                    <h:panelGroup id="panelRelator">
    									<i:selectOneMenu rendered="#{not empty redistribuicaoList.novaUdm}"
    										label="#{infoxMessages['redistribuicao.relator']}"
    										value="#{redistribuicaoList.novoRelator}"
    										items="#{redistribuicaoList.relatores}"
                                            itemLabel="#{item eq redistribuicaoList.novaUdm.chefeGabinete ? item.toString().concat(' (Titular)') : item}"
    										converterId="br.com.infox.jsf.converter.EntityConverter"
    										required="true"/>
                                    </h:panelGroup>

									<i:selectOneMenu
										label="#{infoxMessages['redistribuicao.tipo']}"
										value="#{redistribuicaoList.tipoRedistribuicao}"
										items="#{redistribuicaoList.tiposRedistribuicao}"
										converterId="br.com.infox.jsf.converter.EntityConverter"
										required="true" />
									<div>
										<i:inputTextarea id="motivoRedistribuicao"
											label="#{infoxMessages['redistribuicao.motivo']}"
											value="#{redistribuicaoList.motivoRedistribuicao}" cols="50"
											showCounter="false" required="true" />
									</div>
								</fieldset>
								<div>
									<a:commandButton id="botaoRedistribuirTodosFiltrados" styleClass="buttons"
										action="#{redistribuicaoList.redistribuirTodos}"
										value="#{infoxMessages['redistribuicao.redistribuirTodos']}"
										onclick="return confirm('#{infoxMessages['redistribuicao.confirmRedistribuir']}');"
										onbegin="showLoading();" oncomplete="hideLoading();"
										execute="formulario" render="formulario pageBodyDialogMessage" />
									<a:commandButton action="#{redistribuicaoList.redistribuir}"
										styleClass="buttons"
										onclick="showLoading();"
										oncomplete="hideLoading();"										
										value="#{infoxMessages['redistribuicao.redistribuirSelecionados']}"
										execute="formulario" render="formulario pageBodyDialogMessage"
										id="botaoRedistribuir" />
									<a:commandButton id="clearButtonRedistribuir"
										onclick="showLoading();"
										oncomplete="hideLoading();"
										action="#{redistribuicaoList.limparCamposRedistribuir()}"
										value="#{infoxMessages['button.limpar']}" execute="conteudoAdicionalDiv"
										render="conteudoAdicionalDiv"
										styleClass="buttons" />

								</div>
							</infox:div>
						</ui:define>
					</wi:dataTable>

				</h:form>
			</infox:div>


		</a:region>
		<script>
		    function checkAllChildrenBoxes(){
		        $('.checkButtonProcesso').prop('checked',$('.checkButtonMarcarTodos').prop('checked'));
		    }
		    
		    function desmarcarMarcarTodos(){
		        $('.checkButtonMarcarTodos').prop('checked',false);
		    }
		    
		    function updateMarcarTodos(checkBox){
		        if(!checkBox.prop('checked')){
		            $('.checkButtonMarcarTodos').prop('checked',false);
		        }else{
		            $('.checkButtonMarcarTodos').prop('checked',isTodosCheckBoxesMarcados());
		        }
		    }
		    function isTodosCheckBoxesMarcados(){
		        checkButtonsArray = $('.checkButtonProcesso');
		        if(!checkButtonsArray)
		            return false;
		
		        for (var i = 0; i &lt; checkButtonsArray.size(); i++) {
		            if(!$(checkButtonsArray[i]).prop('checked'))
		                return false;
		        }
		            return true;
		    }
		</script>
	</ui:define>



</ui:composition>
