<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/template.xhtml">

    <ui:define name="body">

        <s:div id="pagina">

            <wi:dataTable rowKeyVar="key" id="collectionTable" var="row"
                panelWidth="99%" showToolbarColumn="false"
                showGridCount="false" tableTitle="#{eppmessages['quartz.titlePage']}"
                panelStyleClass="full-sized short-margin-top"
                values="#{quartzJobsInfo.detailJobsInfo}">

                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.triggerName']}</f:facet>
                    <h:outputText value="#{row.triggerName}" />
                </rich:column>

                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.jobName']}</f:facet>
                    <h:outputText value="#{row.jobName}" />
                </rich:column>

                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.cronExpression']}</f:facet>
                    <h:outputText value="#{row.cronExpression}" />
                </rich:column>

                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.previousFireTime']}</f:facet>
                    <h:outputText value="#{row.previousFireTime}">
                        <s:convertDateTime pattern="dd/MM/yy kk:mm:ss" />
                    </h:outputText>
                </rich:column>

                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.nextFireTime']}</f:facet>
                    <h:outputText value="#{row.nextFireTime}">
                        <s:convertDateTime pattern="dd/MM/yy kk:mm:ss" />
                    </h:outputText>
                </rich:column>


                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.jobExpression']}</f:facet>
                    <h:outputText value="#{row.jobExpression}" />
                </rich:column>

                <rich:column>
                    <f:facet name="header">#{eppmessages['quartz.validJob']}</f:facet>
                    <h:outputText value="#{row.jobValid ? 'Sim' : 'Não'}" />
                </rich:column>

                <rich:column
                    rendered="#{s:hasRole('admin') or s:hasRole('administrador')}">
                    <h:form>
                        <h:commandLink value="#{eppmessages['button.execute']}"
                            action="#{quartzJobsInfo.triggerJob(row.jobName, row.groupName)}"
                            rendered="#{row.jobValid}" />
                    </h:form>
                    <h:form>
                        <h:commandLink
                            value="#{eppmessages['button.delete']}"
                            action="#{quartzJobsInfo.deleteJob(row.jobName, row.groupName, row.triggerName)}" />
                    </h:form>
                </rich:column>
            </wi:dataTable>

            <h:form>
                <wi:commandButton id="btAtualizar" reRender="pagina"
                    value="Atualizar Página" />
                <wi:commandButton
                    rendered="#{(s:hasRole('admin') or s:hasRole('administrador')) and not producao}"
                    id="btApagarJobs" reRender="pagina"
                    action="#{quartzJobsInfo.apagarJobs()}"
                    value="#{eppmessages['quartz.deleteAllJobs']}" />

            </h:form>
        </s:div>

    </ui:define>
</ui:composition>
