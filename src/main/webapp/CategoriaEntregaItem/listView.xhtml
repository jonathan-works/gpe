<?xml version="1.0" encoding="UTF-8"?>

<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets" xmlns="http://www.w3.org/1999/xhtml"
    xmlns:wi="http://www.itx.com.br/jsf" xmlns:h="http://java.sun.com/jsf/html"
    xmlns:infox="http://www.infox.com.br/jsf" xmlns:p="http://primefaces.org/ui"
    xmlns:rich="http://richfaces.org/rich" xmlns:c="http://java.sun.com/jsp/jstl/core"
    template="/WEB-INF/xhtml/templates/core/menuTemplate.xhtml">
    <ui:define name="title">Categorias de Entrega</ui:define>
    <ui:define name="body">
        <p:calendar style="display:none" />
        <infox:div id="categoriaEntregaItem">
            <h:form>
                <p:remoteCommand name="editarItem" process="@this" update="@form:@parent:formFields :pageBodyDialogMessage" async="true" 
                actionListener="#{categoriaEntregaView.editarItem}"
                onstart="infox.showLoading();" oncomplete="infox.hideLoading();"/>
                <p:remoteCommand name="editarCategoria" process="@this" update="@form:@parent:formFields :pageBodyDialogMessage" async="true" 
                actionListener="#{categoriaEntregaView.editarCategoria}"
                onstart="infox.showLoading();" oncomplete="infox.hideLoading();"/>
                
                <p:remoteCommand name="criarItem" process="@this" update="@form:@parent:formFields :pageBodyDialogMessage" onstart="infox.showLoading();"
                    actionListener="#{categoriaEntregaView.criarItem}" oncomplete="infox.hideLoading();" />
                <p:remoteCommand name="criarCategoria" process="@this" update="@form:@parent:formFields :pageBodyDialogMessage" onstart="infox.showLoading();"
                    actionListener="#{categoriaEntregaView.criarCategoria}" oncomplete="infox.hideLoading();" />
                <p:remoteCommand name="removerItem" process="@this" update="@parent:@parent :pageBodyDialogMessage"
                    onstart="infox.showLoading();" actionListener="#{categoriaEntregaView.removerItem}" oncomplete="infox.hideLoading();" />
                <p:remoteCommand name="removerCategoria" process="@this" update="@parent:@parent :pageBodyDialogMessage"
                    onstart="infox.showLoading();" actionListener="#{categoriaEntregaView.removerCategoria}" oncomplete="infox.hideLoading();" />
                <p:remoteCommand name="configurarModeloEntrega" process="@this" update="@form:@parent :pageBodyDialogMessage"
                    onstart="infox.showLoading();" actionListener="#{categoriaEntregaView.configurarModeloEntrega}" oncomplete="infox.hideLoading();" />
                <p:remoteCommand name="refreshCategoriaEntregaForm" actionListener="#{categoriaEntregaView.clear}" process="@this" update="@form:@parent" onstart="infox.showLoading" oncomplete="infox.hideLoading();" />
            </h:form>
            <infox:div style="display:inline-block;vertical-align:top;" rendered="#{'configEntregaForm.xhtml' ne categoriaEntregaView.view}">
            <div>
                <h:commandButton type="button" styleClass="buttons" onclick="criarCategoria([{name:'path',value:'/'}])" value="Criar Categoria" />
            </div>
            <ui:include src="groupedItemsTree.xhtml">
                <ui:param name="id" value="componente" />
                <ui:param name="config"
                    value="{
                       path: '#{facesContext.externalContext.requestContextPath}/rest',
                       headers: {},
                       groupDelimiter: 'categoria',
                       itemDelimiter: 'item',
                       url: '#{facesContext.externalContext.requestContextPath}/rest'
                    }" />
                <ui:param name="itemToolBar" value="[
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','edit')}', title:'Editar Item', onSelect:(itm)=>editarItem([{name:'path',value:itm}])},
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','add')}', title:'Adicionar Categoria', onSelect:(itm)=>criarCategoria([{name:'path',value:itm}])},
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','remove')}', title:'Remover Item', onSelect:(itm)=>confirm('Certeza?') &amp;&amp; removerItem([{name:'path',value:itm}])},
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','settings')}', title:'Configurar Entrega de Documentos', onSelect:(itm)=>configurarModeloEntrega([{name:'path',value:itm}])}
                ]" />
                <ui:param name="groupToolBar" value="[
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','edit')}', title:'Editar Categoria', onSelect:(itm)=>editarCategoria([{name:'path',value:itm}])},
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','add')}', title:'Adicionar Item', onSelect:(itm)=>criarItem([{name:'path',value:itm}])},
                    {icon:'#{layoutController.getMaterialDesignIconUrl('1x','black','18dp','remove')}', title:'Remover Categoria', onSelect:(itm)=>confirm('Certeza?') &amp;&amp; removerCategoria([{name:'path',value:itm}])}
                ]"
                />
            </ui:include>
            </infox:div>
            
            <infox:div id="formFields" style="display:inline-block;vertical-align:top;">
                <c:if test="#{not empty categoriaEntregaView.view}">
                    <ui:include src="forms/#{categoriaEntregaView.view}" />
                </c:if>
            </infox:div>
        </infox:div>
    </ui:define>
</ui:composition>
