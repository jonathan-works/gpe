<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    xmlns:p="http://primefaces.org/ui"
    xmlns:i="http://java.sun.com/jsf/composite/infox"
    template="/WEB-INF/xhtml/templates/core/menuTemplate.xhtml">
    
    <ui:define name="title">#{infoxMessages['processo.titlePage']}</ui:define>
    
    <ui:define name="body">
    
        <h:form>
        
	        <p:dataTable id="natCatProcessoList" var="row" value="#{iniciarProcessoView.naturezaCategoriaFluxoItemList}" 
	        	selection="#{iniciarProcessoView.naturezaCategoriaFluxoItem}" rowKey="#{row.id}" 
	        	headerText="Classificação do processo" responsive="true" >
	        	
	        	<p:column selectionMode="single" style="width:16px; text-align:center"/>
	        	
	        	<p:column headerText="#{infoxMessages['naturezaCategoriaFluxo.fluxo']}">
		            <h:outputText value="#{row.naturezaCategoriaFluxo.fluxo}" />
		        </p:column>
		        
		        <p:column headerText="#{infoxMessages['naturezaCategoriaFluxo.natureza']}">
		            <h:outputText value="#{row.naturezaCategoriaFluxo.natureza}" />
		        </p:column>
		        
		        <p:column headerText="#{infoxMessages['naturezaCategoriaFluxo.categoria']}">
		            <h:outputText value="#{row.naturezaCategoriaFluxo.categoria}" />
		        </p:column>
		        
		        <p:column headerText="#{infoxMessages['categoriaItem.item']}">
		            <h:outputText value="#{empty row.item ? '-' : row.item}" />
		        </p:column>
	        </p:dataTable>
	        
	        <p:fieldset id="panelAdicionarParticipante" legend="Adicionar Participante" toggleable="true" 
	        	toggleSpeed="300" collapsed="true" style="margin-top: 1.5em;">
	        
		        <i:selectOneRadio id="radioTipoPessoa"	label="#{infoxMessages['pessoa.tipoPessoa']}"
		           	items="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa.values()}" 
		           	value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa}" 
		           	ajax="true" listener="#{iniciarProcessoView.onChangeTipoPessoa}" itemLabel="#{item.label}" 
		           	render="@form:loadedByParticipante" style="margin-top: 0.8em;"/>
	          
		        <p:outputPanel id="loadedByParticipante">
		          		
		       		<i:inputCpf id="cpf" label="#{infoxMessages['pessoaFisica.cpf']}"
		                value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.codigo}"
		                required="true" rendered="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa eq 'F'}" 
		                ajax="true" render="@form:loadedByParticipante" listener="#{iniciarProcessoView.onChangeParticipanteCpf}" />
		            
		            <i:inputCnpj id="cnpj" label="#{infoxMessages['pessoaJuridica.cnpj']}"
		                value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.codigo}"
		                required="true" rendered="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa eq 'J'}"
		                ajax="true" render="@form:nome @form:razao" listener="#{iniciarProcessoView.onChangeParticipanteCnpj}" />
		            
		            <i:inputText id="nome" value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.nome}"
		                label="#{participantesController.tipoPessoa eq 'F' ? infoxMessages['pessoaFisica.nome'] : infoxMessages['pessoaJuridica.nomeFantasia']}" 
		                required="true" />
		             
		            <i:inputEmail id="email" label="#{infoxMessages['pessoaFisica.email']}" 
		            	value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.email}"
		            	rendered="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa eq 'F'}" 
		            	disabled="#{iniciarProcessoView.iniciarProcessoParticipanteVO.meioContatoLoaded}"
		            	required="false" />
		            	
		            <i:inputText id="razao"
		                value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.razaoSocial}"
		                label="#{infoxMessages['pessoaJuridica.razaoSocial']}" required="true" 
		                rendered="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa eq 'J'}" 
		                disabled="#{iniciarProcessoView.iniciarProcessoParticipanteVO.pessoaLoaded}"/>
		                
		            <wi:inputDate id="dataNascimento" label="#{infoxMessages['pessoaFisica.dataNascimento']}"
		                value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.dataNascimento}"
		                rendered="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoPessoa eq 'F'}"
		                disabled="#{iniciarProcessoView.iniciarProcessoParticipanteVO.pessoaLoaded}"
		                required="false" />
		                
		            <wi:selectOneMenuEntity id="tipoPartes" label="#{infoxMessages['participanteProcesso.tipoParticipante']}"
						items="#{iniciarProcessoView.tipoParteList}" required="true" showLabelSelecione="true"
						value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.tipoParte}" />
					
				    <p:tree id="participanteSuperior" value="#{iniciarProcessoView.root}" var="node" 
				    	label="#{infoxMessages['participanteProcesso.superior']}" rendered="false">
				        <p:treeNode>
				            <h:outputText value="#{node}" />
				        </p:treeNode>
				    </p:tree>
						
					<wi:inputDate id="dataInicio"
						value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.dataInicio}"
						label="#{infoxMessages['participanteProcesso.dataInicioParticipacao']}"
						required="false" />
							
					<wi:inputDate id="dataFim"
						value="#{iniciarProcessoView.iniciarProcessoParticipanteVO.dataFim}"
						label="#{infoxMessages['participanteProcesso.dataFimParticipacao']}" 
						required="false"/>
						
		        </p:outputPanel>
		        
		        <div>
		         	<h:commandButton value="Adicionar Parte" action="#{iniciarProcessoView.adicionarParticipante}" styleClass="buttons">
		         		<p:ajax process="@form:panelAdicionarParticipante" update="@form:loadedByParticipante @form:participanteList" partialSubmit="true" />
		         	</h:commandButton>
		        </div>
		        
	        </p:fieldset>
	        
		    <p:dataTable id="participanteList" var="row" value="#{iniciarProcessoView.participanteProcessoList}" 
	        	rowKey="#{row.id}" headerText="Participantes do Processo" responsive="true" style="margin-top: 1.5em;"
	        	emptyMessage="Sem participantes.">
	        	
	        	<p:column style="width:16px; text-align:center" >
        			<h:commandLink onclick="return confirm('Tem certeza?');" action="#{iniciarProcessoView.removerParticipante(row)}">
        				<p:ajax update="participanteList" process="participanteList" partialSubmit="true" />
        				<h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/remove.png')}" title="#{infoxMessages['crud.remove']}" />
        			</h:commandLink>
	        	</p:column>
	        	
	        	<p:column headerText="#{infoxMessages['participanteProcesso.nomeParticipante']}" style="text-align:center">
	        		<ui:param name="qnt" value="#{wi:splitLength(row.caminhoAbsoluto, '\\|')}" />
		            <h:outputText value="#{row.nome}" 
		            	style="#{qnt eq 1 ? 'font-weight: bold' : ''}; padding-left:#{1.25 * (qnt-1)}em; display:block; text-align:left;"/>
		        </p:column>
		        
		        <p:column headerText="#{infoxMessages['participanteProcesso.codigo']}" style="text-align:center">
		            <h:outputText value="#{row.codigoFormatado}" />
		        </p:column>
		        
		        <p:column headerText="#{infoxMessages['participanteProcesso.tipoParticipante']}" style="text-align:center">
		            <h:outputText value="#{row.tipoParte}" />
		        </p:column>
	            
	            <p:column headerText="#{infoxMessages['participanteProcesso.dataInicio']}" style="text-align:center">
		            <h:outputText value="#{row.dataInicio}" >
		            	<f:convertDateTime patter="dd/MM/yyyy"/>
		            </h:outputText>
		        </p:column>
		        
		        <p:column headerText="#{infoxMessages['participanteProcesso.dataFim']}" style="text-align:center">
		            <h:outputText value="#{row.dataFim}" >
		            	<f:convertDateTime patter="dd/MM/yyyy"/>
		            </h:outputText>
		        </p:column>
	            	
	        </p:dataTable>
        
	        <div style="margin-top: 1.5em;">
	        	<h:commandButton id="buttonIniciarProcesso" value="Iniciar Processo" action="#{iniciarProcessoView.iniciarProcesso}" styleClass="buttons">
	        		<p:ajax update="@this :pageBodyDialogMessage" process="@form:natCatProcessoList @this" partialSubmit="true"/>
	        	</h:commandButton>
	        </div>
	       
	    </h:form>
		
    </ui:define>
</ui:composition>
