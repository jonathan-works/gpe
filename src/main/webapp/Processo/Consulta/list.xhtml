<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:f="http://java.sun.com/jsf/core" 
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:infox="http://www.infox.com.br/jsf"
  template="/WEB-INF/xhtml/templates/core/defaultTemplate.xhtml" >
  
  <ui:define name="title">#{infoxMessages['consultaProcesso.titlePage']}</ui:define>
  
  <ui:define name="body">
  	<c:if test="#{not empty flash.idProcesso}">
  		<c:set value="#{flash.idProcesso}" target="#{consultaController}" property="id" ></c:set>
  		<c:set value="#{flash.idJbpm}"  target="#{org.jboss.seam.bpm.businessProcess}" property="processId"  ></c:set>
  		<c:set value="#{flash.showBackButton}"  target="#{consultaController}" property="showBackButton"  ></c:set>
  	</c:if>
    <rich:collapsiblePanel
      switchType="client"
      header="#{infoxMessages['processo.titleView']} #{consultaController.processo.numeroProcessoRoot}"
      expanded="false">
      <h:panelGrid
        columns="3"
        width="100%"
        columnClasses="viewColumn">
        <wi:outputText
          id="dataInicio"
          label="#{infoxMessages['processo.dataInicio']}"
          value="#{consultaController.processo.dataInicio}">
          <f:convertDateTime pattern="dd/MM/yyyy kk:mm" />
        </wi:outputText>
        <wi:outputText
          id="usuarioCadastro"
          label="#{infoxMessages['processo.usuarioCadastroProcesso']}"
          value="#{consultaController.processo.usuarioCadastro}" />
       <ui:repeat var="metadado" value="#{consultaController.detalhesMetadados}" >
     		<wi:outputText id="metadado#{metadado.metadadoType}"
	           	label="#{metadadoMessages[metadado.metadadoType]}"
	           	value="#{metadado}" rendered="#{metadado.classType.canonicalName ne 'java.util.Date'}"/>
	        <wi:outputText id="metadado#{metadado.metadadoType}Date"
	           	label="#{metadadoMessages[metadado.metadadoType]}"
	           	value="#{metadado.value}" rendered="#{metadado.classType.canonicalName eq 'java.util.Date'}">
				<f:convertDateTime pattern="dd/MM/yyyy kk:mm" />
			</wi:outputText>
       </ui:repeat>
    </h:panelGrid>
    </rich:collapsiblePanel>
    <infox:tabPanel
      headerSpacing="2"
      activeTab="#{consultaController.tab}"
      id="consultaProcessoTabPanel">
      <h:form>
        <infox:tabHeaders />
      </h:form>
      <infox:tab
        id="tabAnexos"
        name="tabAnexos"
        immediate="true"
        actionListener="#{documentoProcessoAction.onClickDocumentosTab()}"
        status=":status"
        title="#{infoxMessages['processo.documentos']}">
		<ui:include src="/Processo/pastaDocumento.xhtml">
			<ui:param name="pastaDocumentoRenderId" value="consultaProcessoTabPanel" />
		</ui:include>	
      </infox:tab>
      <infox:tab
        id="tabPartesDoProcesso"
        name="tabPartesDoProcesso"
        immediate="true"
        status=":status"
        rendered="#{processoHandler.hasPartes()}"
                title="#{infoxMessages['participanteProcesso.participantes']}"
                action="#{participanteProcessoList.entity.setProcesso(consultaController.processo)}">
        <ui:include src="/Processo/parteProcessoGridRO.xhtml" />
      </infox:tab>
      <infox:tab
        id="tabAnexar"
        name="tabAnexar"
        immediate="true"
        status=":status"
        title="#{infoxMessages['processoDocumento.anexarDocumento']}"
        rendered="#{empty consultaController.processo.dataFim}"
        action="#{anexoController.onClickTabAnexar(consultaController.processo)}">
        <wi:ajaxDiv id="divAnexarDocumentos">
            <ui:include src="consultarAbaAnexar.xhtml" />
        </wi:ajaxDiv>
      </infox:tab>
      <infox:tab
        id="form"
        name="form"
        immediate="true"
        status=":status"
        title="#{infoxMessages['acaoProcesso.menuText']}">
        <ui:include
          src="/WEB-INF/xhtml/components/grid/movimentacoesProcessoGrid.xhtml" />
      </infox:tab>
      <infox:tab
        id="documentoFisicoTab"
        name="documentoFisicoTab"
        action="#{localizacaoDocumentoFisicoCrudAction.setProcesso(consultaController.processo)}"
        title="#{infoxMessages['documentoFisico.titleTab']}">
        <ui:decorate
          id="frameDecorate"
          template="../../WEB-INF/xhtml/templates/core/include/frame.xhtml">
          <ui:define name="title">#{infoxMessages['documentoFisico.titleTab']}</ui:define>
          <ui:include src="/Processo/documentoFisico.xhtml" />
        </ui:decorate>
      </infox:tab>
      <infox:tab
        id="tabPastaRestricao"
        name="tabPastaRestricao"
        status=":status"
        title="#{infoxMessages['pasta.pastaRestricaoTab']}"
        rendered="#{security.checkPage('/pages/Processo/abaPastaRestricao')}">
        <ui:decorate
          id="frameDecorate"
          template="../../WEB-INF/xhtml/templates/core/include/frame.xhtml">
          <ui:define name="title">#{infoxMessages['pasta.pastaRestricaoTab']}</ui:define>
          <ui:include src="../pastaRestricao.xhtml" />
        </ui:decorate>
      </infox:tab>
      <ui:include src="/Processo/Consulta/abasCustomizadasDoDetalheDoProcesso.xhtml"/>
      <div>
              <wi:commandButton
              	id="btnVoltar" rendered="#{consultaController.showBackButton}"
                onclick="infox.redirect({url:'#{pathResolver.contextPath}/Processo/Consulta/listView.seam'})"
                value="#{infoxMessages['page.return']}" />
      </div>
    </infox:tabPanel>

  </ui:define>
</ui:composition>
