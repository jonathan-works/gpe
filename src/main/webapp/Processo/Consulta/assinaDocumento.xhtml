<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j" xmlns:wi="http://www.itx.com.br/jsf"
	template="/WEB-INF/xhtml/templates/core/baseTemplate.xhtml">
	<ui:define name="baseBody">
		<s:div id="pageBody" styleClass="pageBody">
			<wi:messages formId="pageBody" globalOnly="true" />
			<ui:param name="isBinario"
				value="#{assinadorDocumento.documentoBin.isBinario()}" />
			<script>
            var documento= {
                    useBase64:function useBase64() {
                        return 'true';
                    },
                    hasSignature:function hasSignature() {
                        return #{rich:jQuery("signature")}.val() != ''
                    },
                    postValidate:function postValidate() {
                        try {
                            submitForm();
                        }catch(e){
                        }
                    }
            };
        </script>
			<rich:panel id="painel">
				<f:facet name="header">Informações: </f:facet>
				<f:view form="#{processoDocumentoView}" columns="1"
					title="Documento" opened="false" />
				<s:div rendered="#{not assinadorDocumento.signed}"
					id="certificadoDigitalDiv">
					<div id="divApplet">
						<wi:certificadoDigital id="certificacao"
							urlDownloadFile="#{pathResolver.urlProject}/downloadCaList.seam"
							formId="formValidar"
							certificationChainField="#{assinadorDocumento.certChain}"
							signatureField="#{assinadorDocumento.signature}"
							signableData="#{assinadorDocumento.documentoBin.md5Documento}"
							functionPreSign="showLoading()"
							functionPosSign="hideLoading();documento.postValidate();"
							debug="false" loginMode="false" useProviderDll="false">
						</wi:certificadoDigital>
					</div>
					<h:form id="formValidar">
						<a:jsFunction name="submitForm"
							action="#{assinadorDocumento.assinarDocumento()}"
							oncomplete="if (!event.data) close(); if(#{assinadorDocumento.signed}){ opener.location.reload(); }"
							execute="@form" data="#{assinadorDocumento.houveErroAoAssinar}"
							render="painel, pageBodyDialogMessage" />

					</h:form>
				</s:div>
			</rich:panel>
		</s:div>
	</ui:define>
</ui:composition>