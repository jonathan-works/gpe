<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j">
  <rich:collapsiblePanel
    id="pastaPanel"
    switchType="client"
    expanded="false"
    header="#{infoxMessages['pasta.pastas']}">
    <rich:list value="#{pastaAction.pastaList}"
      styleClass="folder-ul"
      rowClass="folder-li"
      var="pasta">
      <h:graphicImage
        url="#{wiSkin.imageFolder}/folder.png"
        rendered="true"
        title="#{pasta}" />
      <h:outputText value="#{eventCache.get('pastaAction.getNomePasta(pasta)', pasta.id)}" class="folder" />
    </rich:list>
    <wi:commandButton
      id="addPastaBtn"
      value="#{infoxMessages['documentoProcesso.addFolder']}"
      rendered="#{s:hasPermission('/pages/Pasta/adicionarPasta', 'access')}"
      onclick="#{rich:component('anexarPastaPanel')}.show();" />
  </rich:collapsiblePanel>
  <br />
  <rich:collapsiblePanel
  	id="editorPanel"
    switchType="client"
    expanded="#{documentoEditor.expanded}"
    header="#{infoxMessages['documentoEditor.header']}">
    <s:div id="editorDiv">
      <ui:param name="minuta" 
      	value="#{empty documentoEditor.documento.id or documentoEditor.documento.documentoBin.minuta}" />
      <s:div>
        <wi:inputText
          id="#{f.id}inputProcessoDocumento"
          value="#{documentoEditor.documento.descricao}"
          disabled="#{not minuta}"
          readonly="#{not minuta}"
          required="true"
          label="#{infoxMessages['processo.anexarDocumentoDescricao']}">
        </wi:inputText>
        <wi:selectOneMenuEntity
          id="#{f.id}tipoProcessoDocumento"
          label="#{infoxMessages['tipoProcessoDocumento.tipoProcessoDocumento']}"
          value="#{documentoEditor.documento.classificacaoDocumento}"
          items="#{classificacaoDocumentoFacade.getUseableClassificacaoDocumento(false)}"
          required="true"
          disabled="#{not minuta}"
          readonly="#{not minuta}"
          showLabelSelecione="true">
          <a:ajax event="change" status=":status" limitRender="true" 
          		  render=":movimentarTabPanel:anexarDocumentosForm:editorToolTipDiv" execute="@this"/>
        </wi:selectOneMenuEntity>
        <wi:selectOneMenuEntity
            id="pastaDocumentoEditor"
            label="#{infoxMessages['pasta.pasta']}"
            value="#{documentoEditor.pasta}"
            items="#{pastaAction.pastaList}"
            required="true"
            rendered="#{s:hasPermission('/pages/Pasta/moverDocumento', 'access')}"
            showLabelSelecione="false">
            <a:ajax
                event="change"
                limitRender="true"
                status=":status"
                onbeforesubmit="infox.showLoading();"
                oncomplete="infox.hideLoading();"
                execute="@this"/>
        </wi:selectOneMenuEntity>
      </s:div>
      <s:div id="tipoDocumentoDiv">
      	<s:div id="editorToolTipDiv" styleClass="tooltip-parent" style="width: 10px" 
		  	rendered="true">
		  	<h:graphicImage id="#{id}helpEditTipImg" url="#{wiSkin.imageFolder}/help.gif" />
			<div class="epp-tooltip">
				<div class="tooltip-panel">
					<div><h:outputText value="Observação:"/></div>
					<h:outputText value="#{documentoEditor.documento.classificacaoDocumento.observacao}"/>
				</div>
			</div>
	    </s:div>
	    <s:div>
	    	<wi:selectBooleanRadio id="minuta" value="#{documentoEditor.documento.documentoBin.minuta}" 
				label="#{infoxMessages['processoDocumentoBin.minuta']}" readonly="#{not minuta}" disabled="#{not minuta}"/>
		</s:div>
        <wi:editor
          id="modeloDocumento"
          label="#{infoxMessages['tipoProcessoDocumento.modelo']}"
          value="#{documentoEditor.documento.documentoBin.modeloDocumento}"
          requiredField="false"
          required="true"
          readonly="#{not minuta}"
          showVariables="false">
        </wi:editor>
      </s:div>
      <s:div id="buttonsDiv">
        <wi:commandButton
          id="botaoAnexarDocumento"
          action="documentoEditor.persist()"
          value="#{infoxMessages['processo.anexarDocumentoBtn']}"
          execute="editorDiv"
          rendered="#{minuta}"
          reRender="@form,pageBodyDialogMessage, buttonsDiv"
          styleClass="buttons">
        </wi:commandButton>
        <wi:commandButton
          id="botaoNovo"
          action="documentoEditor.newInstance()"
          value="#{infoxMessages['crud.new']}"
          execute="editorDiv"
          rendered="#{minuta}"
          reRender="@form,pageBodyDialogMessage, buttonsDiv"
          styleClass="buttons">
        </wi:commandButton>
      </s:div>
    </s:div>
  </rich:collapsiblePanel>
  <br />
  <rich:collapsiblePanel
    switchType="client"
    expanded="true"
    header="#{infoxMessages['fileUpload.header']}">
    <s:div id="uploaderDiv">
      <div>
        <wi:inputText
          id="inputProcessoDocumentoPdf"
          value="#{documentoUploader.documento.descricao}"
          disabled="false"
          required="true"
          label="#{infoxMessages['processo.anexarDocumentoDescricao']}">
          <a:ajax
            event="change"
            limitRender="true"
            status=":status"
            onbeforesubmit="infox.showLoading();"
            oncomplete="infox.hideLoading();"
            listener="#{documentoUploader.podeRenderizar}"
            execute="@this" />
        </wi:inputText>
        <wi:selectOneMenuEntity
          id="tipoProcessoDocumentoPdf"
          label="#{infoxMessages['tipoProcessoDocumento.tipoProcessoDocumento']}"
          value="#{documentoUploader.classificacaoDocumento}"
          items="#{classificacaoDocumentoFacade.getUseableClassificacaoDocumento(false)}"
          required="true"
          showLabelSelecione="true">
          <a:ajax
            event="change"
            onbeforesubmit="infox.showLoading();"
            oncomplete="infox.hideLoading();"
            limitRender="true"
            render="tipoDocumentoDivPdf buttonsPdfDiv"
            listener="#{documentoUploader.onChangeClassificacaoDocumento}"
            status=":status"
            execute="@this" />
        </wi:selectOneMenuEntity>
        <wi:selectOneMenuEntity
            id="pastaDocumentoUploader"
            label="#{infoxMessages['pasta.pasta']}"
            value="#{documentoUploader.pasta}"
            items="#{pastaAction.pastaList}"
            required="false"
            rendered="#{s:hasPermission('/pages/Pasta/moverDocumento', 'access')}"
            showLabelSelecione="false">
            <a:ajax
                event="change"
                limitRender="true"
                status=":status"
                onbeforesubmit="infox.showLoading();"
                oncomplete="infox.hideLoading();"
                listener="#{documentoUploader.podeRenderizar}"
                execute="@this"/>
        </wi:selectOneMenuEntity>
      </div>
      <s:div id="tipoDocumentoDivPdf">
        <wi:fileUpload
          id="uploadArquivo"
          label="#{infoxMessages['fileUpload.type.file']}"
          reRender="buttonsPdfDiv #{f.id}tipoProcessoDocumentoPdf"
          rendered="#{not empty documentoUploader.classificacaoDocumento and not empty documentoUploader.classificacaoDocumento.extensaoArquivosList and not empty documentoUploader.documento.descricao}"
          accept="#{documentoUploader.documento.classificacaoDocumento.acceptedTypes}">
        </wi:fileUpload>
      </s:div>
      <s:div id="buttonsPdfDiv">
        <wi:commandButton
          id="botaoAnexarDocumentoPdf"
          action="documentoUploader.persist()"
          value="#{infoxMessages['processo.anexarDocumentoBtn']}"
          execute="#{f.id}inputProcessoDocumentoPdf, #{f.id}tipoProcessoDocumentoPdf"
          reRender="@form"
          styleClass="buttons"
          rendered="#{documentoUploader.valido}">
        </wi:commandButton>
      </s:div>
    </s:div>
  </rich:collapsiblePanel>
  <br />
  <s:div id="documentosRedigidosDaSessao">
    <wi:dataTable
      values="#{documentoEditor.documentosDaSessao}"
      tableTitle="#{infoxMessages['documentoEditor.titleView']}"
      id="processoDocumentoDaSessao"
      rowId="#{row.idDocumento}"
      showSearchForm="false"
      panelStyleClass="full-sized">
      <wi:columnOutputText
        columnId="usuarioInclusao"
        columnHeader="#{infoxMessages['processoDocumento.usuarioInclusao']}"
        hideOrder="true"
        value="#{row.usuarioInclusao}" />
      <wi:columnDateTime
        columnId="dataInclusao"
        columnHeader="#{infoxMessages['processoDocumento.dataInclusao']}"
        hideOrder="true"
        value="#{row.dataInclusao}" />
      <wi:columnOutputText
        columnId="documento"
        columnHeader="#{infoxMessages['processoDocumentoBin.documento']}"
        hideOrder="true"
        value="#{row.descricao}" />
      <ui:define name="headerToolBar" />
      <ui:define name="toolBar">
      	<h:form rendered="#{row.documentoBin.minuta}">
      		<a:commandLink action="#{documentoEditor.setDocumento(row)}" render="editorPanel" limitRender="true">
      			<h:graphicImage url="#{wiSkin.imageFolder}/view.png" title="#{infoxMessages['button.selecionar']}" />
      		</a:commandLink>
      	</h:form>
      </ui:define>
    </wi:dataTable>
  </s:div>
  <br />
  <s:div id="documentosDaSessao">
    <wi:dataTable
      showSearchForm="false"
      values="#{documentoUploader.documentosDaSessao}"
      tableTitle="#{infoxMessages['documentoUploader.titleView']}"
      id="documentoDaSessao"
      rowId="#{row.id}"
      panelStyleClass="full-sized"
      showToolbarColumn="false">
      <wi:columnOutputText
        columnId="usuarioInclusao"
        columnHeader="#{infoxMessages['processoDocumento.usuarioInclusao']}"
        hideOrder="true"
        value="#{row.usuarioInclusao}" />
      <wi:columnDateTime
        columnId="dataInclusao"
        columnHeader="#{infoxMessages['processoDocumento.dataInclusao']}"
        hideOrder="true"
        value="#{row.dataInclusao}" />
      <wi:columnOutputText
        columnId="documento"
        columnHeader="#{infoxMessages['processoDocumentoBin.documento']}"
        hideOrder="true"
        value="#{row.descricao}" />
      <ui:define name="headerToolBar" />
      <ui:define name="toolBar" />
    </wi:dataTable>
  </s:div>
  
  <script type="text/javascript">
      function clearAnexarPastaFields() {
    		#{rich:jQuery('anexarPastaInputName')}.val('');
    		#{rich:jQuery('anexarPastaInputName')}.val('');
    		#{rich:jQuery('anexarPastaInputVisivelExterno')}.prop('checked', false);
    		#{rich:jQuery('anexarPastaInputVisivelNaoParticipante')}.prop('checked', false);
    		$('.errorFields.errors').remove();
    	    $('.errors').removeClass('errors');
      }
  </script>
  
  <rich:popupPanel
    id="anexarPastaPanel"
    moveable="true"
    show="false"
    resizeable="false"
    minWidth="310"
    minHeight="260"
    header="#{infoxMessages['pasta.add']}"
    onbeforehide="clearAnexarPastaFields();">
    <f:facet name="controls">
      <h:graphicImage
        id="pastaPanelCloseBtn"
        styleClass="mp-close"
        value="#{wiSkin.imageFolder}/closeMP.gif"
        onmouseup="#{rich:component('anexarPastaPanel')}.hide();" />
      </f:facet>
      <h:form id="anexarPastaForm">
        <wi:inputText
          id="anexarPastaInputName"
          value="#{pastaAction.nome}"
          required="true"
          maxLength="100"
          label="#{infoxMessages['pasta.nome']}">
        </wi:inputText>
        <wi:selectBooleanCheckbox
          id="anexarPastaInputVisivelExterno"
          value="#{pastaAction.visivelExterno}"
          required="true"
          onclick="#{rich:jQuery('anexarPastaInputVisivelExterno')}.prop('checked') ? #{rich:jQuery('anexarPastaDivVisivelNaoParticipante')}.show() : #{rich:jQuery('anexarPastaDivVisivelNaoParticipante')}.hide();"
          label="#{infoxMessages['pasta.usuarioExterno']}" />
        <s:div id="anexarPastaDivVisivelNaoParticipante" style="display: none">
          <wi:selectBooleanCheckbox
            id="anexarPastaInputVisivelNaoParticipante"
            value="#{pastaAction.visivelNaoParticipante}"
            required="true"
            label="#{infoxMessages['usuarioParticipante']}" />
        </s:div>
        <wi:commandButton
          id="addPastaButton"
          action="#{pastaAction.persist()}"
          execute="@form"
          oncomplete="if(#{not facesContext.validationFailed}){#{rich:component('anexarPastaPanel')}.hide();}else{clearAnexarPastaFields()}"
          value="Adicionar"
          reRender="@form, pastaPanel, pageBodyDialogMessage, pastaDocumentoUploader, pastaDocumentoEditor" />
      </h:form>
    </rich:popupPanel>
</ui:composition>