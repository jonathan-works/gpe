<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    xmlns:infox="http://www.infox.com.br/jsf"
    template="/WEB-INF/xhtml/templates/minimal.xhtml">
    <ui:param
        name="pageTitle"
        value="#{eppmessages['processo.titlePage']}" />
    <ui:define name="title">#{pageTitle}</ui:define>
    <ui:param
        name="home"
        value="#{processoEpaHome}" />
    <ui:param
        name="showMenu"
        value="false" />
    <ui:param
        name="checkPermission"
        value="#{processoEpaHome.checarVisibilidade()}" />
    <ui:define name="body">
        <h:form>
            <a:jsFunction
                name="renderButtons"
                render="taskButtonsDiv" />
        </h:form>
        <rich:collapsiblePanel
            switchType="client"
            header="#{eppmessages['processo.titleView']} #{processoEpaHome.instance.numeroProcesso}"
            expanded="false">
            <h:panelGrid
                columns="2"
                width="100%"
                columnClasses="viewColumn">
                <wi:outputText
                    id="dataInicio"
                    label="#{eppmessages['processo.dataInicio']}"
                    value="#{processoEpaHome.instance.dataInicio}">
                    <f:convertDateTime pattern="dd/MM/yyyy kk:mm" />
                </wi:outputText>
                <wi:outputText
                    id="usuarioCadastroProcesso"
                    label="#{eppmessages['processo.usuarioCadastroProcesso']}"
                    value="#{processoEpaHome.instance.usuarioCadastroProcesso}" />
            </h:panelGrid>
        </rich:collapsiblePanel>
        <infox:tabPanel
            switchType="ajax"
            rendered="#{checkPermission}"
            activeTab="#{home.tab}"
            id="visualizarProcessoTabPanel">
            <h:form>
                <infox:tabHeaders />
            </h:form>
            <infox:tab
                id="tabEntrada"
                name="tabEntrada"
                rendered="#{!empty taskInstanceView.fields}"
                status=":status"
                title="#{eppmessages['movimentar.entrada.titleTab']}">
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['movimentar.entrada.titleTab']}</ui:define>
                    <wi:form
                        canEdit="true"
                        formTitle="#{taskInstance.name}"
                        home="#{taskInstanceHome}"
                        form="#{taskInstanceView}" />
                </ui:decorate>
            </infox:tab>
            <infox:tab
                id="tabMovimentacoes"
                name="tabMovimentacoes"
                rendered="#{processoEpaHome.managed}"
                status=":status"
                title="#{eppmessages['acaoProcesso.menuText']}">
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['acaoProcesso.menuText']}</ui:define>
                    <ui:include
                        src="/WEB-INF/xhtml/components/grid/movimentacoesProcessoGrid.xhtml" />
                </ui:decorate>
            </infox:tab>
            <infox:tab
                id="tabAnexos"
                name="tabAnexos"
                rendered="#{processoEpaHome.managed}"
                status=":status"
                action="#{documentoList.entity.setProcesso(processoEpaHome.instance)}"
                actionListener="#{documentoProcessoAction.onClickDocumentosTab()}"
                title="#{eppmessages['processo.documentos']}">
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['processo.documentos']}</ui:define>
                    <a:jsFunction name="selectDocumento" immediate="true"
						execute="@this" render="historicoDocumentoPanelDiv" limitRender="true" status=":status">
						<a:param name="idDocumento" assignTo="#{documentoProcessoAction.idDocumento}" converter="javax.faces.Integer"/>
					</a:jsFunction>
                    <wi:dataTable
                        values="#{documentoList.list(15)}"
                        bean="#{documentoList}"
                        tableTitle="#{eppmessages['processo.documentos']} #{home.instance}"
                        id="documentoList"
                        rowId="#{row.id}"
                        searchFormStyleClass="hidden"
                        panelStyleCss="full-sized">
                        <ui:define name="headerToolBar" />
                        <wi:columnOutputText
                        	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                            columnId="numeroDocumento"
                            columnHeader="#{eppmessages['processoDocumento.numeroDocumento']}"
                            value="#{row.numeroDocumento}" />
                        <wi:columnOutputText
                        	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                            columnId="usuarioInclusao"
                            columnHeader="#{eppmessages['processoDocumento.usuarioInclusao']}"
                            value="#{row.usuarioInclusao}" />
                        <wi:columnDateTime
                        	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                            columnId="dataInclusao"
                            columnHeader="#{eppmessages['processoDocumento.dataInclusao']}"
                            value="#{row.dataInclusao}" />
                        <wi:columnOutputText
                        	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                            columnId="descricao"
                            columnHeader="#{eppmessages['processoDocumentoBin.documento']}"
                            value="#{row.descricao}" />
                        <ui:define name="toolBar">
                        	<h:graphicImage styleClass="opacityHover" url="#{a4jSkin.imgFolder}/view.png" 
                       		            title="#{eppmessages['button.historico']}" 
                       		            rendered="#{documentoProcessoAction.hasHistoricoDocumento(rowId) and documentoProcessoAction.podeUsuarioVerHistorico()}"
                       		            onmouseup="selectDocumento(#{rowId});"/>
                        </ui:define>
                    </wi:dataTable>
                    
                    <s:div id="historicoDocumentoPanelDiv" style="margin-top:20px; width:100%;">
		                <rich:panel id="historicoDocumentoPanel" headerClass=""
		                			rendered="#{not empty documentoProcessoAction.processoDocumentoSelected}"
		                			bodyClass="dtable-p-b" styleClass="dtable-p" style="width:100%;" >
		                			
		                	<f:facet name="header">
		                		<h:outputText value="#{eppmessages['historicoStatusDocumento.tableTile']}" />
		                		<h:graphicImage value="#{a4jSkin.imgFolder}/closeMP.gif" onmouseup="selectDocumento(0);" style="float:right;"/>
				        	</f:facet>
				        	
						  	<rich:dataTable id="historicoDocumentoDataTable"
						  			var="historicoDocumento" style="width:100%"
						  			value="#{documentoProcessoAction.listHistoricoStatusDocumento}">
						  			
						  		<rich:column style="text-align:center;">
						  			<f:facet name="header">#{eppmessages['historicoStatusDocumento.nomeUsuarioAlterou']}</f:facet>
						  			<h:outputText value="#{historicoDocumento.usuarioAlteracao.nomeUsuario}" />
						  		</rich:column>
						  		
						  		<rich:column style="text-align:center;">
						  			<f:facet name="header">#{eppmessages['historicoStatusDocumento.dataAlteracao']}</f:facet>
						  			<h:outputText value="#{historicoDocumento.dataAlteracao}">
						  				<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
						  			</h:outputText>
						  		</rich:column>
						  		
						  		<rich:column style="text-align:center;">
						  			<f:facet name="header">Tipo Operação</f:facet>
						  			<h:outputText value="#{historicoDocumento.tipoAlteracaoDocumento.label}" />
						  		</rich:column>
						  		
						  		<rich:column>
						  			<f:facet name="header">#{eppmessages['historicoStatusDocumento.motivo']}</f:facet>
						  			<h:outputText value="#{historicoDocumento.motivo}" />
						  		</rich:column>
						  		
						  	</rich:dataTable>              
		                </rich:panel>
	                 </s:div>
                </ui:decorate>
            </infox:tab>
            <ui:param
                name="action"
                value="#{localizacaoDocumentoFisicoCrudAction}" />
            <infox:tab
                id="documentoFisicoTab"
                name="documentoFisicoTab"
                rendered="#{home.isManaged()}"
                action="#{localizacaoDocumentoFisicoCrudAction.setProcesso(processoEpaHome.instance)}"
                title="#{eppmessages['documentoFisico.titleTab']}">
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['documentoFisico.titleTab']}</ui:define>
                    <s:div id="documentoFisicoDiv">
                        <wi:dataTable
                            id="documentoFisicoTable"
                            values="#{localizacaoDocumentoFisicoCrudAction.documentoFisicoList}"
                            var="row"
                            rows="10"
                            searchFormStyleClass="hidden">
                            <ui:define name="toolBar" />
                            <ui:define name="headerToolBar" />
                            <wi:columnOutputText
                                columnId="localizacaoFisica"
                                columnHeader="#{eppmessages['documentoFisico.localizacaoFisica']}"
                                value="#{row.localizacaoFisica.caminhoCompletoToString()}"
                                hideOrder="true" />
                            <wi:columnOutputText
                                columnId="descricao"
                                columnHeader="#{eppmessages['documentoFisico.descricaoDocumentoFisico']}"
                                value="#{row.descricaoDocumentoFisico}"
                                hideOrder="true" />
                        </wi:dataTable>
                    </s:div>
                </ui:decorate>
            </infox:tab>
            <infox:tab
                id="tabPartesDoProcesso"
                name="tabPartesDoProcesso"
                status=":status"
                rendered="#{home.hasPartes()}"
                action="#{parteProcessoList.entity.setProcesso(home.instance)}"
                title="#{eppmessages['parteProcesso.partes']}">
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['parteProcesso.partes']}</ui:define>
                    <ui:include src="parteProcessoGridRO.xhtml" />
                </ui:decorate>
            </infox:tab>
            <infox:tab
                id="tabSigiloProcesso"
                name="tabSigiloProcesso"
                status=":status"
                title="#{eppmessages['sigiloProcesso.sigiloProcesso']}"
                rendered="#{s:hasPermission('/pages/Processo/abaSigiloProcesso', 'access')}">
                <f:setPropertyActionListener
                    target="#{sigiloProcessoAction.processo}"
                    value="#{processoEpaHome.instance}" />
                <f:setPropertyActionListener
                    target="#{sigiloProcessoList.processo}"
                    value="#{processoEpaHome.instance}" />
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['sigiloProcesso.sigiloProcesso']}</ui:define>
                    <ui:include src="sigiloProcesso.xhtml" />
                </ui:decorate>
            </infox:tab>
            <infox:tab
                id="tabSigiloDocumento"
                name="tabSigiloDocumento"
                status=":status"
                title="#{eppmessages['sigiloDocumento.sigiloDocumento']}"
                rendered="#{s:hasPermission('/pages/Processo/abaSigiloDocumento', 'access')}">
                <f:setPropertyActionListener
                    target="#{sigiloDocumentoAction.processo}"
                    value="#{processoEpaHome.instance}" />
                <f:setPropertyActionListener
                    target="#{documentoAnexoList.processo}"
                    value="#{processoEpaHome.instance}" />
                <ui:decorate
                    id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{eppmessages['sigiloDocumento.sigiloDocumento']}</ui:define>
                    <ui:include src="sigiloDocumento.xhtml" />
                </ui:decorate>
            </infox:tab>
        </infox:tabPanel>
        <c:if test="#{!checkPermission}">
            <wi:outputText
                id="error"
                value="#{eppmessages['movimentar.noPermission']}" />
        </c:if>
    </ui:define>
</ui:composition>