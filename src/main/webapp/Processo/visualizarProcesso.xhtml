<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    xmlns:infox="http://www.infox.com.br/jsf"
    template="/WEB-INF/xhtml/templates/minimal.xhtml">

    <ui:param name="pageTitle" value="#{messages['processo.titlePage']}" />
    <ui:define name="title">#{pageTitle}</ui:define>

    <ui:param name="home" value="#{processoHome}" />
    <ui:param name="showMenu" value="false" />
    <ui:param name="checkPermission"
        value="#{processoHome.checarVisibilidade()}" />
    <ui:define name="head">
        <h:outputStylesheet library="styleSkinInfox"
            name="movimentar.css" />
    </ui:define>
    <ui:define name="body">

        <h:form>
            <a:jsFunction name="renderButtons" render="taskButtonsDiv" />
        </h:form>

        <infox:tabPanel switchType="ajax" rendered="#{checkPermission}"
            activeTab="#{home.tab}" id="visualizarProcessoTabPanel">
            <h:form>
                <infox:tabHeaders />
            </h:form>

            <infox:tab id="tabFluxo" name="tabFluxo"
                rendered="#{!processoHome.managed}" status=":status"
                title="Escolher fluxo" action="#{processoHome.limpar()}">
                <h:messages id="globalMessages" globalOnly="true"
                    styleClass="message" />
            </infox:tab>

            <infox:tab id="tabEntrada" name="tabEntrada"
                rendered="#{!empty taskInstanceView.fields}"
                status=":status" title="Entrada">
                <ui:decorate id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">Entrada</ui:define>
                    <wi:form canEdit="true"
                        formTitle="#{taskInstance.name}"
                        home="#{taskInstanceHome}"
                        form="#{taskInstanceView}" />
                </ui:decorate>
            </infox:tab>

            <infox:tab id="tabAnexos" name="tabAnexos"
                rendered="#{processoHome.managed}" status=":status"
                action="#{processoDocumentoList.entity.setProcesso(processoHome.instance)}"
                title="Documentos do Processo">
                <ui:decorate id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">Documentos do Processo</ui:define>
                    <wi:dataTable
                        values="#{processoDocumentoList.list(15)}"
                        bean="#{processoDocumentoList}"
                        tableTitle="#{messages['processo.documentos']} #{home.instance}"
                        id="processoDocumentoList"
                        rowId="#{row.idProcessoDocumento}"
                        searchFormStyleClass="hidden">

                        <ui:define name="headerToolBar" />
                        <wi:columnOutputText columnId="usuarioInclusao"
                            columnHeader="#{messages['processoDocumento.usuarioInclusao']}"
                            value="#{row.usuarioInclusao}" />
                        <wi:columnDateTime columnId="dataInclusao"
                            columnHeader="#{messages['processoDocumento.dataInclusao']}"
                            value="#{row.dataInclusao}" />
                        <wi:columnOutputText
                            columnId="processoDocumentoBin"
                            columnHeader="#{messages['processoDocumentoBin.documento']}"
                            value="#{row.processoDocumentoBin}" />
                        <ui:define name="toolBar" />

                    </wi:dataTable>

                </ui:decorate>

            </infox:tab>

            <infox:tab id="tabMovimentacoes" name="tabMovimentacoes"
                rendered="#{processoHome.managed}" status=":status"
                title="Movimentações do Processo">
                <ui:decorate id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">Movimentações do Processo</ui:define>
                    <ui:include
                        src="/WEB-INF/xhtml/components/grid/movimentacoesProcessoGrid.xhtml" />
                </ui:decorate>
            </infox:tab>

            <ui:param name="action"
                value="#{localizacaoDocumentoFisicoCrudAction}" />
            <infox:tab id="documentoFisicoTab" name="documentoFisicoTab"
                rendered="#{home.isManaged()}"
                action="#{localizacaoDocumentoFisicoCrudAction.setProcesso(processoHome.instance)}"
                title="#{messages['documentoFisico.titleTab']}">
                <ui:decorate id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{messages['documentoFisico.titleTab']}</ui:define>
                    <s:div id="documentoFisicoDiv">
                        <wi:dataTable id="documentoFisicoTable"
                            values="#{localizacaoDocumentoFisicoCrudAction.documentoFisicoList}"
                            var="row" rows="10"
                            searchFormStyleClass="hidden">
                            <ui:define name="toolBar" />
                            <ui:define name="headerToolBar" />
                            <wi:columnOutputText
                                columnId="localizacaoFisica"
                                columnHeader="#{messages['documentoFisico.localizacaoFisica']}"
                                value="#{row.localizacaoFisica.caminhoCompletoToString()}"
                                hideOrder="true" />
                            <wi:columnOutputText columnId="descricao"
                                columnHeader="#{messages['documentoFisico.descricaoDocumentoFisico']}"
                                value="#{row.descricaoDocumentoFisico}"
                                hideOrder="true" />
                        </wi:dataTable>
                    </s:div>
                </ui:decorate>
            </infox:tab>

            <infox:tab id="tabPartesDoProcesso"
                name="tabPartesDoProcesso" status=":status"
                rendered="#{home.hasPartes()}"
                action="#{parteProcessoList.entity.setProcesso(home.instance)}"
                title="#{messages['parteProcesso.partes']}">
                <ui:decorate id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{messages['parteProcesso.partes']}</ui:define>
                    <ui:include src="parteProcessoGridRO.xhtml" />
                </ui:decorate>
            </infox:tab>

            <infox:tab id="tabSigiloProcesso" name="tabSigiloProcesso"
                status=":status"
                title="#{messages['sigiloProcesso.sigiloProcesso']}"
                action="#{usuarioRaiaList.loadLocalizacoes(processoHome.instance.naturezaCategoriaFluxo.fluxo)}"
                rendered="#{s:hasPermission('/pages/Processo/abaSigiloProcesso', 'access')}">

                <f:setPropertyActionListener
                    target="#{sigiloProcessoAction.processo}"
                    value="#{processoHome.instance}" />
                <f:setPropertyActionListener
                    target="#{sigiloProcessoList.processo}"
                    value="#{processoHome.instance}" />

                <ui:decorate id="frameDecorate"
                    template="../WEB-INF/xhtml/templates/core/include/frame.xhtml">
                    <ui:define name="title">#{messages['sigiloProcesso.sigiloProcesso']}</ui:define>
                    <ui:include src="sigiloProcesso.xhtml" />
                </ui:decorate>
            </infox:tab>

        </infox:tabPanel>

        <c:if test="#{!checkPermission}">
            <wi:outputText id="error"
                value="#{messages['movimentar.noPermission']}" />
        </c:if>

    </ui:define>
</ui:composition>