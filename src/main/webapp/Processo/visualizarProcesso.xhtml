<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/cleanTemplate.xhtml">

    <!--
	  IBPM - Ferramenta de produtividade Java
	  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
	 
	  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
	  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
	  Free Software Foundation; versão 2 da Licença.
	  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
	  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
	  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
	  
	  Consulte a GNU GPL para mais detalhes.
	  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
	  veja em http://www.gnu.org/licenses/  
	-->

    <ui:param
        name="pageTitle"
        value="#{messages['processo.titlePage']}" />
    <ui:define name="title">#{pageTitle}</ui:define>

    <ui:param
        name="home"
        value="#{processoHome}" />
    <ui:param
        name="showMenu"
        value="false" />
    <ui:param
        name="checkPermission"
        value="#{processoHome.checarVisibilidade()}" />

    <ui:define name="body">
        <s:div id="script">
            <f:verbatim>
                <script type="text/javascript">
		    	function verifyFields() { 
		        	var taskCompleted = "#{util.getFromEventContext('taskCompleted')}";
		        	if(taskCompleted != '') {
			        	try {
		        			opener.atualizaPainelFluxo();
			        	} catch(e) {}
			        	var canClosePanel = "#{util.getFromEventContext('canClosePanel')}";
			        	if(canClosePanel != '') {
			        		window.close();
			        	} else {
			        		location = location.href;
			        	}
		        	} else {
		        		hideLoading();
		        	}
		    	}
		    </script>
            </f:verbatim>
        </s:div>
        <style>
.positionImg {
	top: 63px;
}

.propertyView {
	min-width: 150px
}
</style>

        <h:form>
            <a:jsFunction
                name="renderButtons"
                render="taskButtonsDiv" />
        </h:form>
        <h:form>
            <rich:tabPanel
                switchType="ajax"
                activeItem="#{home.tab}"
                rendered="#{checkPermission}">
                <rich:tab
                    id="tabFluxo"
                    rendered="#{!processoHome.managed}"
                    header="Escolher fluxo"
                    status=":status"
                    immediate="true"
                    action="#{processoHome.limpar()}">
                    <h:messages
                        id="globalMessages"
                        globalOnly="true"
                        styleClass="message" />
                </rich:tab>

                <rich:tab
                    id="tabEntrada"
                    rendered="#{!empty taskInstanceView.fields}"
                    header="Entrada"
                    immediate="true"
                    status=":status">
                    <s:div id="divDocAnterior">
                        <wi:form
                            canEdit="true"
                            formTitle="#{taskInstance.name}"
                            home="#{taskInstanceHome}"
                            form="#{taskInstanceView}" />
                    </s:div>
                </rich:tab>

                <rich:tab
                    id="tabSaida"
                    rendered="#{processoHome.managed}"
                    header="Saída"
                    status=":status"
                    immediate="true">
                    <c:if test="#{empty taskPageAction.taskPagePath}">
                        <s:div id="taskInstanceDiv">
                            <wi:form
                                canEdit="false"
                                formTitle="#{taskInstance.name}"
                                home="#{taskInstanceForm.home}"
                                reRenderSave="taskInstanceDiv"
                                form="#{taskInstaceForm}" />
                        </s:div>
                    </c:if>

                </rich:tab>

                <rich:tab
                    id="tabAnexos"
                    rendered="#{processoHome.managed}"
                    header="Documentos do Processo"
                    status=":status"
                    immediate="true">
                    <s:div id="divDocumentosProcesso">
                        <wi:dataTable
                            values="#{processoDocumentoList.list(15)}"
                            bean="#{processoDocumentoList}"
                            tableTitle="#{messages['processo.documentos']} #{home.instance}"
                            id="processoDocumentoList"
                            rowId="#{row.idProcessoDocumento}">
                            <ui:define name="headerToolBar" />
                            <wi:columnOutputText
                                columnId="nomeUsuarioInclusao"
                                columnHeader="#{messages['processoDocumento.usuarioInclusao']}"
                                value="#{row.nomeUsuarioInclusao}" />
                            <wi:columnDateTime
                                columnId="dataInclusao"
                                columnHeader="#{messages['processoDocumento.dataInclusao']}"
                                value="#{row.dataInclusao}" />
                            <wi:columnOutputText
                                columnId="processoDocumentoBin"
                                columnHeader="#{messages['processoDocumentoBin.documento']}"
                                value="#{row.processoDocumentoBin}" />
                        </wi:dataTable>
                    </s:div>
                </rich:tab>

                <rich:tab
                    id="tabMovimentacoes"
                    rendered="#{processoHome.managed}"
                    header="Movimentações do Processo"
                    status=":status"
                    immediate="true">
                    <ui:include
                        src="/WEB-INF/xhtml/components/grid/movimentacoesProcessoGrid.xhtml" />
                </rich:tab>

                <ui:param
                    name="action"
                    value="#{localizacaoDocumentoFisicoAction}" />
                <rich:tab
                    id="documentoFisicoTab"
                    rendered="#{home.isManaged()}"
                    header="#{messages['documentoFisico.titleTab']}"
                    action="#{action.init()}"
                    immediate="true">

                    <s:div id="documentoFisicoDiv">
                        <rich:dataTable
                            id="documentoFisicoTable"
                            value="#{localizacaoDocumentoFisicoAction.documentoFisicoList}"
                            var="row"
                            rows="10"
                            style="width: 75%">
                            <rich:column style="width: 40%">
                                <f:facet name="header">
                                    <h:outputText
                                        value="#{messages['documentoFisico.localizacaoFisica']}" />
                                </f:facet>
                                <h:outputText
                                    value="#{row.localizacaoFisica.caminhoCompletoToString()}" />
                            </rich:column>

                            <rich:column style="width: 40%">
                                <f:facet name="header">
                                    <h:outputText
                                        value="#{messages['documentoFisico.descricaoDocumentoFisico']}" />
                                </f:facet>
                                <h:outputText
                                    value="#{row.descricaoDocumentoFisico}" />
                            </rich:column>

                        </rich:dataTable>
                        <rich:dataScroller
                            id="dsDocumentoFisicoTable"
                            for="documentoFisicoTable"
                            lastPageMode="full"
                            align="left"
                            renderIfSinglePage="false" />
                    </s:div>
                </rich:tab>

                <rich:tab
                    id="tabPartesDoProcesso"
                    header="#{messages['parteProcesso.partes']}"
                    immediate="true"
                    status=":status"
                    rendered="#{processoHandler.hasPartes()}">
                    <ui:include src="parteProcessoGrid.xhtml" />
                </rich:tab>
            </rich:tabPanel>
        </h:form>
        <c:if test="#{!checkPermission}">
            <wi:outputText
                id="error"
                value="Você não pode mais efetuar transações neste registro, verifique se ele não foi movimentado" />
        </c:if>
    </ui:define>
</ui:composition>
