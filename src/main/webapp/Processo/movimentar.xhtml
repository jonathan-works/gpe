<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition
	 xmlns:ui="http://java.sun.com/jsf/facelets"
	 xmlns="http://www.w3.org/1999/xhtml"
	 xmlns:a="http://richfaces.org/a4j"
	 xmlns:c="http://java.sun.com/jsp/jstl/core"
	 xmlns:f="http://java.sun.com/jsf/core"
	 xmlns:h="http://java.sun.com/jsf/html"
	 xmlns:rich="http://richfaces.org/rich"
	 xmlns:s="http://jboss.org/schema/seam/taglib"
	 xmlns:wi="http://www.itx.com.br/jsf" template="/WEB-INF/xhtml/templates/cleanTemplate.xhtml">
	

    <!--
	  IBPM - Ferramenta de produtividade Java
	  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
	 
	  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
	  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
	  Free Software Foundation; versão 2 da Licença.
	  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
	  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
	  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
	  
	  Consulte a GNU GPL para mais detalhes.
	  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
	  veja em http://www.gnu.org/licenses/  
	-->

    <ui:param
		 name="pageTitle"
		 value="#{messages['processo.titlePage']}" />
    <ui:define name="title">#{pageTitle}</ui:define>

    <ui:param
		 name="home"
		 value="#{processoHome}" />
    <ui:param
		 name="showMenu"
		 value="false" />
    <ui:param
		 name="checkPermission"
		 value="#{processoHome.checarVisibilidade()}" />

    <ui:define name="body">
		
        <s:div id="script">
			
            <f:verbatim>
				
                <script type="text/javascript">
		    	function verifyFields() { 
		        	var taskCompleted = "#{util.getFromEventContext('taskCompleted')}";
		        	if(taskCompleted != '') {
			        	try {
		        			opener.atualizaPainelFluxo();
			        	} catch(e) {}
			        	var canClosePanel = "#{util.getFromEventContext('canClosePanel')}";
			        	if(canClosePanel != '') {
			        		window.close();
			        	} else {
			        		location = location.href;
			        	}
		        	} else {
		        		hideLoading();
		        	}
		    	}
		    </script>
            
			</f:verbatim>
        
		</s:div>

        <h:form>
			
            <a:jsFunction
				 name="renderButtons"
				 render="taskButtonsDiv" />
        
		</h:form>
			
            <wi:tabPanel
				 switchType="ajax"
				 rendered="#{checkPermission}"
				 activeTab="#{home.tab}">
				<h:form><wi:tabHeaders /></h:form>

                <wi:tab
					 id="tabFluxo"
					 name="tabFluxo"
					 rendered="#{!processoHome.managed}"
					 status=":status"
					 title="Escolher fluxo"
                     action="#{processoHome.limpar()}">
					
                    <h:messages
						 id="globalMessages"
						 globalOnly="true"
						 styleClass="message" />
                
				</wi:tab>

                <wi:tab
					 id="tabEntrada"
					 name="tabEntrada"
					 rendered="#{!empty taskInstanceView.fields}"
					 status=":status"
					 title="Entrada">
					
                    <s:div id="divDocAnterior">
						
                        <wi:form
							 canEdit="true"
							 formTitle="#{taskInstance.name}"
							 home="#{taskInstanceHome}"
							 form="#{taskInstanceView}" />
                    
					</s:div>
                
				</wi:tab>

                <wi:tab
					 id="tabSaida"
					 name="tabSaida"
					 rendered="#{processoHome.managed}"
					 status=":status"
					 title="Saída">
					
                    <c:if test="#{empty taskPageAction.taskPagePath}">
						
                        <s:div id="taskInstanceDiv">
							
                            <wi:form
								 canEdit="true"
								 formTitle="#{taskInstance.name}"
								 home="#{taskInstanceForm.home}"
								 reRenderSave="taskInstanceDiv"
								 form="#{taskInstaceForm}" />
                        
						</s:div>
                    
					</c:if>
                    <c:if test="#{not empty taskPageAction.taskPagePath}">
						
                        <ui:include src="#{taskPageAction.taskPagePath}" />
                    
					</c:if>
                
				</wi:tab>

                <wi:tab
					 id="tabAnexar"
					 name="tabAnexar"
					 rendered="#{processoHome.managed}"
					 status=":status"
					 title="Anexar Documento"
                     action="#{processoDocumentoHome.newInstance()}">
					
                    <s:div id="divAnexarDocumentos">
						
                        <div style="width: 75%; left: 1px;">
							
                            <wi:dataForm
								 formId="anexarDocumentosForm"
								 formTitle="#{messages['processoDocumento.anexarDocumento']}">
								
                                <ui:include src="/WEB-INF/xhtml/components/form/anexarDocumento.xhtml" />
                                <ui:include src="/WEB-INF/xhtml/components/form/buttons/anexarDocumentoButtons.xhtml" />
                                <ui:define name="buttons" />
                            
							</wi:dataForm>
                        
						</div>
                    
					</s:div>
                
				</wi:tab>

                <wi:tab
					 id="tabAnexos"
					 name="tabAnexos"
					 rendered="#{processoHome.managed}"
					 status=":status"
					 title="Documentos do Processo">
					
                    <s:div id="divDocumentosProcesso">
						
                        <wi:dataTable
							 values="#{processoDocumentoList.list(15)}"
							 bean="#{processoDocumentoList}"
							 tableTitle="#{messages['processo.documentos']} #{home.instance}"
							 id="processoDocumentoList"
							 rowId="#{row.idProcessoDocumento}">
							
                            <ui:define name="headerToolBar" />
                            <wi:columnOutputText
								 columnId="usuarioInclusao"
								 columnHeader="#{messages['processoDocumento.usuarioInclusao']}"
								 value="#{row.usuarioInclusao}" />
                            <wi:columnDateTime
								 columnId="dataInclusao"
								 columnHeader="#{messages['processoDocumento.dataInclusao']}"
								 value="#{row.dataInclusao}" />
                            <wi:columnOutputText
								 columnId="processoDocumentoBin"
								 columnHeader="#{messages['processoDocumentoBin.documento']}"
								 value="#{row.processoDocumentoBin}" />
                            <ui:define name="toolBar" />
                        
						</wi:dataTable>
                    
					</s:div>
                
				</wi:tab>

                <wi:tab
					 id="tabMovimentacoes"
					 name="tabMovimentacoes"
					 rendered="#{processoHome.managed}"
					 status=":status"
					 title="Movimentações do Processo">
					
                    <ui:include src="/WEB-INF/xhtml/components/grid/movimentacoesProcessoGrid.xhtml" />
                
				</wi:tab>

                <ui:param
					 name="action"
					 value="#{localizacaoDocumentoFisicoAction}" />
                <wi:tab
					 id="documentoFisicoTab"
					 name="documentoFisicoTab"
					 rendered="#{home.isManaged()}"
					 title="#{messages['documentoFisico.titleTab']}"
                     action="#{localizacaoDocumentoFisicoAction.init()}">
					
                    <wi:dataForm
						 formId="documentoFisicoForm"
						 formTitle="#{messages['form.title']}">
						
                        <wi:tree
							 id="localizacaoFisica"
							 assignTo="localizacaoDocumentoFisicoAction.instance.localizacaoFisica"
							 tree="#{localizacaoFisicaTree}"
							 label="#{messages['documentoFisico.localizacaoFisica']}"
							 required="true"
							 noSelectionLabel="#{messages['documentoFisico.selectLocalizacaoFisica']}" />

                        <wi:inputText
							 id="descricaoDocumentoFisico"
							 label="#{messages['documentoFisico.descricaoDocumentoFisico']}"
							 required="true"
							 value="#{action.instance.descricaoDocumentoFisico}"
							 maxlength="150" />
                        <ui:define name="buttons">
							
                            <wi:commandButton
								 id="saveDocumentoFisicoButton"
								 action="localizacaoDocumentoFisicoAction.save"
								 reRender="documentoFisicoForm, documentoFisicoDiv"
								 value="Incluir" />
                        
						</ui:define>
                    
					</wi:dataForm>
                    <s:div id="documentoFisicoDiv">
						
                        <rich:dataTable
							 id="documentoFisicoTable"
							 value="#{localizacaoDocumentoFisicoAction.documentoFisicoList}"
							 var="row"
							 rows="10"
							 style="width: 75%">
							
                            <rich:column style="width: 10%">
								
                                <f:facet name="header">
									
                                    <wi:toolBarRemove
										 id="headerInactivate"
										 reRender="documentoFisicoDiv"
										 actionRemove="localizacaoDocumentoFisicoAction.inactiveAll()"
										 title="Inativar todos os Registros" />
                                
								</f:facet>
                                <center>
									
                                    <wi:toolBarRemove
										 id="toolBarInactivate"
										 reRender="documentoFisicoDiv"
										 actionRemove="localizacaoDocumentoFisicoAction.inactive(row)" />
                                
								</center>
                            
							</rich:column>
                            <rich:column style="width: 40%">
								
                                <f:facet name="header">
									
                                    <h:outputText value="#{messages['documentoFisico.localizacaoFisica']}" />
                                
								</f:facet>
                                <h:outputText value="#{row.localizacaoFisica.caminhoCompletoToString()}" />
                            
							</rich:column>

                            <rich:column style="width: 40%">
								
                                <f:facet name="header">
									
                                    <h:outputText value="#{messages['documentoFisico.descricaoDocumentoFisico']}" />
                                
								</f:facet>
                                <h:outputText value="#{row.descricaoDocumentoFisico}" />
                            
							</rich:column>

                        
						</rich:dataTable>
                        <rich:dataScroller
							 id="dsDocumentoFisicoTable"
							 for="documentoFisicoTable"
							 lastPageMode="full"
							 align="left"
							 renderIfSinglePage="false" />
					</s:div>
                
				</wi:tab>

                <wi:tab
					 id="tabPartesDoProcesso"
					 name="tabPartesDoProcesso"
					 status=":status"
					 rendered="#{home.hasPartes()}"
					 title="#{messages['parteProcesso.partes']}">
					
                    <ui:include src="parteProcessoGrid.xhtml" />
                
				</wi:tab>
            
			</wi:tabPanel>
        
        <c:if test="#{!checkPermission}">
			
            <wi:outputText
				 id="error"
				 value="#{messages['movimentar.noPermission']}" />
        
		</c:if>
    
	</ui:define>



</ui:composition>
