<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    xmlns:infox="http://www.infox.com.br/jsf"
    template="/WEB-INF/xhtml/templates/minimal.xhtml">
    <ui:param
        name="pageTitle"
        value="#{eppmessages['processo.titlePage']}" />
    <ui:define name="title">#{pageTitle}</ui:define>
    <ui:define name="contentTitle">
    </ui:define>
    <ui:define name="scripts">
        <h:outputScript
            library="js/components"
            name="Modal.js" />
        <h:inputHidden
            id="taskCompleted"
            value="#{taskInstanceHome.taskCompleted}"></h:inputHidden>
        <h:inputHidden
            id="canClosePanel"
            value="#{taskInstanceHome.canClosePanelVal}"></h:inputHidden>
        <h:outputScript>
      function verifyFields() {
        try {
            opener.atualizaPainelFluxo();
          } catch (e) {
          }
        if ($('#taskCompleted').val() === 'true') {
          try {
            opener.atualizaPainelFluxo();
          } catch (e) {
          }
          if ($('#canClosePanel').val() === 'true') {
            close();
          } else {
            location = location.href.replace(/&amp;tarefaId=\d+/g,"");
          }
        } else {
          infox.hideLoading();
        }
      }
    </h:outputScript>
        <h:outputScript>
      function reloadPanel() {
          try {
            opener.atualizaPainelFluxo();
          } catch (e) {
          }
      }
    </h:outputScript>
    <h:outputScript rendered="#{processoEpaHome.tab=='tabSaida'}">
      invoke([ "infox.Modal" ], function(Modal) {
        var panelTeste = new Modal({
          id : "#{rich:clientId('mp_taskNodeDescription')}"
        });
        $(".mp-help").click(function show() {
          panelTeste.show();
        });
        
        #{rich:jQuery('mp_taskNodeCloseBtn')}.click(function hide() {
          panelTeste.hide();
        });
      });
    </h:outputScript>
    </ui:define>
    <ui:param
        name="home"
        value="#{processoEpaHome}" />
    <ui:param
        name="showMenu"
        value="false" />
    <ui:param
        name="checkPermission"
        value="#{processoEpaHome.checarVisibilidade()}" />
    <ui:param
        name="isUsuarioExterno"
        value="#{authenticator.usuarioExterno ? 'true':'false'}" />
    <ui:param
        name="showMsg"
        value="#{!isUsuarioExterno}" />
    <ui:param
        name="panelStyleClass"
        value="rf-dt-crud" />
    <ui:define name="body">
        <rich:collapsiblePanel
            switchType="client"
            header="#{eppmessages['processo.titleView']} #{processoEpaHome.instance.numeroProcesso} - #{taskInstance.name} : #{processoEpaHome.instance.itemDoProcesso}"
            expanded="false">
            <h:panelGrid
                columns="2"
                width="100%"
                columnClasses="viewColumn">
                <wi:outputText
                    id="dataInicio"
                    label="#{eppmessages['processo.dataInicio']}"
                    value="#{processoEpaHome.instance.dataInicio}">
                    <f:convertDateTime pattern="dd/MM/yyyy kk:mm" />
                </wi:outputText>
                <wi:outputText
                    id="usuarioCadastroProcesso"
                    label="#{eppmessages['processo.usuarioCadastroProcesso']}"
                    value="#{processoEpaHome.instance.usuarioCadastroProcesso}" />
            </h:panelGrid>
        </rich:collapsiblePanel>
        <h:form>
            <a:jsFunction
                name="renderButtons"
                render="taskButtonsDiv" />
        </h:form>
        <infox:tabPanel
            switchType="ajax"
            rendered="#{checkPermission}"
            activeTab="#{home.tab}"
            id="movimentarTabPanel">
            <h:form rendered="#{!isUsuarioExterno}">
                <infox:tabHeaders />
            </h:form>
            <infox:tab
                id="tabVariaveisProcesso"
                name="tabVariaveisProcesso"
                rendered="#{variavelProcessoAction.possuiVariaveis()}"
                title="#{eppmessages['variavelProcesso.variaveisProcesso']}">
                <h:form>
                    <rich:panel>
                        <ui:repeat
                            var="variavel"
                            value="#{variavelProcessoAction.variaveis}">
                            <wi:inputText
                                id="variavel-#{variavel.nome.replace(':', '_')}"
                                label="#{variavel.label}"
                                value="#{variavel.valor}" />
                        </ui:repeat>
                    </rich:panel>
                    <a:commandButton
                        value="Gravar"
                        action="#{variavelProcessoAction.save}"
                        render="@form, pageBodyDialogMessage"
                        styleClass="#{wi:get(styleClass, 'buttons')}" />
                </h:form>
            </infox:tab>
            <infox:tab
                id="tabEntrada"
                name="tabEntrada"
                rendered="#{!empty taskInstanceView.fields}"
                status=":status"
                title="#{eppmessages['movimentar.entrada.titleTab']}">
                <wi:form
                    canEdit="true"
                    formTitle="#{taskInstance.name}"
                    home="#{taskInstanceHome}"
                    form="#{taskInstanceView}" />
            </infox:tab>
            <infox:tab
                id="tabSaida"
                name="tabSaida"
                rendered="#{processoEpaHome.managed}"
                status=":status"
                title="#{eppmessages['movimentar.saida.titleTab']}">
                <c:if test="#{not taskPageAction.hasTaskPage}">
                    <wi:form
                        canEdit="true"
                        formTitle="#{taskInstance.name}"
                        home="#{taskInstanceForm.home}"
                        reRenderSave="taskInstanceForm"
                        form="#{taskInstaceForm}" />
                </c:if>
                <c:if test="#{taskPageAction.hasTaskPage}">
                    <ui:include src="#{taskPageAction.taskPagePath}" />
                </c:if>
            </infox:tab>
            <infox:tab
                id="tabAnexar"
                name="tabAnexar"
                rendered="#{processoEpaHome.managed}"
                status=":status"
                title="#{eppmessages['movimentar.anexar.titleTab']}"
                action="#{anexoController.onClickTabAnexar(processoEpaHome.instance)}">
                <wi:dataForm
                    formId="anexarDocumentosForm"
                    formTitle="#{eppmessages['movimentar.anexar.titleForm']}"
                    isUploadForm="true">
                    <ui:include src="anexarDocumentos.xhtml" />
                    <ui:define name="buttons" />
                </wi:dataForm>
            </infox:tab>
            <infox:tab
                id="tabAnexos"
                name="tabAnexos"
                rendered="#{processoEpaHome.managed}"
                status=":status"
                action="#{documentoList.entity.setProcesso(processoEpaHome.instance)}"
                actionListener="#{documentoProcessoAction.onClickDocumentosTab()}"
                title="#{eppmessages['movimentar.documentos.titleTab']}">
                <a:jsFunction name="selectDocumento" immediate="true"
					execute="@this" render="historicoDocumentoPanelDiv" limitRender="true" status=":status">
					<a:param name="idDocumento" assignTo="#{documentoProcessoAction.idDocumento}" converter="javax.faces.Integer"/>
				</a:jsFunction>
                <wi:dataTable
                    values="#{documentoList.list(15)}"
                    bean="#{documentoList}"
                    tableTitle="#{eppmessages['processo.documentos']} #{home.instance}"
                    id="documentoList"
                    rowId="#{row.id}"
                    showSearchForm="false"
                    panelStyleCss="full-sized">
                    <ui:define name="headerToolBar" />
                    <wi:columnOutputText 
                    	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                        columnId="numeroDocumento"
                        columnHeader="#{eppmessages['processoDocumento.numeroDocumento']}"
                        value="#{row.numeroDocumento}" />
                    <wi:columnOutputText
                    	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                        columnId="usuarioInclusao"
                        columnHeader="#{eppmessages['processoDocumento.usuarioInclusao']}"
                        value="#{row.usuarioInclusao}" />
                    <wi:columnDateTime
                    	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                        columnId="dataInclusao"
                        columnHeader="#{eppmessages['processoDocumento.dataInclusao']}"
                        value="#{row.dataInclusao}" />
                    <wi:columnOutputText 
                    	styleOutputText="#{row.excluido ? 'text-decoration:line-through; color:red;' : ''}"
                        columnId="processoDocumento"
                        columnHeader="#{eppmessages['processoDocumentoBin.documento']}"
                        value="#{row.descricao}" />
                    <ui:define name="toolBar">
                        <s:link
                            target="idJan#{row.id}"
                            rendered="#{not empty row.documentoBin.assinaturas and not row.excluido}"
                            view="/Processo/Consulta/validaDocumento.xhtml"
                            onclick="infox.openPopUp('idJan#{row.id}', '', 650, 160, 450, 450);">
                            <h:graphicImage
                                title="#{eppmessages['assinaturas.validar']}"
                                alt="#{eppmessages['assinaturas.validar']}"
                                url="#{a4jSkin.imgFolder}/lock.png" />
                            <f:param
                                value="#{row.idProcessoDocumento}"
                                name="idProcessoDocumento" />
                        </s:link>
                        <s:link
                            target="idJan#{row.id}"
                            rendered="#{empty row.documentoBin.assinaturas and not row.excluido}"
                            view="/Processo/Consulta/validaDocumento.xhtml"
                            onclick="infox.openPopUp('idJan#{row.id}', '', 650, 200, 450, 450);">
                            <h:graphicImage
                                title="#{eppmessages['assinaturas.assinar']}"
                                alt="#{eppmessages['assinaturas.assinar']}"
                                url="#{a4jSkin.imgFolder}/lock_unlock.png" />
                            <f:param value="#{row.id}" name="idProcessoDocumento" />	
                        </s:link>
                       	<h:graphicImage styleClass="opacityHover" url="#{a4jSkin.imgFolder}/view.gif" 
                       		            title="#{eppmessages['button.historico']}" 
                       		            rendered="#{documentoProcessoAction.hasHistoricoDocumento(rowId) and documentoProcessoAction.podeUsuarioVerHistorico()}"
                       		            onmouseup="selectDocumento(#{rowId});"/>
                        
                       	<h:graphicImage styleClass="opacityHover" url="#{a4jSkin.imgFolder}/remove.png"
                       					rendered="#{not row.excluido and documentoProcessoAction.podeUsuarioExcluirRestaurar()}" 
                       					title="#{eppmessages['button.delete']}"
                       					onmouseup="#{rich:component('requestMotivoPanel')}.show(); setValuesToExcludeRestore(true, #{rowId}, #{row.numeroDocumento}, '#{row.descricao}', '#{row.classificacaoDocumento.descricao}');"/>
                       	
                       	<h:graphicImage styleClass="opacityHover" url="#{a4jSkin.imgFolder}/stock_undelete.png"
                       				    rendered="#{row.excluido and documentoProcessoAction.podeUsuarioExcluirRestaurar()}" 
                       				    title="#{eppmessages['button.restaurar']}"
                       				    onmouseup="#{rich:component('requestMotivoPanel')}.show(); setValuesToExcludeRestore(false, #{rowId}, #{row.numeroDocumento}, '#{row.descricao}', '#{row.classificacaoDocumento.descricao}');"/>
                    </ui:define>
                </wi:dataTable>
                
                <script type="text/javascript">
					function clearFieldsExcludeRestore() {
						var maxlength = 4000;
						#{rich:jQuery('motivoExclusaoRestauracao')}.val('');
						#{rich:jQuery('motivoExclusaoRestauracaocounterDiv')}.text('(0 / '+maxlength+')');
						$('.errorFields.errors').remove();
						$('.errors').removeClass('errors');
				  	}
				  	
				  	function setValuesToExcludeRestore(isExclusao, idDocumento, numeroDocumento, dsDocumento, classificacao) {
					  	#{rich:jQuery('hiddenIdDocumento')}.val(idDocumento);
				  		#{rich:jQuery('numeroDocumento')}.text(numeroDocumento);
						#{rich:jQuery('processoDocumento')}.text(dsDocumento);
						#{rich:jQuery('tipoProcessoDocumentoOutPanel')}.text(classificacao);
						if (isExclusao) {
							$('.rf-pp-hdr.motivo-header > div').text('Exclusão de Documento');
							#{rich:jQuery('excluirRestaurarDocButton')}.attr('value','Excluir');
							alterarMotivoDaExlusaoRestauracao('Motivo da Exclusão');
						} else {
							$('.rf-pp-hdr.motivo-header > div').text('Restauração de Documento');
							#{rich:jQuery('excluirRestaurarDocButton')}.attr('value', 'Restaurar');
							alterarMotivoDaExlusaoRestauracao('Motivo da Restauração');
						}
					}

				  	function alterarMotivoDaExlusaoRestauracao(label){
						var labelTextArea = $('label[for=\''+#{rich:jQuery('motivoExclusaoRestauracao')}.attr('id')+'\']');
						labelTextArea.text(label);
						labelTextArea.append($("<span> * </span>").addClass("required"));
					}

					function atualizarOnValidationFailed() {
						var teste = $('.rf-pp-hdr.motivo-header').children(0).text();
						if (teste === 'Exclusão de Documento') {
							#{rich:jQuery('excluirRestaurarDocButton')}.attr('value','Excluir');
							alterarMotivoDaExlusaoRestauracao('Motivo da Exclusão');
						} else {
							#{rich:jQuery('excluirRestaurarDocButton')}.attr('value', 'Restaurar');
							alterarMotivoDaExlusaoRestauracao('Motivo da Restauração');
						}
					}
                </script>
                
                <rich:popupPanel id="requestMotivoPanel" header="teste" headerClass="motivo-header" moveable="true" 
                				 show="false" resizeable="true" minWidth="690" minHeight="310"
                				 onbeforehide="clearFieldsExcludeRestore();">
			        <f:facet name="controls">
			        	<h:graphicImage id="mp_taskNodeCloseBtn" styleClass="mp-close" value="#{a4jSkin.imgFolder}/closeMP.gif" 
			        					onmouseup="#{rich:component('requestMotivoPanel')}.hide();"/>
			        </f:facet>
		          	<wi:outputText id="numeroDocumento" label="#{eppmessages['processoDocumento.numeroDocumento']}" />
		          	
		          	<wi:outputText id="tipoProcessoDocumentoOutPanel" label="#{eppmessages['tipoProcessoDocumento.tipoProcessoDocumento']}" />
		          					
		          	<wi:outputText id="processoDocumento" label="#{eppmessages['processoDocumentoBin.documento']}" />
			        <h:form id="excluirRestaurarDocumentoForm">
			          <div>
		          		<h:inputHidden id="hiddenIdDocumento" value="#{documentoProcessoAction.idDocumentoAlter}" converter="javax.faces.Integer"/>
			            <wi:inputTextarea id="motivoExclusaoRestauracao"
			            	maxlength="4000" required="true" cols="60" rows="5"
			            	label="Motivo" value="#{documentoProcessoAction.motivoExclusaoRestauracao}">
			           		<f:validator validatorId="emptyStringValidator"/>
			           	</wi:inputTextarea>
			          </div>
			          <div>
			          	<a:commandButton id="excluirRestaurarDocButton" 
			          		actionListener="#{documentoProcessoAction.exclusaoRestauracaoDocumento()}"
					        limitRender="true" execute="@form"
					        onclick="infox.showLoading();"
					        oncomplete="infox.hideLoading(); if(#{not facesContext.validationFailed}){#{rich:component('requestMotivoPanel')}.hide();}else{atualizarOnValidationFailed();}"
					        value="Enviar"
					        render="@form, documentoList, pageBodyDialogMessage"
					        styleClass="buttons"/>
			          </div>
			        </h:form>
                </rich:popupPanel>
                
                <s:div id="historicoDocumentoPanelDiv" style="margin-top:20px; width:100%;">
	                <rich:panel id="historicoDocumentoPanel" headerClass=""
	                			rendered="#{not empty documentoProcessoAction.processoDocumentoSelected}"
	                			bodyClass="dtable-p-b" styleClass="dtable-p" style="width:100%;" >
	                			
	                	<f:facet name="header">
	                		<h:outputText value="#{eppmessages['historicoStatusDocumento.tableTile']}" />
	                		<h:graphicImage value="#{a4jSkin.imgFolder}/closeMP.gif" onmouseup="selectDocumento(0);" style="float:right;"/>
			        	</f:facet>
			        	
					  	<rich:dataTable id="historicoDocumentoDataTable"
					  			var="historicoDocumento" style="width:100%"
					  			value="#{documentoProcessoAction.listHistoricoStatusDocumento}">
					  			
					  		<rich:column style="text-align:center;">
					  			<f:facet name="header">#{eppmessages['historicoStatusDocumento.nomeUsuarioAlterou']}</f:facet>
					  			<h:outputText value="#{historicoDocumento.usuarioAlteracao.nomeUsuario}" />
					  		</rich:column>
					  		
					  		<rich:column style="text-align:center;">
					  			<f:facet name="header">#{eppmessages['historicoStatusDocumento.dataAlteracao']}</f:facet>
					  			<h:outputText value="#{historicoDocumento.dataAlteracao}">
					  				<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss"/>
					  			</h:outputText>
					  		</rich:column>
					  		
					  		<rich:column style="text-align:center;">
					  			<f:facet name="header">Tipo Operação</f:facet>
					  			<h:outputText value="#{historicoDocumento.tipoAlteracaoDocumento.label}" />
					  		</rich:column>
					  		
					  		<rich:column>
					  			<f:facet name="header">#{eppmessages['historicoStatusDocumento.motivo']}</f:facet>
					  			<h:outputText value="#{historicoDocumento.motivo}" />
					  		</rich:column>
					  		
					  	</rich:dataTable>              
	                </rich:panel>
                 </s:div>
            </infox:tab>
            
            <infox:tab
                id="tabMovimentacoes"
                name="tabMovimentacoes"
                rendered="#{processoEpaHome.managed}"
                status=":status"
                title="#{eppmessages['movimentar.movimentacoes.titleTab']}">
                <ui:include
                    src="/WEB-INF/xhtml/components/grid/movimentacoesProcessoGrid.xhtml" />
            </infox:tab>
            <ui:param
                name="action"
                value="#{localizacaoDocumentoFisicoCrudAction}" />
            <infox:tab
                id="documentoFisicoTab"
                name="documentoFisicoTab"
                rendered="#{home.isManaged()}"
                action="#{localizacaoDocumentoFisicoCrudAction.setProcesso(processoEpaHome.instance)}"
                title="#{eppmessages['documentoFisico.titleTab']}">
                <wi:dataForm
                    formId="documentoFisicoForm"
                    formTitle="#{eppmessages['documentoFisico.form']}">
                    <wi:tree
                        id="localizacaoFisica"
                        assignTo="localizacaoDocumentoFisicoCrudAction.instance.localizacaoFisica"
                        tree="#{localizacaoFisicaTree}"
                        label="#{eppmessages['documentoFisico.localizacaoFisica']}"
                        required="true"
                        noSelectionLabel="#{eppmessages['documentoFisico.selectLocalizacaoFisica']}" />
                    <wi:inputText
                        id="descricaoDocumentoFisico"
                        label="#{eppmessages['documentoFisico.descricaoDocumentoFisico']}"
                        required="true"
                        value="#{action.instance.descricaoDocumentoFisico}"
                        maxlength="150" />
                    <ui:define name="buttons">
                        <wi:commandButton
                            id="saveDocumentoFisicoButton"
                            action="localizacaoDocumentoFisicoCrudAction.save"
                            reRender="documentoFisicoForm, documentoFisicoDiv, pageBodyDialogMessage"
                            value="#{eppmessages['crud.persist']}" />
                    </ui:define>
                </wi:dataForm>
                <s:div id="documentoFisicoDiv">
                    <wi:dataTable
                        id="documentoFisicoTable2"
                        values="#{localizacaoDocumentoFisicoCrudAction.documentoFisicoList}"
                        var="row"
                        rows="10"
                        showSearchForm="false"
                        panelStyleCss="full-sized">
                        <ui:define name="toolBar">
                            <wi:toolBarRemove
                                id="toolBarInactivate"
                                reRender="documentoFisicoDiv, pageBodyDialogMessage"
                                actionRemove="localizacaoDocumentoFisicoCrudAction.remove(row)" />
                        </ui:define>
                        <ui:define name="headerToolBar" />
                        <wi:columnOutputText
                            columnId="localizacaoFisica"
                            columnHeader="#{eppmessages['documentoFisico.localizacaoFisica']}"
                            value="#{row.localizacaoFisica.caminhoCompletoToString()}"
                            hideOrder="true" />
                        <wi:columnOutputText
                            columnId="descricao"
                            columnHeader="#{eppmessages['documentoFisico.descricaoDocumentoFisico']}"
                            value="#{row.descricaoDocumentoFisico}"
                            hideOrder="true" />
                    </wi:dataTable>
                </s:div>
            </infox:tab>
            <infox:tab
                id="relacionamentoProcessoTab"
                name="relacionamentoProcessoTab"
                rendered="#{home.isManaged()}"
                title="#{eppmessages['relacionamentoProcesso.titleTab']}">
                <s:div id="relacionamentoProcessoFormDiv">
                    <wi:dataForm
                        formId="relacionamentoProcessoForm"
                        formTitle="#{eppmessages['relacionamentoProcesso.titleForm']}"
                        home="#{relacionamentoCrudAction}">
                        <wi:inputText
                            id="labelNumeroProcesso"
                            label="#{eppmessages['relacionamentoProcesso.numeroProcesso']}"
                            required="true"
                            maxlength="30"
                            value="#{relacionamentoCrudAction.processoRelacionado}"
                            disabled="#{relacionamentoCrudAction.managed}">
                        </wi:inputText>
                        <wi:selectOneMenuEntity
                            id="tipoRelacionamento"
                            value="#{relacionamentoCrudAction.instance.tipoRelacionamentoProcesso}"
                            label="#{eppmessages['tipoRelacionamentoProcesso.tipoRelacionamento']}"
                            items="#{relacionamentoCrudAction.tipoRelacionamentoProcessoList}"
                            required="true"
                            hideNoSelectionLabel="false"
                            showLabelSelecione="true">
                        </wi:selectOneMenuEntity>
                        <wi:inputTextarea
                            id="motivo"
                            label="#{eppmessages['relacionamentoProcesso.motivo']}"
                            value="#{relacionamentoCrudAction.instance.motivo}"
                            required="true">
                        </wi:inputTextarea>
                        <wi:selectSituacaoRadio
                            id="ativo"
                            label="#{eppmessages['field.situacao']}"
                            rendered="#{relacionamentoCrudAction.managed}"
                            value="#{relacionamentoCrudAction.instance.ativo}" />
                        <ui:define name="buttons">
                            <wi:commandButton
                                id="persistButton"
                                action="relacionamentoCrudAction.save()"
                                reRender="relacionamentoProcessoFormDiv relacionamentoProcessoDTDiv pageBodyDialogMessage"
                                value="#{relacionamentoCrudAction.isManaged() ? messages['crud.update'] : messages['crud.persist']}"
                                execute="relacionamentoProcessoFormDiv">
                            </wi:commandButton>
                            <wi:commandButtonNew newInstanceAction="relacionamentoCrudAction.newInstance()"
                            					 reRender="relacionamentoProcessoFormDiv"/>
                        </ui:define>
                    </wi:dataForm>
                </s:div>
                <s:div id="relacionamentoProcessoDTDiv" style="margin-top:10px">
                    <h:panelGroup
                        id="dtable"
                        rendered="#{not empty relacionamentoCrudAction.processo}">
                        <wi:dataTable
                            id="relProcDt2"
                            bean="#{relacionamentoProcessoList}"
                            values="#{relacionamentoProcessoList.list(15)}"
                            tableTitle="#{eppmessages['relacionamentoProcesso.processosRelacionados']}"
                            rowId="#{row.idRelacionamentoProcesso}"
                            showSearchForm="false"
                            panelStyleClass="rel-proc-dt">
                            <ui:define name="headerToolBar" />
                            <ui:define name="toolBar">
                                <wi:toolBarEdit
                                    id="#{id}Edit"
                                    action="#{relacionamentoCrudAction.setEditMode(row.numeroProcesso, row.relacionamento.idRelacionamento)}"
                                    render="relacionamentoProcessoFormDiv pageBodyDialogMessage" />
                                <wi:toolBar
                                    id="#{id}Inactivate"
                                    action="relacionamentoCrudAction.inactive(row.relacionamento)"
                                    rendered="#{row.relacionamento.ativo}"
                                    limitToList="true"
                                    status=":status"
                                    render="relacionamentoProcessoFormDiv relacionamentoProcessoDTDiv pageBodyDialogMessage"
                                    onclick="return confirm(\'#{eppmessages['crud.confirmInactivate']}\');"
                                    url="#{a4jSkin.imgFolder}/remove.png"
                                    title="#{eppmessages['button.inactive']}" />
                            </ui:define>
                            <wi:columnOutputText
                                columnId="numeroProcesso"
                                columnHeader="#{eppmessages['relacionamentoProcesso.numeroProcesso']}"
                                value="#{row.numeroProcesso}" />
                            <wi:columnOutputText
                                columnId="motivo"
                                columnHeader="#{eppmessages['relacionamentoProcesso.motivo']}"
                                value="#{row.relacionamento.motivo}" />
                            <wi:columnOutputText
                                columnId="nomeUsuario"
                                columnHeader="#{eppmessages['relacionamentoProcesso.nomeUsuario']}"
                                value="#{row.relacionamento.nomeUsuario}" />
                            <wi:columnOutputText
                                columnId="dataRelacionamento"
                                columnHeader="#{eppmessages['relacionamentoProcesso.dataRelacionamento']}"
                                value="#{row.relacionamento.dataRelacionamento}" />
                            <wi:columnOutputText
                                columnId="ativo"
                                value="#{row.relacionamento.ativo ? messages['entity.ativo'] : messages['entity.inativo']}"
                                columnHeader="#{eppmessages['entity.situacao']}"
                                columnStyle="text-align:center;"
                                columnWidth="10%" />
                        </wi:dataTable>
                    </h:panelGroup>
                </s:div>
            </infox:tab>
            <infox:tab
                id="tabPartesDoProcesso"
                name="tabPartesDoProcesso"
                status=":status"
                action="#{partesProcessoController.setProcessoEpa(home.instance)}"
                rendered="#{home.hasPartes()}"
                title="#{eppmessages['parteProcesso.partes']}">
                <ui:include src="parteProcessoGrid.xhtml" />
            </infox:tab>
        </infox:tabPanel>
        <c:if test="#{!checkPermission}">
            <wi:outputText
                id="error"
                value="#{eppmessages['movimentar.noPermission']}" />
        </c:if>
        <ui:param
            name="modalWidth"
            value="640" />
        <ui:param
            name="modalHeight"
            value="480" />
        <rich:popupPanel
            id="mp_taskNodeDescription"
            height="#{modalHeight}"
            width="#{modalWidth}"
            show="false"
            modal="true"
            moveable="true"
            resizeable="false"
            styleClass="popup-help"
            domElementAttachment="parent">
            <f:facet name="header">
                <h:outputText
                    value="#{eppmessages['jbpm.taskNode.description']}" />
            </f:facet>
            <f:facet name="controls">
                <h:panelGroup>
                    <h:graphicImage
                        id="mp_taskNodeCloseBtn"
                        styleClass="mp-close"
                        value="#{a4jSkin.imgFolder}/closeMP.gif" />
                </h:panelGroup>
            </f:facet>
            <wi:editor
                id="taskNodeDescription"
                value="#{taskInstanceHome.taskNodeDescription}"
                width="#{modalWidth-15}"
                height="#{modalHeight-90}"
                readonly="true" />
        </rich:popupPanel>
    </ui:define>
</ui:composition>
