<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:p="http://primefaces.org/ui"
  xmlns:wi="http://www.itx.com.br/jsf">
  
  	<ui:param name="varId" value="#{formField.id}"/>
  	<ui:param name="controller" value="#{formField.type}" />
  	<ui:param name="readonly" value="#{formField.properties.readonly}" />
  	<ui:param name="required" value="#{formField.properties.required}" />
  	<ui:param name="classificacoesDocumento" value="#{formField.properties.classificacoesDocumento}"/>
  	<ui:param name="modelosDocumento" value="#{formField.properties.modelosDocumento}"/>
  	
	<wi:selectOneMenuEntity id="#{varId}ClassificacaoDocumento"
		label="#{infoxMessages['processoDocumento.classificacaoDocumento']}"
		items="#{classificacoesDocumento}"
		required="#{wi:get(required, false)}"
		showLabelSelecione="true"
		value="#{formField.properties.classificacaoDocumento}"
		readonly="#{readonly or classificacoesDocumento.size eq 1 or formField.value.hasAssinatura()}"
		disabled="#{readonly or classificacoesDocumento.size eq 1 or formField.value.hasAssinatura()}">
		<f:validator validatorId="classificacaoEditorValidator" for="@this"/>
		<f:attribute name="editorId" value="#{rich:clientId(varId)}"/>
	</wi:selectOneMenuEntity>
	
    <wi:selectOneMenuEntity id="#{varId}ModeloDocumento"
		label="#{infoxMessages['modeloDocumento.modeloDocumento']}"
		items="#{formField.properties.modelosDocumento}"
		noSelectionLabel="[Selecione o modelo]"
		required="false"
		value="#{formField.properties.modeloDocumento}"
		rendered="#{not readonly and not formField.value.hasAssinatura()}">
		<a:ajax event="change" render="#{varId}EditorDiv" execute="@this" limitRender="true" 
			listener="#{controller.performModeloDocumento(formField, formData)}"/>
	</wi:selectOneMenuEntity>
	   
	<p:outputPanel id="#{varId}EditorDiv">
	   	<s:div id="#{varId}ToolTipDivExterna">
		    <s:div id="#{varId}ToolTipDiv" styleClass="tooltip-parent" style="width: 10px" 
			  	rendered="#{not empty formField.properties.classificacaoDocumento.observacao and not (readonly or formField.value.hasAssinatura())}">
			  	<h:graphicImage id="#{varId}helpEditTipImg" 
			  		url="#{layoutController.getResourceUrlByPath('/imagens/help.gif')}" />
				<div class="epp-tooltip">
					<div class="tooltip-panel">
						<div><h:outputText value="Observação:"/></div>
						<h:outputText value="#{formField.properties.classificacaoDocumento.observacao}"/>
					</div>
				</div>
		    </s:div>
	    </s:div>
	    
	    <wi:editor id="#{varId}" value="#{formField.value.documentoBin.modeloDocumento}"
	    	required="#{wi:get(required, false)}"
	        readonly="#{readonly or formField.value.hasAssinatura()}" 
	        label="#{formField.label}"/>
	        
	</p:outputPanel>
	   
	<p:outputPanel id="#{varId}AssinaturaDocumento" >
	   
	    <p:outputPanel rendered="#{controller.podeAssinar(formField)}">
	    
			<a:jsFunction name="assinar"
				action="#{controller.assinar()}"
				execute="@this, #{varId}AssinaturaDocumento"
				render="#{varId}Div, :pageBodyDialogMessage" 
				oncomplete="infox.hideLoading();"/>
				
			<wi:certificadoDigital
	            id="#{varId}appletAssinatura"
				signButtonCaption="#{infoxMessages['assinaturas.assinar']}"
				reRender="#{varId}AssinaturaDocumento, :pageBodyDialogMessage"
				tokenField="#{controller.tokenToSign}"
				propertyValue="#{formField.value}"
				propertyTarget="#{controller.documentoToSign}"
				signableData="#{controller.documentoToSign.documentoBin.md5Documento}"
				functionPreSign="infox.showLoading();"
				functionPosSign="assinar();" >
	       </wi:certificadoDigital>
	       
		</p:outputPanel>
	
	</p:outputPanel>
  
</ui:composition>