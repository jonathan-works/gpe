<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:infox="http://www.infox.com.br/jsf"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/core/defaultTemplate.xhtml">
    <ui:define name="title">#{infoxMessages['fluxo.titlePage']}</ui:define>
    <ui:param
        name="home"
        value="#{fluxoCrudAction}" />
    <ui:define name="searchGrid">
        <wi:dataTable
            values="#{fluxoList.list(15)}"
            bean="#{fluxoList}"
            tableTitle="#{infoxMessages['fluxo.tableTitle']}"
            id="fluxoList"
            rowId="#{row.idFluxo}">
            <ui:define name="searchForm">
                <wi:searchForm
                    formId="pesquisarFluxoForm"
                    formTitle="#{infoxMessages['searchForm.title']}">
                    <wi:inputText
                        id="codFluxo"
                        label="#{infoxMessages['fluxo.codFluxo']}"
                        value="#{fluxoList.entity.codFluxo}" />
                    <wi:inputText
                        id="descricao"
                        label="#{infoxMessages['fluxo.descricao']}"
                        value="#{fluxoList.entity.fluxo}" />
                    <wi:inputDataPeriodo
                        id="dataPublicacao"
                        label="#{infoxMessages['fluxo.dataPublicacao']}"
                        valueDateFrom="#{fluxoList.entity.dataInicioPublicacao}"
                        valueDateTo="#{fluxoList.entity.dataFimPublicacao}" />
                    <wi:selectBooleanMenu
                        id="publicado"
                        label="#{infoxMessages['fluxo.publicado']}"
                        value="#{fluxoList.entity.publicado}" />
                    <wi:selectSituacaoOneMenu
                        id="ativo"
                        label="#{infoxMessages['field.situacao']}"
                        value="#{fluxoList.entity.ativo}" />
                </wi:searchForm>
            </ui:define>
            <wi:columnOutputText
                columnId="codFluxo"
                columnHeader="#{infoxMessages['fluxo.codFluxo']}"
                value="#{row.codFluxo}" />
            <wi:columnOutputText
                columnId="fluxo"
                columnHeader="#{infoxMessages['fluxo.descricao']}"
                value="#{row.fluxo}" />
            <wi:columnOutputText
                columnId="dataInicioPublicacao"
                columnHeader="#{infoxMessages['fluxo.dataInicioPublicacao']}"
                value="#{row.dataInicioPublicacao}" />
            <wi:columnOutputText
                columnId="dataFimPublicacao"
                columnHeader="#{infoxMessages['fluxo.dataFimPublicacao']}"
                value="#{row.dataFimPublicacao}" />
            <wi:columnBoolean
                columnId="publicado"
                columnHeader="#{infoxMessages['fluxo.publicado']}"
                value="#{row.publicado}" />
                
            <wi:columnBoolean columnId="possuirAlteracoes" columnHeader="#{infoxMessages['fluxo.alterado']}" value="#{not (row.xml eq row.xmlExecucao)}"/>
            <wi:columnSituacao
                columnId="ativo"
                columnHeader="#{infoxMessages['field.situacao']}"
                value="#{row.ativo}" />
            <ui:define name="toolBar">
                <h:form style="display:inline-block;">
                    <a:commandLink id="publicar"
                        action="#{fluxoMergeView.deploy(row)}"
                        onclick="if (!confirm('#{infoxMessages['fluxo.publicar.confirm']}')) { return false; }"
                        onbegin="infox.showLoading();"
                        rendered="#{not row.bpmn and not (row.xml eq row.xmlExecucao and row.publicado)}"
                        render="pageBody"
                        oncomplete="infox.hideLoading();opener.refreshPage();">
                        <wi:toolBarGraphicImage title="#{infoxMessages['processBuilder.deployBtn']}" url="#{layoutController.getResourceUrlByPath('/imagens/deploy.png')}" />
                    </a:commandLink>
                <wi:toolBarEdit id="fluxoListedit" />
                <wi:toolBarInactive />
                </h:form>
            </ui:define>
        </wi:dataTable>
    </ui:define>
    <ui:define name="form">
        <wi:dataForm
            formId="fluxoForm"
            formTitle="#{infoxMessages['form.title']}">
            <wi:inputText
                id="codFluxo"
                value="#{fluxoCrudAction.instance.codFluxo}"
                required="true"
                label="#{infoxMessages['fluxo.codFluxo']}"
                maxlength="30" >
                <f:validator validatorId="jsfComponentIdValidator" />
            </wi:inputText>
            <wi:inputText
                id="descricaoFluxo"
                required="true"
                label="#{infoxMessages['fluxo.descricao']}"
                value="#{fluxoCrudAction.instance.fluxo}" 
                maxlength="100" />
            <wi:inputNumber
                id="prazoDias"
                label="#{infoxMessages['fluxo.qtPrazo']}"
                required="true"
                value="#{fluxoCrudAction.instance.qtPrazo}"
                maxlength="10" />
            <wi:inputDate
                id="dataInicio"
                label="#{infoxMessages['fluxo.dataInicioPublicacao']}"
                required="true"
                value="#{fluxoCrudAction.instance.dataInicioPublicacao}" />
            <wi:inputDate
                id="dataFim"
                label="#{infoxMessages['fluxo.dataFimPublicacao']}"
                value="#{fluxoCrudAction.instance.dataFimPublicacao}" />
            <wi:outputText id="statusPublicacao" rendered="#{fluxoCrudAction.managed}" label="#{infoxMessages['fluxo.publicado']}"
                value="#{fluxoCrudAction.instance.publicado ? 'Sim' : 'NÃ£o'}" />
            <wi:selectSituacaoRadio
                id="ativo"
                label="#{infoxMessages['field.situacao']}"
                value="#{fluxoCrudAction.instance.ativo}" />
            <ui:define name="buttons">
                <wi:commandButtonSave
                    rendered="#{not fluxoCrudAction.replica}" />
                <wi:commandButtonNew />
                <wi:commandButton
                    id="updateButton"
                    action="fluxoCrudAction.criarReplica()"
                    reRender="#{wi:get(reRender, 'pageBody, modalPanelMessages')}"
                    rendered="#{fluxoCrudAction.managed or fluxoCrudAction.replica}"
                    value="#{infoxMessages['fluxo.exportar']}" />
                <wi:commandButton
                    id="definicao"
                    value="#{infoxMessages['fluxo.definicao']}" reRender="@this"
                    rendered="#{fluxoCrudAction.managed and not fluxoCrudAction.replica and not fluxoCrudAction.instance.bpmn}"
                    oncomplete="openPopUp('processDefinition', '#{pathResolver.getContextPath()}/Fluxo/definicao/processDefinition.seam#/bpmn/#{fluxoCrudAction.instance.idFluxo}',1300,850);">
                    <f:setPropertyActionListener value="#{fluxoCrudAction.instance}" target="#{flash.fluxo}"></f:setPropertyActionListener>
                  	<infox:flashcopy />
                </wi:commandButton>
                
                <wi:commandButton
                    id="importarXPDL"
                    value="#{infoxMessages['importarXPDL.button']}"
                    rendered="#{fluxoCrudAction.managed and not fluxoCrudAction.replica}"
                    onclick="openPopUp('importarXPDL', '#{pathResolver.getContextPath()}/Fluxo/importar/importarXPDL.seam?scid=#{conversation.id}',1300,850);" />
            </ui:define>
        </wi:dataForm>
    </ui:define>
    <ui:define name="tabs">
        <ui:param
            name="action"
            value="#{fluxoPapelAction}" />
        <infox:tab
            id="fluxoPapelTab"
            rendered="#{home.isManaged() and not fluxoCrudAction.replica}"
            action="#{action.init(fluxoCrudAction.instance)}"
            title="#{infoxMessages['fluxoPapel.titleTab']}"
            name="fluxoPapelTab">
            <wi:dataForm
                formId="fluxoPapelForm"
                formTitle="#{infoxMessages['form.title']}">
                <wi:tree
                    id="papelTree"
                    label="#{infoxMessages['fluxoPapel.papel']}"
                    assignTo="fluxoPapelAction.instance.papel"
                    tree="#{action.papelTreeHandler}"
                    required="true" />
                <ui:define name="buttons">
                    <wi:commandButton
                        id="saveButton"
                        action="fluxoPapelAction.save"
                        reRender="fluxoPapelForm, fluxoPapelDiv, pageBodyDialogMessage"
                        value="#{infoxMessages['crud.persist']}" />
                </ui:define>
            </wi:dataForm>
            <s:div id="fluxoPapelDiv">
                <rich:dataTable
                    id="fluxoPapelTable"
                    value="#{action.fluxoPapelList}"
                    var="row"
                    rows="10">
                    <rich:column>
                        <wi:toolBarRemove
                            id="toolBarRemove"
                            reRender="fluxoPapelDiv"
                            actionRemove="fluxoPapelAction.remove(row)" />
                    </rich:column>
                    <rich:column>
                        <f:facet name="header">
                            <h:outputText
                                value="#{infoxMessages['fluxoPapel.papel']}" />
                        </f:facet>
                        <h:outputText value="#{row.papel}" />
                    </rich:column>
                </rich:dataTable>
                <rich:dataScroller
                    id="dsFluxoPapelTable"
                    for="fluxoPapelTable"
                    lastPageMode="full"
                    align="left"
                    renderIfSinglePage="false" />
            </s:div>
        </infox:tab>
        <infox:tab
            id="natCatFluxoLoc"
            name="natCatFluxoLoc"
            rendered="#{home.managed and not fluxoCrudAction.replica}"
            title="#{infoxMessages['localizacao.titleView']}">
            <s:div id="natCatFluxoLocDiv">
                <div>
                    <wi:dataForm
                        formId="natCatFluxoLocForm"
                        formTitle="#{infoxMessages['form.title']}: #{fluxoCrudAction.instance}">
                        <wi:selectOneMenuEntity
                            id="naturezaCategoriaFluxo"
                            value="#{fluxoLocalizacaoCrudAction.naturezaCategoriaFluxo}"
                            required="true"
                            label="#{infoxMessages['natCatFluxoLocalizacao.naturezaCategoriaFluxo']}"
                            showLabelSelecione="true"
                            items="#{fluxoLocalizacaoCrudAction.getActiveNaturezaCategoriaFluxoListByFluxo(fluxoCrudAction.instance)}" />
                        <wi:tree
                            id="localizacao"
                            assignTo="fluxoLocalizacaoCrudAction.localizacao"
                            label="#{infoxMessages['localizacao.titleView']}"
                            required="true"
                            tree="#{localizacaoFullTree}" 
                            styleClass="#{empty item.entity.estruturaPai ? 'tree-notselectable' : ''}" />
                        <ui:define name="buttons">
                            <wi:commandButton
                                id="saveButton"
                                action="fluxoLocalizacaoCrudAction.save"
                                reRender="natCatFluxoLocDiv, pageBodyDialogMessage"
                                value="#{infoxMessages['crud.persist']}" />
                        </ui:define>
                    </wi:dataForm>
                </div>
                <s:div id="dtable">
                    <wi:dataTable
                        values="#{natCatFluxoLocalizacaoList.list(15)}"
                        bean="#{natCatFluxoLocalizacaoList}"
                        tableTitle="#{infoxMessages['natCatFluxoLocalizacao.tableTitle']}"
                        id="natCatFluxoLocalizacaoList"
                        rowId="#{row.idNatCatFluxoLocalizacao}"
                        actionInactive="fluxoLocalizacaoCrudAction.inactive"
                        showSearchForm="false" panelStyle="margin-top: 1em;">
                        <ui:define name="searchForm" />
                        <ui:define name="headerToolBar" />
                        <ui:define name="toolBar">
                            <wi:toolBarRemove
                                actionRemove="fluxoLocalizacaoCrudAction.remove(row)"
                                reRender="natCatFluxoLocDiv pageBodyDialogMessage" />
                        </ui:define>
                        <wi:columnOutputText
                            columnId="naturezaCategoriaFluxo.natureza"
                            columnHeader="#{infoxMessages['naturezaCategoriaFluxo.natureza']}"
                            columnWidth="25%"
                            value="#{row.naturezaCategoriaFluxo.natureza}" />
                        <wi:columnOutputText
                            columnId="naturezaCategoriaFluxo.categoria"
                            columnHeader="#{infoxMessages['naturezaCategoriaFluxo.categoria']}"
                            columnWidth="20%"
                            value="#{row.naturezaCategoriaFluxo.categoria}" />
                        <wi:columnOutputText
                            columnId="naturezaCategoriaFluxo.fluxo"
                            columnHeader="#{infoxMessages['naturezaCategoriaFluxo.fluxo']}"
                            columnWidth="20%"
                            value="#{row.naturezaCategoriaFluxo.fluxo}" />
                        <wi:columnOutputText
                            columnId="localizacao"
                            columnHeader="#{infoxMessages['localizacao.titleView']}"
                            columnWidth="20%"
                            value="#{row.localizacao}" />
                    </wi:dataTable>
                </s:div>
            </s:div>
        </infox:tab>
        <infox:tab
	        name="modeloPastasTab"
	        id="modeloPastasTab"
	        title="#{infoxMessages['modeloPasta.tabTitle']}"
	        rendered="#{home.isManaged() and not fluxoCrudAction.replica}"
            action="#{modeloPastaRestricaoAction.init(fluxoCrudAction.instance)}">
	        <ui:include src="definicao/modeloPastaRestricao.xhtml" />	        
      	</infox:tab>
    </ui:define>
</ui:composition>

