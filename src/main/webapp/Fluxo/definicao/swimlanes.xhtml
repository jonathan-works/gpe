<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf">

    <s:div styleClass="Swimlane swimlane-list">
        <ui:decorate template="dataTable.xhtml">
            <ui:param name="values" value="#{swimlaneFitter.swimlanes}" />
            <ui:param name="id" value="swimlanesTable" />
            <ui:define name="headerToolBar">
                <h:form>
                    <a:commandLink
                        action="#{swimlaneFitter.addSwimlane}"
                        execute="@this"
                        render="swimlanesForm, swimlanesTable"
                        limitRender="true">
                        <h:graphicImage
                            title="#{messages['processBuilder.addSwimlane']}"
                            url="#{a4jSkin.imgFolder}/add.gif" />
                    </a:commandLink>
                </h:form>
            </ui:define>

            <ui:define name="toolBar">
                <h:form>
                    <h:graphicImage
                        title="#{messages['processBuilder.removeSwimlane']}"
                        url="#{a4jSkin.imgFolder}/remove.png"
                        styleClass="opacityHover pointer">
                        <a:ajax event="click"
                            listener="#{swimlaneFitter.removeSwimlane(row)}"
                            execute="@this"
                            onbeforesubmit="return confirm('#{messages['processBuilder.confirm']}')"
                            render="swimlanesForm, swimlanesTable"
                            limitRender="true" />
                    </h:graphicImage>
                </h:form>
            </ui:define>

            <ui:define name="columns">
                <rich:column>
                    <h:form>
                        <f:facet name="header">#{messages['processBuilder.swimlanes']}</f:facet>
                        <ui:param name="current"
                            value="#{row == swimlaneFitter.currentSwimlane}" />
                        <ui:param name="styleNodeName"
                            value="#{current ? 'font-weight:bold' : ''}" />
                        <a:commandLink
                            action="#{swimlaneFitter.setCurrentSwimlane(row)}"
                            execute="@this" render="swimlanesForm,"
                            limitRender="true">
                            <h:outputText value="#{row.swimlane.name}" />
                        </a:commandLink>
                    </h:form>
                </rich:column>
            </ui:define>
        </ui:decorate>
    </s:div>

    <h:form id="swimlanesForm" styleClass="swimlane-form">
        <s:div rendered="#{!empty swimlaneFitter.currentSwimlane}">
            <wi:inputText id="swimlaneName"
                label="#{messages['processBuilder.swimlane.name']}"
                value="#{swimlaneFitter.currentSwimlane.name}">
                <a:ajax event="change" execute="@this"
                    limitRender="true" />
            </wi:inputText>
            <ui:decorate template="dataTable.xhtml">
                <ui:param name="values"
                    value="#{swimlaneFitter.currentSwimlane.perfilList}" />
                <ui:param name="id" value="localPapeis" />
                <ui:param name="styleClass" value="PerfilSwimlane" />
                <ui:define name="toolBar">
                    <h:graphicImage
                        title="#{messages['processBuilder.swimlane.removeUsuarioPerfil']}"
                        url="#{a4jSkin.imgFolder}/remove.png">
                        <a:ajax event="click"
                            listener="#{swimlaneFitter.currentSwimlane.removePerfil(row)}"
                            execute="@this"
                            onbeforesubmit="return confirm('#{messages['processBuilder.confirm']}')"
                            render="swimlanesForm" limitRender="true" />
                    </h:graphicImage>
                </ui:define>

                <ui:define name="columns">
                    <rich:column>
                        <f:facet name="header">#{messages['perfil.titlePage']}</f:facet>
                        <h:outputText value="#{row.descricao}" />
                    </rich:column>
                    <f:facet name="footer">
                        <rich:columnGroup>
                            <rich:column>
                                <h:graphicImage
                                    title="#{messages['processBuilder.swimlane.addLocalPapel']}"
                                    styleClass="pointer"
                                    id="novoLocPapel" url="#{a4jSkin.imgFolder}/add.gif">
                                    <a:ajax event="click"
                                        listener="#{swimlaneFitter.currentSwimlane.addPerfil()}"
                                        execute="@this, swimlaneName, localPapeis"
                                        render="swimlanesForm"
                                        limitRender="true" />
                                </h:graphicImage>
                            </rich:column>
                            <rich:column>
                                <wi:selectOneMenuEntity id="perfil"
                                    value="#{swimlaneFitter.currentSwimlane.perfil}" showLabelSelecione="true"
                                    items="#{swimlaneFitter.perfisDisponiveis}" required="true"/>
                            </rich:column>
                        </rich:columnGroup>
                    </f:facet>
                </ui:define>
            </ui:decorate>
        </s:div>
    </h:form>
</ui:composition>
