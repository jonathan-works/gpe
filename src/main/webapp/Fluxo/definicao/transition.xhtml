<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf">
    <rich:panel bodyClass="panel">
        <f:facet name="header">
            <h:panelGrid
                columns="2"
                cellpadding="0"
                cellspacing="0">
                <h:graphicImage
                    url="#{wiSkin.imageFolder}/jbpm/#{type == 'from' ? 'arriving' : 'leaving'}.gif" />
                <h:outputText
                    value="#{type == 'from' ? messages['process.transitions.arriving'] : messages['process.transitions.leaving']}" />
            </h:panelGrid>
        </f:facet>
        <ui:param
            name="values"
            value="#{type == 'from' ? transitionFitter.arrivingTransitions : transitionFitter.leavingTransitions}" />
        <rich:dataTable
            value="#{values}"
            id="transition#{type}Table"
            styleClass="tabelaVariaveis"
            var="transicaoHandler">
            <rich:column
                styleClass="dr-table-subheader rich-table-subheader"
                rendered="#{type eq 'to'}">
                <f:facet name="header">
                    <h:form>
                        <a:commandLink
                            action="#{transitionFitter.addTransition(type)}"
                            execute="@this"
                            rendered="#{type.equals('to')}"
                            render="transition#{type}Table,nodesDiv"
                            limitRender="true">
                            <h:graphicImage
                                title="#{infoxMessages['process.transition.add']}"
                                url="#{wiSkin.imageFolder}/add.gif" />
                        </a:commandLink>
                    </h:form>
                </f:facet>
                <div>
                    <div>
                        <h:form>
                            <h:graphicImage
                                title="#{infoxMessages['process.transition.remove']}"
                                url="#{wiSkin.imageFolder}/remove.png"
                                styleClass="opacityHover"
                                rendered="#{type eq 'to'}">
                                <a:ajax
                                    event="click"
                                    listener="#{transitionFitter.removeTransition(transicaoHandler, type)}"
                                    execute="@this"
                                    onbeforesubmit="if(!confirm('Confirma?')) return false;"
                                    render="transition#{type}Table,nodesDiv"
                                    limitRender="true" />
                            </h:graphicImage>
                        </h:form>
                    </div>
                </div>
            </rich:column>
            <rich:column rendered="#{type=='from'}">
                <f:facet name="header">#{infoxMessages['process.transition.origin']}</f:facet>
                <h:form>
                    <h:selectOneMenu
                        id="from"
                        valueChangeListener="#{nodeFitter.transitionChangeListener}"
                        rendered="#{empty transicaoHandler.from}"
                        value="#{transicaoHandler.from}">
                        <f:selectItems
                            value="#{nodeFitter.getNodesTransitionItems(type)}"
                            var="v" />
                        <a:ajax
                            event="change"
                            execute="@this"
                            render="transitionName,nodesDiv"
                            listener="#{transitionFitter.changeTransition(transicaoHandler, type)}"
                            limitRender="true" />
                    </h:selectOneMenu>
                    <h:outputText
                        rendered="#{!empty transicaoHandler.from}"
                        value="#{transicaoHandler.fromName}" />
                </h:form>
            </rich:column>
            <rich:column rendered="#{type=='to'}">
                <f:facet name="header">#{infoxMessages['process.transition.destination']}</f:facet>
                <h:form>
                    <h:selectOneMenu
                        id="to"
                        valueChangeListener="#{nodeFitter.transitionChangeListener}"
                        rendered="#{empty transicaoHandler.to}"
                        required="true"
                        value="#{transicaoHandler.to}">
                        <f:selectItems
                            value="#{nodeFitter.getNodesTransitionItems(type)}"
                            var="v" />
                        <a:ajax
                            event="change"
                            execute="@this"
                            render="transitionName,nodesDiv"
                            listener="#{transitionFitter.changeTransition(transicaoHandler, type)}"
                            limitRender="true" />
                    </h:selectOneMenu>
                    <h:outputText
                        rendered="#{!empty transicaoHandler.to}"
                        value="#{transicaoHandler.toName}" />
                </h:form>
            </rich:column>
            <rich:column id="transitionName">
                <f:facet name="header">#{infoxMessages['process.transition.name']}</f:facet>
                <h:form>
                    <h:inputText
                        value="#{transicaoHandler.name}"
                        required="true">
                        <a:ajax
                            event="change"
                            execute="@this"
                            render="transition#{type}Table"
                            limitRender="true" />
                    </h:inputText>
                    <a:commandLink
                        render="nodesDiv"
                        title="#{infoxMessages['process.transition.goto']}"
                        execute="@this"
                        action="#{nodeFitter.setCurrentNode(transicaoHandler, type)}"
                        limitRender="true">
                        <h:graphicImage
                            url="#{wiSkin.imageFolder}/jbpm/up.gif"
                            rendered="#{type == 'from'}" />
                        <h:graphicImage
                            url="#{wiSkin.imageFolder}/jbpm/down.gif"
                            rendered="#{type == 'to'}" />
                    </a:commandLink>
                </h:form>
            </rich:column>
            <rich:column id="occulTransitionButtonColumn" rendered="#{type eq 'to'}">
                <f:facet name="header">#{infoxMessages['process.transition.ocultar']}</f:facet>
                <h:form>
                    <center>
                        <h:selectBooleanCheckbox
                            id="occultTransitionButton"
                            value="#{transicaoHandler.occultTransitionButton}">
                            <a:ajax
                                event="change"
                                execute="@this"
                                listener="#{transitionFitter.setTransitionButton(transicaoHandler)}"
                                render="transition#{type}Table"
                                limitRender="true" />
                        </h:selectBooleanCheckbox>
                    </center>
                </h:form>
            </rich:column>
        </rich:dataTable>
    </rich:panel>
</ui:composition>
