<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
>
    <rich:panel bodyClass="panel">
        <f:facet name="header">
            <h:panelGrid
                columns="2"
                cellpadding="0"
                cellspacing="0"
            >
                <h:graphicImage
                    url="/img/jbpm/#{type == 'from' ? 'arriving' : 'leaving'}.gif"
                />
                <h:outputText
                    value="#{type == 'from' ? messages['process.transitions.arriving'] : messages['process.transitions.leaving']}"
                />
            </h:panelGrid>
        </f:facet>
        <ui:param
            name="values"
            value="#{type == 'from' ? transitionFitter.arrivingTransitions : transitionFitter.leavingTransitions}"
        />
        <rich:dataTable
            value="#{values}"
            id="transition#{type}Table"
            onrowmouseout="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
            onrowmouseover="this.style.backgroundColor='#{a4jSkin.tableSubfooterBackgroundColor}'"
            styleClass="tabelaVariaveis"
            var="transition"
        >
            <rich:column
                styleClass="dr-table-subheader rich-table-subheader"
                rendered="#{type eq 'to'}"
            >
                <f:facet name="header">
                    <h:form>
                        <a:commandLink
                            action="#{transitionFitter.addTransition(type)}"
                            execute="@this"
                            rendered="#{type.equals('to')}"
                            render="transition#{type}Table,nodesDiv"
                            limitRender="true"
                        >
                            <h:graphicImage
                                title="Adicionar transição"
                                url="/img/add.gif"
                            />
                        </a:commandLink>
                    </h:form>
                </f:facet>
                <div>
                    <div>
                        <h:form>
                            <h:graphicImage
                                title="Definir condição"
                                rendered="#{empty transition.transition.condition and transition.canDefineCondition()}"
                                url="/img/help_dis.gif"
                                styleClass="opacityHover"
                            >
                                <a:ajax
                                    event="click"
                                    listener="#{transitionFitter.setCurrentTransition(transition.transition)}"
                                    oncomplete="#{rich:component('transitionCondition')}.show()"
                                    render="transitionCondition"
                                    execute="@this"
                                    limitRender="true"
                                />
                            </h:graphicImage>
                            <h:graphicImage
                                title="Editar condição"
                                rendered="#{!empty transition.transition.condition and transition.transition.condition != '#{true}' and transition.canDefineCondition()}}"
                                styleClass="opacityHover"
                                url="/img/help.gif"
                            >
                                <a:ajax
                                    event="click"
                                    listener="#{transitionFitter.setCurrentTransition(transition.transition)}"
                                    oncomplete="#{rich:component('transitionCondition')}.show()"
                                    render="transitionCondition"
                                    limitRender="true"
                                    execute="@this"
                                />
                            </h:graphicImage>
                            <h:graphicImage
                                title="Excluir transição"
                                url="/img/remove.png"
                                styleClass="opacityHover"
                                rendered="#{type eq 'to'}"
                            >
                                <a:ajax
                                    event="click"
                                    listener="#{transitionFitter.removeTransition(transition, type)}"
                                    execute="@this"
                                    onbeforesubmit="if(!confirm('Confirma?')) return false;"
                                    render="transition#{type}Table,nodesDiv"
                                    limitRender="true"
                                />
                            </h:graphicImage>
                        </h:form>
                    </div>
                </div>
            </rich:column>
            <rich:column rendered="#{type=='from'}">
                <f:facet name="header">Nó Origem</f:facet>
                <h:form>
                    <h:selectOneMenu
                        id="from"
                        valueChangeListener="#{nodeFitter.transitionChangeListener}"
                        rendered="#{empty transition.from}"
                        value="#{transition.from}"
                    >
                        <f:selectItems
                            value="#{nodeFitter.getNodesTransitionItems(type)}"
                            var="v"
                        />
                        <a:ajax
                            event="change"
                            execute="@this"
                            render="transitionName,nodesDiv"
                            listener="#{transitionFitter.changeTransition(transition, type)}"
                            limitRender="true"
                        />
                    </h:selectOneMenu>
                    <h:outputText
                        rendered="#{!empty transition.from}"
                        value="#{transition.fromName}"
                    />
                </h:form>
            </rich:column>
            <rich:column rendered="#{type=='to'}">
                <f:facet name="header">Nó Destino</f:facet>
                <h:form>
                    <h:selectOneMenu
                        id="to"
                        valueChangeListener="#{nodeFitter.transitionChangeListener}"
                        rendered="#{empty transition.to}"
                        required="true"
                        value="#{transition.to}"
                    >
                        <f:selectItems
                            value="#{nodeFitter.getNodesTransitionItems(type)}"
                            var="v"
                        />
                        <a:ajax
                            event="change"
                            execute="@this"
                            render="transitionName,nodesDiv"
                            listener="#{transitionFitter.changeTransition(transition, type)}"
                            limitRender="true"
                        />
                    </h:selectOneMenu>
                    <h:outputText
                        rendered="#{!empty transition.to}"
                        value="#{transition.toName}"
                    />
                </h:form>
            </rich:column>
            <rich:column id="transitionName">
                <f:facet name="header">Nome</f:facet>
                <h:form>
                    <h:inputText
                        value="#{transition.name}"
                        required="true"
                    >
                        <a:ajax
                            event="change"
                            execute="@this"
                            render="transition#{type}Table"
                            limitRender="true"
                        />
                    </h:inputText>
                    <a:commandLink
                        render="nodesDiv"
                        title="Ir para o nó"
                        execute="@this"
                        action="#{nodeFitter.setCurrentNode(transition, type)}"
                        limitRender="true"
                    >
                        <h:graphicImage
                            url="/img/jbpm/up.gif"
                            rendered="#{type == 'from'}"
                        />
                        <h:graphicImage
                            url="/img/jbpm/down.gif"
                            rendered="#{type == 'to'}"
                        />
                    </a:commandLink>
                </h:form>
            </rich:column>
            <rich:column id="showTransitionButtonColumn">
                <f:facet name="header">Ocultar</f:facet>
                <h:form>
                    <center>
                        <h:selectBooleanCheckbox
                            id="showTransitionButton"
                            value="#{transition.showTransitionButton}"
                        >
                            <a:ajax
                                event="change"
                                execute="@this"
                                listener="#{transitionFitter.setTransitionButton(transition)}"
                                render="transition#{type}Table"
                                limitRender="true"
                            />
                        </h:selectBooleanCheckbox>
                    </center>
                </h:form>
            </rich:column>
        </rich:dataTable>
    </rich:panel>
</ui:composition>
