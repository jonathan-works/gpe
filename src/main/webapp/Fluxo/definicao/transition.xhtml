<?xml version="1.0" encoding="ISO-8859-1"?>
<ui:composition
	 xmlns:ui="http://java.sun.com/jsf/facelets"
	 xmlns="http://www.w3.org/1999/xhtml"
	 xmlns:a="http://richfaces.org/a4j"
	 xmlns:f="http://java.sun.com/jsf/core"
	 xmlns:h="http://java.sun.com/jsf/html"
	 xmlns:rich="http://richfaces.org/rich"
	 xmlns:s="http://jboss.org/schema/seam/taglib"
	 xmlns:wi="http://www.itx.com.br/jsf">
	

<!--
  IBPM - Ferramenta de produtividade Java
  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
 
  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
  Free Software Foundation; versão 2 da Licença.
  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
  
  Consulte a GNU GPL para mais detalhes.
  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
  veja em http://www.gnu.org/licenses/  
-->
<rich:panel
		 bodyClass="panel"
		 style="width:350px; margin:3px; padding:0; float:left">
		
	<f:facet name="header">
			
		<h:panelGrid
				 columns="2"
				 cellpadding="0"
				 cellspacing="0">
				
			<h:graphicImage
					 url="/img/jbpm/#{type == 'from' ? 'arriving' : 'leaving'}.gif"
					 style="margin-right:5px" />
			<h:outputText value="Transições que #{type == 'from' ? 'chegam ao' : 'saem do'} nó" />
		
			</h:panelGrid>
	
		</f:facet>
	<ui:param
			 name="values"
			 value="#{type == 'from' ? transitionFitter.arrivingTransitions : transitionFitter.leavingTransitions}" />
	<rich:dataTable
			 value="#{values}"
			 id="transition#{type}Table"
			 onrowmouseout="this.style.backgroundColor='#{a4jSkin.tableBackgroundColor}'"
			 onrowmouseover="this.style.backgroundColor='#{a4jSkin.tableSubfooterBackgroundColor}'"
			 styleClass="tabelaVariaveis"
			 style="width:100%"
			 var="transition">
			
		<rich:column
				 style="padding:2px; width: 45px"
				 styleClass="dr-table-subheader rich-table-subheader">
				
			<f:facet name="header">
					
				<a:commandLink
						 action="#{transitionFitter.addTransition(type)}"
						 execute="@this"
						 render="transition#{type}Table,nodesDiv"
						 limitRender="true">
						
					<h:graphicImage
							 title="Adicionar transição"
							 style="cursor:pointer"
							 url="/img/add.gif" />
				
					</a:commandLink>
			
				</f:facet>
			<div style="width: 99%; text-align: center;">
					
                <div>
						
					<h:graphicImage
							 title="Definir condição"
							 rendered="#{empty transition.transition.condition}"
							 style="cursor:pointer"
							 url="/img/help_dis.gif"
							 styleClass="opacityHover">
							
                        <!-- começa aqui -->
						<a:ajax
								 event="click"
								 listener="#{transitionFitter.setCurrentTransition(transition.transition)}"
								 oncomplete="#{rich:component('transitionCondition')}.show()"
								 render="transitionCondition"
								 limitRender="true" />
					
						</h:graphicImage>
					<h:graphicImage
							 title="Editar condição"
							 rendered="#{!empty transition.transition.condition and            transition.transition.condition != '#{true}'}"
							 styleClass="opacityHover"
							 style="cursor:pointer"
							 url="/img/help.gif">
							
						<a:ajax
								 event="click"
								 listener="#{transitionFitter.setCurrentTransition(transition.transition)}"
								 oncomplete="#{rich:component('transitionCondition')}.show()"
								 render="transitionCondition"
								 limitRender="true" />
					
						</h:graphicImage>
					<h:graphicImage
							 title="Excluir transição"
							 style="cursor:pointer"
							 url="/img/remove.png"
							 styleClass="opacityHover">
							
						<a:ajax
								 event="click"
								 listener="#{transitionFitter.removeTransition(transition, type)}"
								 execute="@this"
								 onbeforesubmit="if(!confirm('Confirma?')) return false;"
								 render="transition#{type}Table,nodesDiv"
								 limitRender="true" />
					
						</h:graphicImage>
				
					</div>
			
				</div>
		
		
			</rich:column>

		<rich:column
				 style="width:150px"
				 rendered="#{type=='from'}">
				
			<f:facet name="header">Nó Origem</f:facet>
			<h:selectOneMenu
					 id="from"
					 valueChangeListener="#{nodeFitter.transitionChangeListener}"
					 style="width:100%"
					 rendered="#{empty transition.from}"
					 value="#{transition.from}">
					
				<f:selectItems
						 value="#{nodeFitter.getNodesTransitionItems(type)}"
						 var="v" />
					<a:ajax
						 event="change"
						 execute="@this"
						 render="transitionName,nodesDiv"
						 listener="#{transitionFitter.changeTransition(transition, type)}"
						 limitRender="true" />
			
				</h:selectOneMenu>
			<h:outputText
					 style="#{!empty transition.transition.condition ? 'font-style:italic' : ''}"
					 rendered="#{!empty transition.from}"
					 value="#{transition.fromName}" />
		
			</rich:column>

		<rich:column
				 style="width:150px"
				 rendered="#{type=='to'}">
				
			<f:facet name="header">Nó Destino</f:facet>
			<h:selectOneMenu
					 id="to"
					 style="width:100%"
					 valueChangeListener="#{nodeFitter.transitionChangeListener}"
					 rendered="#{empty transition.to}"
					 required="true"
					 value="#{transition.to}">
					
				<f:selectItems
						 value="#{nodeFitter.getNodesTransitionItems(type)}"
						 var="v" />
				<a:ajax
						 event="change"
						 execute="@this"
						 render="transitionName,nodesDiv"
						 listener="#{transitionFitter.changeTransition(transition, type)}"
						 limitRender="true" />
			
				</h:selectOneMenu>
			<h:outputText
					 style="#{!empty transition.transition.condition ? 'font-style:italic' : ''}"
					 rendered="#{!empty transition.to}"
					 value="#{transition.toName}" />
		
			</rich:column>

		<rich:column
				 style="width:150px"
				 id="transitionName">
				
			<f:facet name="header">Nome</f:facet>
			<h:inputText
					 value="#{transition.name}"
					 required="true"
					 style="width:130px; float:left">
					
				<a:ajax
						 event="change"
						 execute="@this"
						 render="transition#{type}Table"
						 limitRender="true" />
			
				</h:inputText>
			<a:commandLink
					 render="nodesDiv"
					 title="Ir para o nó"
					 execute="@this"
					 style="float:right"
					 action="#{nodeFitter.setCurrentNode(transition, type)}"
					 limitRender="true">
					
				<h:graphicImage
						 url="/img/jbpm/up.gif"
						 rendered="#{type == 'from'}" />
				<h:graphicImage
						 url="/img/jbpm/down.gif"
						 rendered="#{type == 'to'}" />
			
				</a:commandLink>
		
			</rich:column>
		
		<rich:column
				 style="width:40px"
				 id="showTransitionButtonColumn">
				
			<f:facet name="header">Ocultar</f:facet>
			<center>
					
				<h:selectBooleanCheckbox
						 id="showTransitionButton"
						 value="#{transition.showTransitionButton}">
						
					<a:ajax
							 event="change"
							 listener="#{transitionFitter.setTransitionButton(transition)}"
							 render="transition#{type}Table"
							 limitRender="true" />
				
					</h:selectBooleanCheckbox>
			
				</center>
		
			</rich:column>
		
	
		</rich:dataTable>

	</rich:panel>


</ui:composition>
