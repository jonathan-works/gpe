<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:ui="http://java.sun.com/jsf/facelets">

	<h:outputScript name="jquery.js" library="js" />
	<h:outputStylesheet name="diagram-js.css" library="modelador/css" />
	<link type="text/css" href="#{pathResolver.contextPath}/resources/modelador/vendor/bpmn-font/css/bpmn.css" rel="stylesheet"></link>
	<h:outputScript name="bundle.js" library="modelador" />
	
	<p:outputPanel layout="block" id="modelador" style="background-color: white; height: 600px" />
	
	<h:inputHidden id="bpmn" value="#{bpmnView.fluxo.bpmn}" />
	
	<h:form id="modeladorForm">
		<a:jsFunction name="doUpdate" execute="@this" render=":processDefinition :pageBodyDialogMessage" action="#{bpmnView.update}"
			oncomplete="infox.hideLoading()">
			<a:param name="bpmnInformation" assignTo="#{bpmnView.bpmnInformation}"/>
		</a:jsFunction>
		<a:jsFunction name="configureElement" execute="@this" render=":processDefinition :pageBodyDialogMessage" action="#{bpmnView.configureElement}">
			<a:param name="elementKey" assignTo="#{bpmnView.elementKey}" />
		</a:jsFunction>
		<script>
			function updateBpmn() {
				doUpdate(JSON.stringify(modeler.getBpmnInformation()));
			}
		</script>
	</h:form>
	
	<script>
        var modeler = new InfoxBpmnModeler({
        	'container': document.getElementById("#{rich:clientId('modelador')}"),
        	'bpmn': document.getElementById("#{rich:clientId('bpmn')}").value
        });
    </script>
</ui:composition>