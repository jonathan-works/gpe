<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    xmlns:p="http://primefaces.org/ui"
>
    <rich:panel bodyClass="panel">
        <s:div id="timersDiv">
            <ui:param
                name="node"
                value="#{nodeFitter.nodeHandler}"
            />
            <ui:decorate template="dataTable.xhtml">
                <ui:param
                    name="values"
                    value="#{node.timerList}"
                />
                <ui:param
                    name="styleClass"
                    value="tabelaVariaveis"
                />
                <ui:param
                    name="id"
                    value="timersTable"
                />
                <ui:param
                    name="style"
                    value="width:100%"
                />
                <ui:define name="headerToolBar">
                    <h:form>
                        <a:commandLink
                            action="#{node.addTimer()}"
                            execute="@this"
                            immediate="true"
                            render="timersDiv,timerDiv"
                            limitRender="true"
                        >
                            <h:graphicImage
                                url="#{layoutController.getResourceUrlByPath('/imagens/add.gif')}"
                                title="#{infoxMessages['process.timer.new']}"
                            />
                        </a:commandLink>
                    </h:form>
                </ui:define>
                <ui:define name="toolBar">
                    <h:form>
                        <h:graphicImage
                            title="#{infoxMessages['process.timer.remove']}"
                            url="#{layoutController.getResourceUrlByPath('/imagens/remove.png')}"
                            styleClass="cursor-pointer"
                        >
                            <a:ajax
                                event="click"
                                listener="#{node.removeTimer(row)}"
                                onbeforesubmit="if(!confirm('Confirma?')) return false;"
                                execute="@this"
                                render="timersDiv,timerDiv"
                                limitRender="true"
                            />
                        </h:graphicImage>
                    </h:form>
                </ui:define>
                <ui:define name="columns">
                    <rich:column>
                        <f:facet name="header">#{infoxMessages['process.timer']}</f:facet>
                        <ui:param name="current" value="#{row == nodeFitter.nodeHandler.currentTimer}"/>
                        <ui:param name="styleTimerName" value="#{current ? 'font-weight:bold' : ''}"/>
                        <h:form>
                            <s:div>
                                <a:commandLink action="#{node.setCurrentTimer(row)}" execute="@this"
                                    render="timersDiv,timerDiv" limitRender="true">
                                    <h:outputText value="#{row.timerName}" />
                                </a:commandLink>
                            </s:div>
                        </h:form>
                    </rich:column>
                </ui:define>
            </ui:decorate>
        </s:div>
        <s:div id="timerDiv">
            <h:form>
                <s:div rendered="#{not empty node.currentTimer}">
                
                    <ui:param name="timer" value="#{node.currentTimer}"/>
                    
                    <wi:inputText id="name" value="#{node.timerName}" label="#{infoxMessages['process.timer.name']}">
                        <a:ajax execute="@this" limitRender="true" event="change" render="timersTable"/>
                    </wi:inputText>
                    
                    <wi:selectOneMenu id="transition" value="#{timer.transitionName}" label="#{infoxMessages['process.timer.transition']}" 
                        items="#{node.getTransitions()}" showLabelSelecione="true">
                        <a:ajax execute="@this" event="change" limitRender="true"/>
                    </wi:selectOneMenu>
                    
                    <wi:selectOneRadioEnum id="dueDateTypeRadio" value="#{node.dueDateType}" items="#{node.dueDateTypeValues}">
                    	<p:ajax process="@this" event="change" update="@(.dueDateTimer)" listener="#{node.onChangeDueDateType}"/>
                    </wi:selectOneRadioEnum>
                    
                    <p:outputPanel styleClass="dueDateTimer">
	                    <p:outputPanel rendered="#{node.dueDateType eq 'PERIOD'}">
		                    <wi:inputText id="duedatePeriod" value="#{node.dueDateValue}" widthDiv="50px" label="#{infoxMessages['process.timer.prazo']}">
		                        <a:ajax execute="@this" limitRender="true" event="change" listener="#{node.onChangeDueDate}"/>
		                    </wi:inputText>
		                    
		                    <wi:selectOneMenuEnum id="unit" value="#{node.dueDateUnit}" widthDiv="100px" label="#{infoxMessages['process.timer.prazo.unidade']}"
		                        items="#{node.dueDateDefaultUnit.values()}" showLabelSelecione="true" optionText="label">
		                        <a:ajax execute="@this" limitRender="true" event="change" listener="#{node.onChangeDueDate}"/>
		                    </wi:selectOneMenuEnum>
		                    
		                    <wi:selectBooleanCheckbox id="business" value="#{node.dueDateBusiness}" widthDiv="40px" label="#{infoxMessages['process.timer.business']}">
		                        <a:ajax execute="@this" limitRender="true" event="change" listener="#{node.onChangeDueDate}"/>
		                    </wi:selectBooleanCheckbox>
	                    </p:outputPanel>
	                    
	                    <p:outputPanel rendered="#{node.dueDateType eq 'DATE'}">
		                    <wi:inputDate id="dueDateDate" value="#{node.dueDateDate}" widthDiv="255px" label="#{infoxMessages['process.timer.data']}"
		                    	pattern="dd/MM/yyyy HH:mm">
		                        <a:ajax execute="@this" limitRender="true" event="change" listener="#{node.onChangeDueDate}"/>
		                    </wi:inputDate>
	                    </p:outputPanel>
	                    
	                    <p:outputPanel rendered="#{node.dueDateType eq 'EXPRESSION'}">
		                    <wi:inputText id="dueDateExpression" value="#{node.dueDateExpression}" widthDiv="50px" label="#{infoxMessages['process.timer.expressao']}">
		                        <a:ajax execute="@this" limitRender="true" event="change" listener="#{node.onChangeDueDate}"/>
		                        <f:validator validatorId="javax.faces.elValidator"/>
		                    </wi:inputText>
	                    </p:outputPanel>
                     </p:outputPanel>
                </s:div>
            </h:form>
        </s:div>
    </rich:panel>
</ui:composition>
