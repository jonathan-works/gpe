<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:wi="http://www.itx.com.br/jsf">


    <wi:dataTable id="modeloPastaTable"
        bean="#{modeloPastaList}"
        values="#{modeloPastaList.list(15)}"
        rowId="#{row.id}" >

        <ui:define name="searchForm">
            <wi:searchForm formId="modeloPastaSearchForm" 
                formTitle="#{infoxMessages['searchForm.title']}">
                
            <wi:inputText id="nome" value="#{modeloPastaList.entity.nome}"
                    label="#{infoxMessages['modeloPasta.nome']}" />
                   
                <ui:define name="buttons">
					<wi:commandButton id="searchButton"
						value="#{infoxMessages['button.pesquisar']}"
						action="#{searchAction}" styleClass="buttons"
						reRender="#{wi:get(searchReRender, 'pageBody')}">
						<a:param assignTo="#{bean.page}" value="1" />
					</wi:commandButton>
						<a:commandButton id="clearButton"
							onclick="$('##{formId}').clearForm();showLoading();"
							oncomplete="hideLoading();"
							action="#{elFunctions.invokeMethod(clearAction)}"
							value="#{infoxMessages['button.limpar']}" execute="@this"
							render="#{wi:get(clearReRender, 'pageBody')}"
							styleClass="buttons" />
					<wi:commandButton id="addModeloPastaBtn"
						value="#{infoxMessages['modeloPasta.add']}"
						onclick="#{rich:component('anexarModeloPastaPanel')}.show();"
						action="#{modeloPastaRestricaoAction.newInstance()}"/>
					<!-- rendered="#{s:hasPermission('/pages/Pasta/adicionarPasta', 'access')}" -->
				</ui:define>
                     
            </wi:searchForm>
        </ui:define>

        <ui:define name="headerToolBar" />
        <ui:define name="toolBar">      
        	<a:commandLink action="#{modeloPastaRestricaoAction.selectModeloPasta(row)}" 
				execute="@this" limitRender="true" rendered="true"
				render="pastaRestricaoDiv"
				onclick="infox.showLoading();" oncomplete="infox.hideLoading();">
			<h:graphicImage url="#{wiSkin.imageFolder}/view.png" title="#{infoxMessages['modeloPasta.restricoes']}" />
			</a:commandLink>
        </ui:define>
        <wi:columnOutputText columnId="nome"
            columnHeader="#{infoxMessages['modeloPasta.nome']}"
            value="#{row.nome}" />
        <wi:columnOutputText columnId="descricao"
            columnHeader="#{infoxMessages['modeloPasta.descricao']}"
            value="#{row.descricao}" />
        <wi:columnBoolean
	       	columnId="editavel"
	        columnHeader="#{infoxMessages['modeloPasta.editavel']}"
      		value="#{row.editavel}" />
        <wi:columnBoolean
	       	columnId="removivel"
	        columnHeader="#{infoxMessages['modeloPasta.removivel']}"
      		value="#{row.removivel}" />
      	<wi:columnOutputText
	       	columnId="ordem"
	        columnHeader="#{infoxMessages['modeloPasta.ordem']}"
      		value="#{row.ordem}" />
    </wi:dataTable>

    <br />
		<s:div id="modeloPastaRestricaoDiv">
	<br />
			<wi:dataTable id="modeloPastaRestricaoTable"
				values="#{modeloPastaRestricaoAction.restricoes}" rowId="#{row.id}"
				showSearchForm="false" showGrid="#{modeloPastaRestricaoAction.modeloPastaSelecionada}"
				tableTitle="#{infoxMessages['modeloPasta.restricoes']} - #{modeloPastaRestricaoAction.instance}">

				<ui:define name="headerToolBar" />
				<ui:define name="toolBar">
					<wi:toolBar id="viewPastaRestricao" rendered="true"
						reRender="pastaRestricaoDiv" url="#{wiSkin.imageFolder}/view.png" />
					<wi:toolBar id="removePastaRestricao" rendered="true"
						reRender="pastaRestricaoDiv"
						url="#{wiSkin.imageFolder}/remove.png" />
				</ui:define>
				
				<wi:columnEnum columnId="restricaoTipo"
					columnHeader="#{infoxMessages['pasta.tipoRestricao']}"
					value="#{row.tipoPastaRestricao}" />
				<wi:columnOutputText columnId="restricaoAlvo"
					columnHeader="#{infoxMessages['pasta.restricaoAlvo']}" value="#{row.alvo}" />
				<wi:columnBoolean columnId="restricaoVisualizar"
					columnHeader="#{infoxMessages['pasta.visualizarRestricao']}"
					value="#{row.read}" />
				<wi:columnBoolean columnId="restricaoInserir"
					columnHeader="#{infoxMessages['pasta.inserirRestricao']}"
					value="#{row.write}" />
				<wi:columnBoolean columnId="restricaoRetirar"
					columnHeader="#{infoxMessages['pasta.retirarRestricao']}"
					value="#{row.delete}" />
			</wi:dataTable>

			<wi:commandButton id="addRestricaoButton" 
				value="#{infoxMessages['pasta.adicionarRestricao']}" 
				rendered="#{pastaRestricaoAction.pastaSelecionada}" />
		</s:div>
	<script type="text/javascript">
      function clearAnexarModeloPastaFields() {
    		#{rich:jQuery('anexarPastaInputName')}.val('');
    		#{rich:jQuery('anexarPastaInputDescricao')}.val('');
    		$('.errorFields.errors').remove();
    	    $('.errors').removeClass('errors');
      }
  </script>

	<rich:popupPanel
    id="anexarModeloPastaPanel"
    moveable="true"
    show="false"
    resizeable="false"
    minHeight="260"
    header="#{infoxMessages['modeloPasta.add']}"
    onbeforehide="clearAnexarModeloPastaFields();">
    <f:facet name="controls">
      <h:graphicImage
        id="modeloPastaPanelCloseBtn"
        styleClass="mp-close"
        value="#{wiSkin.imageFolder}/closeMP.gif"
        onmouseup="#{rich:component('anexarModeloPastaPanel')}.hide();" />
      </f:facet>
      <h:form id="anexarModeloPastaForm">
        <wi:inputText
          	id="anexarModeloPastaInputName"
          	value="#{modeloPastaRestricaoAction.nome}"
          	required="true"
          	maxlength="250"
        	label="#{infoxMessages['modeloPasta.nome']}">
        </wi:inputText>
		<wi:inputText
        	id="anexarModeloPastaInputDescricao"
        	value="#{modeloPastaRestricaoAction.descricao}"
        	required="false"
        	maxlength="250"
        	label="#{infoxMessages['modeloPasta.descricao']}">
        </wi:inputText>	
   		<wi:inputNumber
        	id="anexarModeloPastaInputOrdem"
        	value="#{modeloPastaRestricaoAction.ordem}"
        	required="true"
        	maxlength="19"
        	label="#{infoxMessages['modeloPasta.ordem']}">
	    </wi:inputNumber>
        <br />
        <wi:commandButton
          id="addModeloPastaButton"
          action="#{modeloPastaRestricaoAction.persist()}"
          execute="@form"
          oncomplete="if(#{not facesContext.validationFailed}){#{rich:component('anexarModeloPastaPanel')}.hide();}else{clearAnexarModeloPastaFields()}"
          value="#{infoxMessages['modeloPasta.add']}"
          reRender="@form, modeloPastaTable, modeloPastaRestricaoDiv" />
          <!-- ver onde é que está esse pastaTablePanel -->
      </h:form>
    </rich:popupPanel>
    
</ui:composition>