<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:wi="http://www.itx.com.br/jsf"
>
    <s:div id="#{id}Action">
        <a:commandLink
            id="#{id}Link"
            render="actionTemplate"
            onclick="idTextarea='form:nodes:nodeEventeventSubView:nodeEventAction:nodeEventActionExpressionDecoration:nodeEventActionExpression'"
            action="#{event.setTemplate()}"
            limitRender="true"
            rendered="false"
            oncomplete="#{rich:component('actionTemplatePanel')}.show()"
        >
            <h:graphicImage
                url="#{layoutController.getResourceUrlByPath('/imagens/jbpm/wizard.gif')}"
                title="Assistente para expressÃ£o"
            />
        </a:commandLink>
        <wi:inputTextarea
            id="#{id}ActionExpression"
            value="#{event.currentAction.actionExpression}"
            label="#{infoxMessages['process.events.action.expression']}"
            showCounter="false"
            styleClass="textAreaExpressionAction"
        >
        	<f:validator validatorId="jbpmExpressionValidator" />
            <a:ajax
                event="change"
                limitRender="true"
                execute="@this"
                render="pageBodyDialogMessage :processDefinition:eventsForm:nodeEventActionExpressionDecoration"
            />
        </wi:inputTextarea>
        <div style="display: inline-block">
            <h:graphicImage id="#{id}helpEditTipImg" url="#{layoutController.getResourceUrlByPath('/imagens/help.gif')}"
                onclick="#{rich:component('expressoesAjudaPopUpPanel')}.show();" />
        </div>
    </s:div>
    <script type="text/javascript">
        function onshowPopup() {
            var value = $('.expressoesAjudaPopUpPanel');
            var width = $(window).width() * 0.85;
            var height = $(window).height() * 0.85;
            var top = (($(window).height() - height) / 3);
            var left = (($(window).width() - width) / 2);
            value.css('width', width + 'px');
            value.css('height', height + 'px');
            value.css('top', top + 'px');
            value.css('left', left + 'px');
            $('.rf-pp-cnt-scrlr').css('width', '100%');
            $('.rf-pp-cnt-scrlr').css('height', '100%');
        }
    </script>
    <rich:popupPanel id="expressoesAjudaPopUpPanel" modal="true" header="#{infoxMessages['process.events.expression.title']}" resizeable="true"
        styleClass="expressoesAjudaPopUpPanel" onshow="onshowPopup();">
        
        <script type="text/javascript">
	    	function onSelectBpmnExpression(obj) {
	    		var text = $($(obj).children().get(1)).text();
	    		#{rich:component('expressoesAjudaPopUpPanel')}.hide();
	    		$('.textAreaExpressionAction').text(text);
	    		$('.textAreaExpressionAction').change();
	    	}
	    </script>
	    
        <f:facet name="controls">
            <h:graphicImage id="assinarDocumentosPopUpPanelCloseBtn" styleClass="mp-close"
                value="#{layoutController.getResourceUrlByPath('/imagens/closeMP.gif')}"
                onclick="#{rich:component('expressoesAjudaPopUpPanel')}.hide();" />
        </f:facet>
        <ui:include src="actionHelp.xhtml" />
    </rich:popupPanel>
</ui:composition>
