<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
>
    <ui:decorate template="dataTable.xhtml">
        <ui:param
            name="values"
            value="#{definicaoVariavelProcessoAction.listVariaveis(5)}"
        />
        <ui:param
            name="id"
            value="variavelTable"
        />
        <ui:define name="headerToolBar">
            <h:form>
                <a:commandLink
                    action="#{definicaoVariavelProcessoAction.adicionarVariavel}"
                    execute="@this"
                    render="variavelTable, variavelForm, pageBodyDialogMessage"
                    limitRender="true"
                >
                    <h:graphicImage
                        title="#{infoxMessages['definicaoVariavelProcesso.addVariavel']}"
                        url="#{layoutController.getResourceUrlByPath('/imagens/add.gif')}"
                    />
                </a:commandLink>
            </h:form>
        </ui:define>
        <ui:define name="toolBar">
            <h:form>
                <h:graphicImage
                    title="#{infoxMessages['definicaoVariavelProcesso.removeVariavel']}"
                    url="#{layoutController.getResourceUrlByPath('/imagens/remove.png')}"
                    styleClass="opacityHover pointer"
                >
                    <a:ajax
                        event="click"
                        listener="#{definicaoVariavelProcessoAction.remove(row)}"
                        execute="@this"
                        onbeforesubmit="return confirm('#{infoxMessages['processBuilder.confirm']}')"
                        render="variavelTable, variavelForm, pageBodyDialogMessage, variavelPaginator"
                        limitRender="true"
                    />
                </h:graphicImage>
                <h:graphicImage title="#{infoxMessages['process.node.up']}" rendered="#{row.ordem gt 0}"
	                url="#{layoutController.getResourceUrlByPath('/imagens/jbpm/up.gif')}" styleClass="opacityHover">
	                <a:ajax event="click" listener="#{definicaoVariavelProcessoAction.moveUp(row)}" execute="@this" render="variavelTable" limitRender="true" />
	            </h:graphicImage>
	            <h:graphicImage title="#{infoxMessages['process.node.down']}" rendered="#{row.ordem lt definicaoVariavelProcessoAction.maiorOrdem}"
	                url="#{layoutController.getResourceUrlByPath('/imagens/jbpm/down.gif')}" styleClass="opacityHover">
	                <a:ajax event="click" listener="#{definicaoVariavelProcessoAction.moveDown(row)}" execute="@this" render="variavelTable" limitRender="true" />
	            </h:graphicImage>
            </h:form>
        </ui:define>
        <ui:define name="columns">
            <rich:column>
                <h:form>
                    <f:facet name="header">#{infoxMessages['processBuilder.definicaoVariavelProcesso']}</f:facet>
                    <ui:param
                        name="current"
                        value="#{row == definicaoVariavelProcessoAction.instance}"
                    />
                    <ui:param
                        name="styleNodeName"
                        value="#{current ? 'font-weight:bold' : ''}"
                    />
                    <a:commandLink
                        action="#{definicaoVariavelProcessoAction.setVariavel(row)}"
                        execute="@this"
                        render="variavelForm"
                        limitRender="true"
                    >
                        <h:outputText
                            value="#{definicaoVariavelProcessoAction.getNomeAmigavel(row)}"
                        />
                    </a:commandLink>
                </h:form>
            </rich:column>
        </ui:define>
    </ui:decorate>
    <h:form>
        <rich:inputNumberSlider
            value="#{definicaoVariavelProcessoAction.page}"
            minValue="1"
            maxValue="#{definicaoVariavelProcessoAction.maxPages}"
            enableManualInput="false"
            id="variavelPaginator"
            rendered="#{definicaoVariavelProcessoAction.maxPages gt 1}"
        >
            <a:ajax
                event="change"
                render="variavelTable, @form"
                limitRender="true"
            />
        </rich:inputNumberSlider>
    </h:form>
    <h:form id="variavelForm">
        <ui:fragment
            rendered="#{not empty definicaoVariavelProcessoAction.variavel}"
        >
            <s:div>
                <wi:inputText
                    id="nomeVariavel"
                    label="#{infoxMessages['definicaoVariavelProcesso.nome']}"
                    required="true"
                    value="#{definicaoVariavelProcessoAction.nomeAmigavel}"
                />
                <wi:inputText
                    id="labelProcesso"
                    label="#{infoxMessages['definicaoVariavelProcesso.label']}"
                    required="true"
                    value="#{definicaoVariavelProcessoAction.variavel.label}"
                />
                <wi:inputText
                    id="defaultValue"
                    label="#{infoxMessages['definicaoVariavelProcesso.valorPadrao']}"
                    required="false"
                    value="#{definicaoVariavelProcessoAction.variavel.valorPadrao}"
                />
                <wi:selectBooleanCheckbox
                	id="variavelVisivel"
                	label="#{infoxMessages['definicaoVariavelProcesso.visivel']}"
                	value="#{definicaoVariavelProcessoAction.variavel.visivel}" />
                <wi:selectBooleanCheckbox
                    id="variavelVisivelPainel"
                    label="#{infoxMessages['definicaoVariavelProcesso.visivelPainel']}"
                    value="#{definicaoVariavelProcessoAction.variavel.visivelPainel}" />
            </s:div>
            <wi:commandButton
            	id="buttonDefinicaoVariavelPersist"
                action="definicaoVariavelProcessoAction.persist"
                reRender="variavelForm, variavelTable, pageBodyDialogMessage, variavelPaginator"
                rendered="#{not definicaoVariavelProcessoAction.persisted}"
                value="#{messages['crud.persist']}" />
            <wi:commandButton
            	id="buttonDefinicaoVariavelUpdate"
                action="definicaoVariavelProcessoAction.update"
                reRender="variavelForm, variavelTable, pageBodyDialogMessage, variavelPaginator"
                rendered="#{definicaoVariavelProcessoAction.persisted}"
                value="#{messages['crud.update']}" />
        </ui:fragment>
    </h:form>
</ui:composition>
