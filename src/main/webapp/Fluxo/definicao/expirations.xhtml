<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf" >

    <ui:param name="task" value="#{taskFitter.currentTask}" />
    <ui:param name="tarefa" value="#{taskFitter.tarefaAtual}" />
    
    <rich:panel bodyClass="panel" header="#{infoxMessages['process.expiration.expirationDate']}" id="expirationPanel">
        <h:panelGroup id="expirationPanelGroup" rendered="#{taskFitter.hasTaskExpiration()}">
            <rich:dataTable styleClass="dtable-p rf-dt-crud" id="expirationTable" value="#{taskFitter.taskExpiration}" var="row">
                <rich:column>
                    <h:form>
                        <a:commandLink action="#{taskFitter.removeExpiration(row)}" execute="@this" render="expirationPanel" limitRender="true">
                            <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/remove.png')}" title="#{infoxMessages['button.delete']}" />
                        </a:commandLink>
                    </h:form>
                </rich:column>
                <rich:column>
                    <f:facet name="header">#{infoxMessages['process.expiration.expirationDate']}</f:facet>
                    <h:outputText value="#{row.expiration}">
                        <f:convertDateTime pattern="dd/MM/yyyy" />
                    </h:outputText>
                </rich:column>
                <rich:column>
                    <f:facet name="header">#{infoxMessages['process.expiration.transition']}</f:facet>
                    <h:outputText value="#{row.transition}" />
                </rich:column>
            </rich:dataTable>
        </h:panelGroup>
        <h:form id="expirationForm" rendered="#{not taskFitter.hasTaskExpiration()}">
            <wi:inputDate id="expirationDate" value="#{taskFitter.taskExpiration.expiration}" required="true" future="true" 
                label="#{infoxMessages['process.expiration.expirationDate']}">
                <a:ajax event="change" execute="@this" render="expirationDateDecoration, pageBodyDialogMessage" limitRender="true" />
            </wi:inputDate>
            <wi:selectOneMenu id="transition" value="#{taskFitter.taskExpiration.transition}"
                label="#{infoxMessages['process.expiration.transition']}" items="#{task.transitions}" 
                showLabelSelecione="true" required="true">
                <a:ajax event="change"  execute="@this" render="transitionDecoration, pageBodyDialogMessage" limitRender="true" />
            </wi:selectOneMenu>
            <div />
            <wi:commandButton id="gravarExpiration" action="#{taskFitter.addExpiration()}" 
                value="#{infoxMessages['process.expiration.incluir']}" reRender="expirationPanel"/>
        </h:form>
    </rich:panel>
</ui:composition>
