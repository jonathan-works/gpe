<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:infox="http://www.infox.com.br/jsf"
  template="/WEB-INF/xhtml/templates/minimal.xhtml">
  <ui:define name="title">#{infoxMessages['fluxo.titlePage']}: #{processBuilder.instance.name}</ui:define>
  <ui:define name="head">
    <h:outputScript
      name="jbpmGraph.js"
      library="js" />
    <h:outputScript
      name="underscore.js"
      library="js" />
  </ui:define>
  <ui:define name="body">
    <ui:param
      name="def"
      value="#{processBuilder.instance}" />
    <infox:tabPanel
      switchType="ajax"
      activeTab="#{processBuilder.tab}"
      id="processDefinition">
      <h:form>
        <infox:tabHeaders />
      </h:form>
      <infox:tab
        name="propriedadesTab"
        id="propriedadesTab"
        title="#{infoxMessages['processBuilder.properties']}">
        <rich:panel header="#{infoxMessages['processBuilder.info']}">
          <h:form>
            <wi:inputText
              id="codFluxo"
              label="#{infoxMessages['fluxo.codFluxo']}"
              value="#{processBuilder.id}"
              readonly="true">
              <f:validator validatorId="jsfComponentIdValidator" />
            </wi:inputText>
            <wi:inputText
              id="nome"
              label="#{infoxMessages['fluxo.fluxo']}"
              value="#{def.name}"
              readonly="true" />
            <wi:inputTextarea
              id="description"
              value="#{def.description}"
              label="#{infoxMessages['processBuilder.description']}"
              showCounter="false">
              <a:ajax
                event="change"
                execute="@this" />
            </wi:inputTextarea>
          </h:form>
        </rich:panel>
        <rich:panel
          header="#{infoxMessages['processBuilder.definicaoVariavelProcesso']}"
          rendered="#{processBuilder.exists}">
          <ui:include src="definicaoVariavelProcesso.xhtml" />
        </rich:panel>
        <rich:panel
          styleClass="SwimlanePanel"
          header="#{infoxMessages['processBuilder.swimlanes']}"
          rendered="#{processBuilder.exists}">
          <ui:include src="swimlanes.xhtml" />
        </rich:panel>
      </infox:tab>
      <infox:tab
        name="nodesTab"
        id="nodesTab"
        rendered="#{processBuilder.exists}"
        title="#{infoxMessages['processBuilder.nodes']}">
        <ui:include src="nodes.xhtml" />
      </infox:tab>
      <infox:tab
        name="graphTab"
        id="graphTab"
        title="#{infoxMessages['processBuilder.graph']}">
        <ui:include src="graph.xhtml" />
      </infox:tab>
    </infox:tabPanel>
    <h:form id="processDefinitionButtonsForm">
      <h:outputScript>
        function checkIfEditorExists() {
          if (typeof infox.editor!=="undefined") {
            for(var key in infox.editor) {
              infox.editor[key].instance.fire("blur");
            }
          }
          updateFluxo();
        }
      </h:outputScript>
      <a:jsFunction
        name="updateFluxo"
        actionListener="#{processBuilder.prepareUpdate}"
        action="#{processBuilder.update}"></a:jsFunction>
      <a:commandButton
        id="gravar"
        value="#{infoxMessages['processBuilder.saveBtn']}"
        rendered="#{processBuilder.exists}"
        styleClass="buttons #{wi:get(styleClass, '')}"
        onclick="checkIfEditorExists();" />
      <a:commandButton
        id="publicar"
        actionListener="#{processBuilder.prepareUpdate}"
        action="#{processBuilder.deploy}"
        value="#{infoxMessages['processBuilder.deployBtn']}"
        rendered="#{processBuilder.exists}"
        oncomplete="opener.refreshPage();"
        styleClass="buttons #{wi:get(styleClass, '')}" />
      <a:commandButton
        id="novoProcesso"
        actionListener="#{processBuilder.prepareUpdate}"
        action="#{processBuilder.update}"
        value="#{infoxMessages['processBuilder.saveBtn']}"
        rendered="#{!processBuilder.exists}"
        styleClass="buttons #{wi:get(styleClass, '')}" />
      <a:commandButton
        id="new"
        action="#{processBuilder.clearDefinition}"
        value="#{infoxMessages['processBuilder.newBtn']}"
        render=":processDefinition, @form"
        onclick="return confirm('#{infoxMessages['processBuilder.confirmNew']}');"
        rendered="#{processBuilder.exists}"
        styleClass="buttons #{wi:get(styleClass, '')}" />
    </h:form>
    <s:div id="actionTemplate">
      <wi:modalPanel
        id="actionTemplatePanel"
        height="550"
        width="920">
        <c:if
          test="#{!empty actionTemplate.fileName or !empty taskFitter.currentTask.currentVariable}">
          <ui:include src="actions/#{actionTemplate.fileName}" />
        </c:if>
      </wi:modalPanel>
    </s:div>
    <wi:modalPanel
      id="dominioVariavelTarefaPanel"
      height="550"
      width="920"
      onbeforehide="renderDominio()">
      <ui:include src="actions/dominioVariavelTarefa.xhtml" />
    </wi:modalPanel>
    <wi:modalPanel
      id="classificacoesParaVariavelPanel"
      height="550"
      width="920">
      <ui:include src="actions/addClassificacaoDocumento.xhtml" />
    </wi:modalPanel>
  </ui:define>
</ui:composition>
