<?xml version="1.0" encoding="ISO-8859-1"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://www.jboss.org/schema/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:wi= "http://www.itx.com.br/jsf"
                xmlns:f="http://java.sun.com/jsf/core"
				xmlns:c="http://java.sun.com/jstl/core"
		        xmlns:a="http://richfaces.org/a4j"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich"
                template="/WEB-INF/xhtml/templates/minimal.xhtml">
<!--
  IBPM - Ferramenta de produtividade Java
  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
 
  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
  Free Software Foundation; versão 2 da Licença.
  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
  
  Consulte a GNU GPL para mais detalhes.
  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
  veja em http://www.gnu.org/licenses/  
-->
<ui:define name="title">Definição do processo: #{processBuilder.instance.name}</ui:define>

<ui:define name="body">

	<a:loadStyle src="processDefinition.css" />
	<a:loadScript src="/js/jbpmGraph.js" />

	<ui:param name="def" value="#{processBuilder.instance}" />
	
	<a:form id="form">
	
	<rich:tabPanel style="height:550px"
		selectedTab="#{processBuilder.tab}"
		switchType="support" headerSpacing="2">
		<rich:tab label="Propriedades">
			<rich:panel style="clear:both; overflow:auto; padding-bottom:5px"
				header="Dados gerais" >
				<wi:inputText label="Identificador" 
					required="#{! processBuilder.exists}"
					readonly="true"
					id="id" value="#{processBuilder.id}">
					<f:validator validatorId="idValidator" />
					<wi:ajaxSupport reRender="idDecoration"/>
				</wi:inputText>

				<wi:inputText label="Nome do processo" 
					required="true"
					readonly="true"
					id="nome" value="#{def.name}">
					<wi:ajaxSupport reRender="nomeDecoration"/>
				</wi:inputText>
				
				<wi:inputTextarea id="description" value="#{def.description}" 
					label="Descrição">
					<wi:ajaxSupport/>
				</wi:inputTextarea> 
			</rich:panel>
			
			<rich:panel style="clear:both; overflow:auto; padding-bottom:5px; margin-top:5px" 
				header="Raias (swimlanes)" 
				rendered="#{processBuilder.exists}">
				<ui:include src="swimlanes.xhtml" />
			</rich:panel>
		</rich:tab>
		
		<rich:tab label="Nós" id="nodesTab" rendered="#{processBuilder.exists}">
			<ui:include src="nodes.xhtml" />
		</rich:tab>
		
			<ui:remove>
	<!--		<rich:tab label="Eventos" id="events" rendered="#{processBuilder.exists}">-->
	<!--			<rich:panel header="Eventos">-->
	<!--				<ui:include src="events.xhtml">-->
	<!--					<ui:param name="parent" value="#{processBuilder}" />-->
	<!--					<ui:param name="id" value="processEvent" />-->
	<!--				</ui:include>-->
	<!--			</rich:panel>-->
	<!--		</rich:tab>-->
			</ui:remove>
		
		<rich:tab label="XML" id="xmlTab" 
			rendered="#{processBuilder.exists}">
			<ui:include src="xmlEdit.xhtml" />
		</rich:tab>

		<rich:tab label="Gráfico" id="graphTab" >
			<ui:include src="graph.xhtml" />
		</rich:tab>
	</rich:tabPanel>
	
	<h:commandButton styleClass="dr-tbpnl-tb-inact"
		id="gravar"
		action="#{processBuilder.update()}"
		value="Gravar" type="submit" 
		rendered="#{processBuilder.exists}"/>

	<a:commandButton styleClass="dr-tbpnl-tb-inact"
		id="publicar"
		ajaxSingle="true"
		reRender="form"
		action="#{processBuilder.deploy()}"
		value="Publicar" type="submit" 
		rendered="#{processBuilder.exists}"/>

	<h:commandButton styleClass="dr-tbpnl-tb-inact"
		id="novoProcesso"
		action="#{processBuilder.update()}"
		value="Gravar" type="submit" 
		rendered="#{!processBuilder.exists}"
		reRender="pageBody"/>

	<h:commandButton styleClass="dr-tbpnl-tb-inact"
					 id="new"
					 action="#{processBuilder.clearDefinition()}"
					 value="Novo" 
					 type="submit"
					 onclick="if(!confirm('Confirma apagar toda a definição desse Fluxo? Será criada uma nova e não é possível desfazer.')) return false;" 
					 rendered="#{processBuilder.exists}"/>

	<h:commandButton styleClass="dr-tbpnl-tb-inact"
					 id="test"
					 action="#{processoHome.test()}"
					 value="Testar" 
					 type="submit" 
					 rendered="#{false and processBuilder.exists}"/>

	</a:form>

	<rich:messages id="messages" style="color:red" ajaxRendered="true" globalOnly="false" />

	<s:div id="actionTemplate">
		<wi:modalPanel id="actionTemplatePanel"
					   style="padding:0"
					   height="550" 
					   width="920">
			<c:if test="#{!empty actionTemplate.fileName or !empty processBuilder.currentTask.currentVariable}">
				<ui:include src="actions/#{actionTemplate.fileName}" />
			</c:if>
		</wi:modalPanel>
	</s:div>

</ui:define> 

</ui:composition>