<?xml version="1.0" encoding="ISO-8859-1"?>

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:s="http://jboss.org/schema/seam/taglib"
                xmlns:ui="http://java.sun.com/jsf/facelets"
				xmlns:wi= "http://www.itx.com.br/jsf"
                xmlns:f="http://java.sun.com/jsf/core"
				xmlns:c="http://java.sun.com/jsp/jstl/core"
		        xmlns:a="http://richfaces.org/a4j"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:rich="http://richfaces.org/rich"
                template="/WEB-INF/xhtml/templates/minimal.xhtml">
<!--
  IBPM - Ferramenta de produtividade Java
  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
 
  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
  Free Software Foundation; versão 2 da Licença.
  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
  
  Consulte a GNU GPL para mais detalhes.
  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
  veja em http://www.gnu.org/licenses/  
-->
<ui:define name="title">#{messages['fluxo.titlePage']}: #{processBuilder.instance.name}</ui:define>

<ui:define name="body">

	<h:outputStylesheet name="processDefinition.css" library="stylesheet"/>
	<h:outputScript name="jbpmGraph.js" library="js"/>
    <h:outputScript name="underscore.js" library="js"/>

	<ui:param name="def" value="#{processBuilder.instance}" />
	
	<h:form id="form">
	
	<rich:tabPanel style="height:550px"
		activeItem="#{processBuilder.tab}"
		switchType="ajax">
		<rich:tab header="#{messages['processBuilder.properties']}" name="propriedadesTab" id="propriedadesTab">
			<rich:panel style="clear:both; overflow:auto; padding-bottom:5px"
				header="#{messages['processBuilder.info']}" >
				<wi:inputText id="codFluxo" 
                              label="#{messages['fluxo.codFluxo']}"
                              value="#{processBuilder.id}" 
					          readonly="true">
					<f:validator validatorId="idValidator" />
				</wi:inputText>

				<wi:inputText id="nome"
                              label="#{messages['fluxo.fluxo']}"
                              value="#{def.name}" 
                              readonly="true">
				</wi:inputText>
				
				<wi:inputTextarea id="description"
                                  value="#{def.description}" 
					              label="#{messages['processBuilder.description']}">
				</wi:inputTextarea> 
			</rich:panel>
			
			<rich:panel style="clear:both; overflow:auto; padding-bottom:5px; margin-top:5px" 
				header="#{messages['processBuilder.swimlanes']}" 
				rendered="#{processBuilder.exists}">
				<ui:include src="swimlanes.xhtml" />
			</rich:panel>
		</rich:tab>
		
		<rich:tab header="#{messages['processBuilder.nodes']}" name="nodesTab" id="nodesTab" rendered="#{processBuilder.exists}">
			<ui:include src="nodes.xhtml" />
		</rich:tab>
		
		<rich:tab header="XML" name="xmlTab" id="xmlTab" 
			rendered="#{processBuilder.exists}">
			<ui:include src="xmlEdit.xhtml" />
		</rich:tab>

		<rich:tab header="#{messages['processBuilder.graph']}" name="graphTab" id="graphTab" >
			<ui:include src="graph.xhtml" />
		</rich:tab>
	</rich:tabPanel>
	
	<h:commandButton styleClass="dr-tbpnl-tb-inact"
		id="gravar"
		action="#{processBuilder.update()}"
		value="#{messages['processBuilder.saveBtn']}" type="submit" 
		rendered="#{processBuilder.exists}"/>

	<a:commandButton styleClass="dr-tbpnl-tb-inact"
		id="publicar"
		render="form"
		action="#{processBuilder.deploy()}"
		value="#{messages['processBuilder.deployBtn']}" type="submit" 
		rendered="#{processBuilder.exists}"
        limitRender="true"/>

	<h:commandButton styleClass="dr-tbpnl-tb-inact"
		id="novoProcesso"
		action="#{processBuilder.update()}"
		value="#{messages['processBuilder.saveBtn']}" type="submit" 
		rendered="#{!processBuilder.exists}"/>
	<h:commandButton styleClass="dr-tbpnl-tb-inact"
					 id="new"
					 action="#{processBuilder.clearDefinition()}"
					 value="#{messages['processBuilder.newBtn']}" 
					 type="submit"
					 onclick="if(!confirm('#{messages['processBuilder.confirmNew']}')) return false;" 
					 rendered="#{processBuilder.exists}"/>
    </h:form>

	<rich:messages id="messages" style="color:red" ajaxRendered="true" globalOnly="false" />

	<s:div id="actionTemplate">
		<wi:modalPanel id="actionTemplatePanel"
					   style="padding:0"
					   height="550" 
					   width="920">
			<c:if test="#{!empty actionTemplate.fileName or !empty taskFitter.currentTask.currentVariable}">
				<ui:include src="actions/#{actionTemplate.fileName}" />
			</c:if>
		</wi:modalPanel>
	</s:div>

</ui:define> 

</ui:composition>