<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/minimal.xhtml">

    <ui:define name="title">#{messages['importarXPDL.titlePage']}</ui:define>

    <ui:define name="body">

        <h:form id="uploadXPDL">

            <s:div id="script">
	            <script>
	                function fecharSeSucesso(event) {
	                	if (event.data) {
	                        close();
	                    }
	                }
	            </script>
	        </s:div>

            <a:jsFunction name="importarXpdl"
                action="#{processBuilder.importarXPDL(xpdlUploader.getData(), fluxoCrudAction.instance)}"
                oncomplete="fecharSeSucesso(event)" 
                data="#{processBuilder.importacaoConcluida}"
                render="mensagens" execute="@this" limitRender="true"/>

            <ui:param name="template"
                value="#{wi:get(template, '/WEB-INF/xhtml/components/templates/edit.xhtml')}" />

            <s:decorate id="#{id}Decoration" template="#{template}">
                <rich:fileUpload id="uploadArquivo" execute="@this"
                    status=":status" limitRender="true"
                    required="#{wi:get(required, false)}"
                    acceptedTypes="xpdl"
                    tipMessage="Somente arquivos XPDL"
                    maxFilesQuantity="1"
                    fileUploadListener="#{xpdlUploader.processFileUpload}"
                    immediateUpload="#{wi:get(immediateUpload, true)}"
                    listWidth="#{wi:get(listWidth, '260px')}"
                    listHeight="#{wi:get(listHeight, '58px')}"
                    noDuplicate="#{wi:get(noDuplicate, true)}"
                    onuploadcomplete="importarXpdl()"
                    addLabel="#{messages['button.add']}" clearAllLabel="Limpar Todos"
                    clearLabel="Limpar" uploadLabel="Processar"
                    doneLabel="Enviado"
                    sizeExceededLabel="Erro! Tamanho máximo 2MB."
                    validatorMessage="campo obrigatório."
                    requiredMessage="erro, campo obrigatorio"
                    disabled="#{disabled}"
                    ontyperejected="new infox.Messages({'timeout': 6000}).dialog('Apenas arquivos XPDL são permitidos')">
                    <f:facet name="label">
                        <h:outputText value="{_KB}KB de {KB}KB" />
                    </f:facet>
                </rich:fileUpload>
            </s:decorate>

            <s:div id="mensagens">
	            <rich:panel header="Mensagens" rendered="#{not empty processBuilder.importacaoConcluida and not processBuilder.importacaoConcluida}">
		            <ul>
		                <c:forEach items="#{processBuilder.mensagensImportacao}" var="mensagem">
		                    <li><h:outputText value="#{mensagem}" /></li>
		                </c:forEach>
		            </ul>
	            </rich:panel>
	        </s:div>

        </h:form>
    </ui:define>

</ui:composition>
