<?xml version="1.0" encoding="ISO-8859-1"?>

<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets">

<script language="javascript" charset="ISO-8859-1">
//<![CDATA[
var booleanVariableList=new Array();
var numberVariableList=new Array();
var transitionList=new Array();
var inputId;
var expressionDiv;

function setInputId(id)	{
	inputId = id;
}

function initVariableList() {
	booleanVariableList.clear();
	numberVariableList.clear();
	transitionList.clear();
	booleanVariableList = #{processBuilder.currentNode.getBooleanVariables()};
	numberVariableList = #{processBuilder.currentNode.getNumberVariables()};
	transitionList = #{processBuilder.currentNode.getLeavingTransitionList()};
}

function getNumber() {
	var valor = ".";
	message = "#{messages['expressionWizard.numberPrompt']}";
	while (true) {
		valor = window.prompt(message, "0");
		valor = valor.replace(".", "");
		valor = valor.replace(",", ".");
		valor = parseFloat(valor);
		if ((!isNaN(valor)) && (isFinite(valor))) {
			break;
		}
		message = "#{messages['expressionWizard.numberPromptError']}";
	}
	return valor;
}

function reset(element) {
	element.style.backgroundColor="";
	element.style.cursor="";
	if (element.classList.contains("booleanSelect")) {
		element.innerHTML=booleanSelect();
	} else if (element.classList.contains("aritOperSelect")) {
		element.innerHTML=aritOperSelect();
	} else if (element.classList.contains("conclusionSelect")) {
		element.innerHTML=conclusionSelect();
	}
}

function onMouseOverSpan(event) {
	event.parentNode.style.backgroundColor="#cecece";
	event.parentNode.style.cursor="pointer";
}

function onMouseExitSpan(event) {
	event.parentNode.style.backgroundColor="";
	event.parentNode.style.cursor="";
}

function onMouseClickSpan(event) {
	reset(event.parentNode);
}

function spanLink(label) {
	parent = document.createElement("div");
	element = parent.appendChild(document.createElement("span"));
	element.innerHTML = label;
	element.setAttribute("href", "javascript:void(0)");
	element.setAttribute("onmouseover", "onMouseOverSpan(this)");
	element.setAttribute("onmouseout", "onMouseExitSpan(this)");
	element.setAttribute("onclick", "onMouseClickSpan(this)");

	return parent.innerHTML;
}

function setTextArea(text) {
	document.getElementById(inputId).innerHTML="#"+"{"+text+"}";
}

function onSelectExpWiz(selected) {
	pNode = selected.parentNode;
	if (selected.value == "") {
	} else if (selected.value == "or") {
		selected.parentNode.innerHTML = spanLink("( ") + booleanSelect()
				+ spanLink(" || ") + booleanSelect() + spanLink(" )");
	} else if (selected.value == "and") {
		selected.parentNode.innerHTML = spanLink("( ") + booleanSelect()
				+ spanLink(" && ") + booleanSelect() + spanLink(" )");
	} else if (selected.value == "not") {
		selected.parentNode.innerHTML = spanLink("!") + booleanSelect();
	} else if (selected.value == "operacao") {
		selected.parentNode.innerHTML = aritOperSelect();
	} else if (selected.value == "num") {
		selected.parentNode.innerHTML = spanLink(getNumber());
	} else if (selected.value == "if") {
		selected.parentNode.innerHTML = spanLink("( ") + booleanSelect()
				+ spanLink(" ? ") + conclusionSelect() + spanLink(" : ")
				+ conclusionSelect() + spanLink(" )");
	} else if ((selected.value == "==") || (selected.value == "!=")
			|| (selected.value == ">=") || (selected.value == ">")
			|| (selected.value == "<=") || (selected.value == "<")
			|| (selected.value == "+") || (selected.value == "-")
			|| (selected.value == "/") || (selected.value == "*")) {
		selected.parentNode.innerHTML = spanLink("( ") + aritOperSelect()
				+ spanLink(" " + selected.value + " ") + aritOperSelect()
				+ spanLink(" )");
	} else {
		selected.parentNode.innerHTML = spanLink(selected.value);
	}
	
	if (expressionDiv.getElementsByTagName("select").length == 0) {
		setTextArea(expressionDiv.textContent);
	}
	
}

function addOption(value, label, parentNode) {
	result = document.createElement("option")
	result.value = value;
	result.innerHTML = label;
	return parentNode.appendChild(result);
}

function aritOperSelect() {
	parent = document.createElement("div");
	element = parent.appendChild(document.createElement("div"));
	element.setAttribute("class", "aritOperSelect");
	element = element.appendChild(document.createElement("select"));
	element.setAttribute("onchange", "onSelectExpWiz(this)");
	
	addOption("", "#{messages['expressionWizard.aritSelect.null']}", element);
	addOption("+", "#{messages['expressionWizard.aritSelect.plus']}", element);
	addOption("-", "#{messages['expressionWizard.aritSelect.minus']}", element);
	addOption("*", "#{messages['expressionWizard.aritSelect.mult']}", element);
	addOption("/", "#{messages['expressionWizard.aritSelect.div']}", element);
	addOption("","",element);
	addOption("num", "#{messages['expressionWizard.aritSelect.numb']}", element);
	addOption("","",element);
	for(var i=0; i < numberVariableList.length; i++) {
		item = numberVariableList[i];
		addOption(item, "  "+item, element);
	}
	return parent.innerHTML;
}

function booleanSelect() {
	parent = document.createElement("div");
	element = parent.appendChild(document.createElement("div"));
	element.setAttribute("class", "booleanSelect");
	element = element.appendChild(document.createElement("select"));
	element.setAttribute("onchange", "onSelectExpWiz(this)");

	addOption("", "#{messages['expressionWizard.booleanSelect.null']}", element);
	addOption("true", "#{messages['expressionWizard.booleanSelect.true']}", element);
	addOption("false", "#{messages['expressionWizard.booleanSelect.false']}", element);
	addOption("or", "#{messages['expressionWizard.booleanSelect.or']}", element);
	addOption("and", "#{messages['expressionWizard.booleanSelect.and']}", element);
	addOption("not", "#{messages['expressionWizard.booleanSelect.not']}", element);
	addOption("", "", element);
	addOption("==", "#{messages['expressionWizard.booleanSelect.equals']}", element);
	addOption("!=", "#{messages['expressionWizard.booleanSelect.notEqual']}", element);
	addOption(">=", "#{messages['expressionWizard.booleanSelect.gte']}", element);
	addOption(">", "#{messages['expressionWizard.booleanSelect.gt']}", element);
	addOption("<=", "#{messages['expressionWizard.booleanSelect.lte']}", element);
	addOption("<", "#{messages['expressionWizard.booleanSelect.lt']}", element);
	addOption("", "", element);
	for(var i=0; i < booleanVariableList.length; i++) {
		item = booleanVariableList[i];
		addOption(item, item, element);
	}

	return parent.innerHTML;
}

function conclusionSelect() {
	parent = document.createElement("div");
	element = parent.appendChild(document.createElement("div"));
	element.setAttribute("class", "conclusionSelect");
	element = element.appendChild(document.createElement("select"));
	element.setAttribute("onchange", "onSelectExpWiz(this)");

	addOption("", "#{messages['expressionWizard.condSelect.null']}", element);
	addOption("if", "#{messages['expressionWizard.condSelect.cond']}", element);
	addOption("","",element);
	for(var i=0; i < transitionList.length; i++) {
		item = transitionList[i];
		addOption("'"+item+"'", item, element);
	}

	return parent.innerHTML;
}

function initialExpression() {
	initVariableList();
	return booleanSelect() + " ? " + conclusionSelect() + " : "
			+ conclusionSelect();
}

function initExpressions(id) {
	if (id) {
		expressionDiv = document.getElementById(id);
		expressionDiv.innerHTML = initialExpression();
	}
}
//]]>
</script>
</ui:composition>