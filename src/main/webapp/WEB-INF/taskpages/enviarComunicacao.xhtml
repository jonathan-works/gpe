<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml" 
      xmlns:ui="http://java.sun.com/jsf/facelets" 
      xmlns:h="http://java.sun.com/jsf/html" 
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:wi="http://www.itx.com.br/jsf"
      xmlns:rich="http://richfaces.org/rich"
      xmlns:a="http://richfaces.org/a4j"
      xmlns:s="http://jboss.org/schema/seam/taglib"
      xmlns:infox="http://www.infox.com.br/jsf">

	<h:outputScript library="js" name="components.js" />
	<s:div style="background-color: white; padding-top: 20px; margin-bottom: 20px; padding-left: 10px; padding-right: 10px;">
		<s:div id="comunicacaoDiv">
		
			<!-- Combo de tipo de comunicação e botão de visualizar comunicação -->
			<h:form id="comunicacaoForm">
				<wi:selectOneMenuEntity id="tipoComunicacao" label="#{infoxMessages['comunicacao.tipoComunicacao']}"
					showRequired="true" items="#{envioComunicacaoController.tiposComunicacao}"
					value="#{envioComunicacaoController.tipoComunicacao}"
					disabled="#{envioComunicacaoController.modeloComunicacao.finalizada}">
					<a:ajax event="change" render="modeloDocumento, classificacaoComunicacao" />
				</wi:selectOneMenuEntity>
				<div />
			<a:commandButton id="visualizarComunicacao" 
				render="@this" execute="@this"
				value="#{infoxMessages['comunicacao.visualizarComunicacao']}" 
				styleClass="buttons"
				rendered="#{envioComunicacaoController.podeVisualizarComunicacaoNaoFinalizada()}" 
				oncomplete="infox.openPopUp('download', '#{pathResolver.contextPath}/Processo/baixarComunicacao.seam','1024');" >
				<f:setPropertyActionListener value="#{envioComunicacaoController.modeloComunicacao.id}" target="#{flash.idModelo}" />
				<infox:flashcopy/>
			</a:commandButton>
			</h:form>
			
			<!-- Painel dos Destinatários -->
        <s:div id="destinatariosPanel">				
			<!-- Participantes Disponíveis -->
			<s:div rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
				<rich:collapsiblePanel header="#{infoxMessages['comunicacao.participantesProcesso']}" switchType="client"
					rendered="#{participanteProcessoComunicacaoList.resultCount gt 0}">
					<wi:dataTable id="participantesDisponiveis" values="#{participanteProcessoComunicacaoList.list(15)}" 
						bean="#{participanteProcessoComunicacaoList}" showSearchForm="false" rowId="#{row.id}">
						<ui:define name="headerToolBar" />
						<ui:define name="toolBar">
							<h:form>
								<a:commandLink render="destinatariosPanel"
									action="#{destinatarioComunicacaoAction.adicionarDestinatario(row)}">
									<h:graphicImage url="#{wiSkin.imageFolder}/add.gif" title="#{infoxMessages['button.add']}" />
								</a:commandLink>
							</h:form>
						</ui:define>
						<rich:column>
							<f:facet name="header">#{infoxMessages['participanteProcesso.nome']}</f:facet>
							<h:outputText value="#{row.nome}" />
						</rich:column>
						<rich:column>
							<f:facet name="header">#{infoxMessages['participanteProcesso.tipoParticipante']}</f:facet>
							<h:outputText value="#{row.tipoParte.descricao}" />
						</rich:column>
                           <rich:column>
                               <f:facet name="header">#{infoxMessages['participanteProcesso.superior']}</f:facet>
                               <h:outputText value="#{row.participantePai}"></h:outputText>
                           </rich:column>
					</wi:dataTable>
				</rich:collapsiblePanel>
			</s:div>
			
			<!-- Controle do Relator -->
			<h:form rendered="#{destinatarioComunicacaoAction.processoPossuiRelator and not envioComunicacaoController.modeloComunicacao.finalizada}"
				style="margin-top:1em;">
				<wi:selectBooleanCheckbox id="relator" label="#{infoxMessages['comunicacao.enviarParaRelator']}" 
					value="#{destinatarioComunicacaoAction.modeloComunicacao.enviarRelatoria}">
					<a:ajax event="change" render="destinatariosPanel" limitRender="true" execute="@this"
						listener="#{destinatarioComunicacaoAction.gerenciarRelator}"/>
				</wi:selectBooleanCheckbox>
			</h:form>
			<div />
			
			<!-- Localizações disponíveis para serem selecionadas como Destinatários -->
			<h:form rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
					<rich:collapsiblePanel header="#{infoxMessages['comunicacao.localizacoes']}" switchType="client">
                       	<s:div style="margin-botton:1em">
                       		<wi:outputText id="mensagemEnvioLocalizacao" value="#{infoxMessages['comunicacao.mensagemEnvioParaLocalizacao']}" />
                       	</s:div>
                        <wi:tree
                            id="localizacao"
                            assignTo="destinatarioComunicacaoAction.localizacao"
                            tree="#{localizacaoSubTree}"
                            icon="#{wiSkin.imageFolder}/nivelTree.gif"
                            iconLeaf="#{wiSkin.imageFolder}/file.gif"
                            label="#{infoxMessages['comunicacao.localizacoes']}"
                            required="true"
                            render="perfisPermitidosDestino" />
                        <wi:selectOneMenuEntity
                            id="perfisPermitidosDestino"
                            value="#{destinatarioComunicacaoAction.perfilDestino}"
                            label="#{infoxMessages['usuarioPerfil.perfil']}"
                            items="#{destinatarioComunicacaoAction.perfisPermitidosDestino}"
                            showLabelSelecione="true"
                            disabled="#{empty destinatarioComunicacaoAction.localizacao}" />
                        <wi:commandButton id="adicionarLocalizacao" reRender="destinatariosPanel, pageBodyDialogMessage" value="#{infoxMessages['button.add']}"
				        	action="#{destinatarioComunicacaoAction.adicionarDestino(destinatarioComunicacaoAction.localizacao, destinatarioComunicacaoAction.perfilDestino)}" />
					</rich:collapsiblePanel>
				</h:form>
			
			<h:form>
				<!-- Grid dos destinatários selecionados -->
				<rich:panel id="destinatariosSelecionadosComunicacaoPanel" 
					header="#{infoxMessages['comunicacao.destinatarios']}"
					style="margin-top:1em" bodyClass="dtable-p-b" styleClass="dtable-p full-sized">
				<rich:dataTable id="destinatariosSelecionados"
					value="#{envioComunicacaoController.modeloComunicacao.destinatarios}"
					styleClass="dtable rf-dt-crud" var="row" 
					rendered="#{not empty envioComunicacaoController.modeloComunicacao.destinatarios}">
					<ui:param name="showToolbarNaoFinalizada" value="#{not envioComunicacaoController.modeloComunicacao.finalizada}" />
					<ui:param name="showToolbarFinalizada" value="#{envioComunicacaoController.modeloComunicacao.finalizada and
															 not envioComunicacaoController.modeloComunicacao.documentoBinario}" />
					<rich:column styleClass="dt-toolbar-col" rendered="#{showToolbarNaoFinalizada or showToolbarFinalizada}">
						<a:commandLink execute="@this" render="destinatariosPanel"
							action="#{destinatarioComunicacaoAction.removerDestinatario(row)}"
							rendered="#{showToolbarNaoFinalizada}">
							<h:graphicImage url="#{wiSkin.imageFolder}/remove.png" title="#{infoxMessages['button.delete']}" />
						</a:commandLink>
						<s:div rendered="#{showToolbarFinalizada}">
   							<a:commandLink action="#{envioComunicacaoController.setDestinatario(row)}" render="comunicacaoDestinatarioForm" execute="@this"
   								rendered="#{envioComunicacaoController.usuarioLogadoNaLocalizacaoPerfilResponsavel and not row.expedido}">
   								<h:graphicImage url="#{wiSkin.imageFolder}/expedir_comunicacao.png" title="#{infoxMessages['button.selecionar']}" />
   							</a:commandLink>
   							<a:commandLink oncomplete="infox.openPopUp('download', '#{pathResolver.contextPath}/Processo/baixarComunicacao.seam','1024');"
   								rendered="#{row.expedido}" render="@this" execute="@this">
								<h:graphicImage url="#{wiSkin.imageFolder}/reopen.png" title="#{infoxMessages['comunicacao.visualizarAComunicacao']}"/>
								<f:setPropertyActionListener value="#{row.id}" target="#{flash.idDestinatario}" />
								<infox:flashcopy/>
							</a:commandLink>
						</s:div>
					</rich:column>
					<rich:column>
						<f:facet name="header">#{infoxMessages['participanteProcesso.nome']}</f:facet>
						<h:outputText value="#{row.nome}" />
					</rich:column>
					<rich:column style="width:12em;">
						<f:facet name="header">#{infoxMessages['comunicacao.meioExpedicao']}<span class="required">*</span></f:facet>
						<h:selectOneMenu value="#{row.meioExpedicao}" 
							rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
							<f:selectItem noSelectionOption="true" itemLabel="#{infoxMessages['crud.select.select']}" />
							<f:selectItems var="v" value="#{destinatarioComunicacaoAction.getMeiosExpedicao(row)}" 
								itemLabel="#{v.label}" itemValue="#{v}"/>
							<a:ajax event="change" />
						</h:selectOneMenu>
						<h:outputText value="#{row.meioExpedicao.label}" rendered="#{envioComunicacaoController.modeloComunicacao.finalizada}" />
					</rich:column>
					<rich:column style="width:15em;">
						<f:facet name="header">
							#{infoxMessages['comunicacao.prazo']}
							<s:fragment rendered="#{envioComunicacaoController.prazoComunicacaoRequired}">
								<span class="required">*</span>
							</s:fragment>
						</f:facet>
						<h:inputText value="#{row.prazo}" rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}"
							onkeyup="onlyPositiveNumber(this)" converterId="integerConverter" id="prazo">
							<a:ajax event="change" />
						</h:inputText>
						<h:outputText value="#{row.prazo}" rendered="#{envioComunicacaoController.modeloComunicacao.finalizada}" />
					</rich:column>
					<rich:column styleClass="dt-toolbar-col" rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
						<a:commandButton value="#{infoxMessages['comunicacao.replicarPrazo']}" 
							render="destinatariosPanel" action="#{destinatarioComunicacaoAction.replicarPrazo(row)}"
							rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}" execute="@this, prazo"/>
					</rich:column>
				</rich:dataTable>
				</rich:panel>
			</h:form>
        </s:div>
			<!-- Botão Visualizar Comunicações (o ofício da documentação é o último documento incluso por usuário interno) -->
			<h:form id="visualizarComunicacaoAnexoForm">
				<s:div rendered="#{envioComunicacaoController.podeExibirBotaoVisualizarComunicacoes()}">
					<a:commandButton id="visualizarComunicacao" 
							render="@this" execute="@this"
							value="#{infoxMessages['comunicacao.visualizarComunicacao']}" 
							styleClass="buttons"
							oncomplete="infox.openPopUp('download', '#{pathResolver.contextPath}/Processo/baixarComunicacao.seam','1024');" >
						<f:setPropertyActionListener value="#{envioComunicacaoController.modeloComunicacao.id}" target="#{flash.idModelo}" />
						<infox:flashcopy/>
					</a:commandButton>
          		</s:div>
			</h:form>
			
			<!-- Expedição individual de comunicações (o ofício da comunicação é o texto do editor) -->
			<h:form id="comunicacaoDestinatarioForm">
				<s:div id="assinatura_pers" rendered="#{not envioComunicacaoController.modeloComunicacao.documentoBinario
					and not empty envioComunicacaoController.destinatario and not envioComunicacaoController.destinatario.expedido}">
					
					<a:commandButton id="visualizarComunicacao" 
								value="#{infoxMessages['comunicacao.visualizarComunicacao']}" 
								styleClass="buttons" render="@this" execute="@this"
								oncomplete="infox.openPopUp('download', '#{pathResolver.contextPath}/Processo/baixarComunicacao.seam','1024');" >
						<f:setPropertyActionListener value="#{envioComunicacaoController.destinatario.id}" target="#{flash.idDestinatario}" />
						<infox:flashcopy/>
					</a:commandButton>
											 
					<a:jsFunction name="assinar" action="#{envioComunicacaoController.expedirComunicacao()}"
						execute="@this appletAssinaturaToken" 
						render="pageBodyDialogMessage comunicacaoDiv"
					  	oncomplete="infox.hideLoading(); if (opener &amp;&amp; opener['reloadAll']) opener['reloadAll']();"/>
             
					<wi:certificadoDigital id="appletAssinatura"
                        tokenField="#{envioComunicacaoController.token}"
						signableData="#{envioComunicacaoController.destinatario.documentoComunicacao.documentoBin.md5Documento}"
						functionPreSign="infox.showLoading();"
						functionPosSign="assinar();"
						rendered="#{envioComunicacaoController.podeRenderizarApplet()}"
						signButtonCaption="#{infoxMessages['comunicacao.expedirComunicacao']}" />
          		</s:div>
			</h:form>

			<!-- Documentos disponíveis para serem vinculados à comunicação -->
			<rich:collapsiblePanel id="documentos" 
				header="#{envioComunicacaoController.expedida ? infoxMessages['comunicacao.documentosAnexados'] 
					: infoxMessages['comunicacao.anexarDocumentos']}"
				switchType="client" style="margin-top:1em;"
				rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada or not empty envioComunicacaoController.modeloComunicacao.documentos}">
				<wi:dataTable id="documentosProcesso" values="#{documentoDisponivelComunicacaoList.list(10)}" 
					bean="#{documentoDisponivelComunicacaoList}" rowId="#{row.id}"
					showGrid="#{not envioComunicacaoController.modeloComunicacao.finalizada}"
					tableTitle="#{infoxMessages['comunicacao.documentosDisponiveis']}">
					<ui:define name="headerToolBar" />
					<ui:define name="toolBar">
						<h:form>
							<a:commandLink action="#{documentoComunicacaoAction.adicionarDocumento(row)}" 
								execute="@this" render="documentos">
								<h:graphicImage url="#{wiSkin.imageFolder}/add.gif" title="#{infoxMessages['button.add']}" />
							</a:commandLink>
							<a:commandLink
								onclick="infox.editor['comunicacao'].insertText('#{documentoComunicacaoAction.getLink(row.documentoBin)}'); return false;">
								<h:graphicImage url="#{wiSkin.imageFolder}/link.gif" title="#{infoxMessages['button.copiarLink']}" />
							</a:commandLink>
                            <ui:include src="/WEB-INF/xhtml/components/grid/processoDocumentoBin.xhtml">
                                <ui:param name="bin" value="#{row.documentoBin}" />
                                <ui:param name="header" value="#{row.descricao}" />
                                <ui:param name="hideSignature" value="true" />
                            </ui:include>
                        </h:form>
					</ui:define>
					<ui:define name="searchForm">
						<rich:panel header="Pastas" rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
							<rich:list value="#{documentoComunicacaoAction.pastas}" styleClass="folder-ul" rowClass="folder-li"
								var="pasta">
								<h:form rendered="#{documentoComunicacaoAction.canSee(pasta)}"
									styleClass="rf-tr-nd">
									<a:commandLink render="documentosProcessoPanel, documentosProcessoSearchForm"
										execute="@form"	styleClass="folder" limitRender="true">
				  		              <h:graphicImage
				                          url="#{wiSkin.imageFolder}/folder.png"
				                          rendered="true"
				                          title="#{pasta}" />
										<f:attribute name="pastaToSelect" value="#{pasta}" />
										<f:actionListener type="br.com.infox.epp.processo.comunicacao.list.DocumentoDisponivelComunicacaoList" />
										<h:outputText value="#{eventCache.get('documentoDisponivelComunicacaoList.getTextoPasta(pasta)', pasta.id)}" class="folder" />
									</a:commandLink>
								</h:form>
							</rich:list>
						</rich:panel>
					</ui:define>
					<rich:column>
						<f:facet name="header">#{infoxMessages['documentoProcesso.processoDocumento']}</f:facet>
						<h:outputText value="#{row.descricao}" />
					</rich:column>
					<rich:column>
						<f:facet name="header">#{infoxMessages['processoDocumento.classificacaoDocumento']}</f:facet>
						<h:outputText value="#{row.classificacaoDocumento.descricao}" />
					</rich:column>
					<rich:column>
						<f:facet name="header">#{infoxMessages['processoDocumento.tamanho']}</f:facet>
						<h:outputText value="#{row.documentoBin.sizeFormatado}" />
					</rich:column>
				</wi:dataTable>
				
				<!-- Documentos vinculados à comunicação -->
				<rich:panel header="#{envioComunicacaoController.expedida ? '' : infoxMessages['comunicacao.documentosSelecionados']}" headerClass="text-center">
					<rich:dataTable id="documentosSelecionados" value="#{envioComunicacaoController.modeloComunicacao.documentos}"
						styleClass="dtable rf-dt-crud" var="row" rendered="#{not empty envioComunicacaoController.modeloComunicacao.documentos}">
						<rich:column styleClass="dt-toolbar-col" rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
							<h:form>
								<a:commandLink action="#{documentoComunicacaoAction.removerDocumento(row)}" 
									execute="@this" render="documentos">
									<h:graphicImage url="#{wiSkin.imageFolder}/remove.png" title="#{infoxMessages['button.delete']}" />
								</a:commandLink>
								<a:commandLink
									onclick="infox.editor['comunicacao'].insertText('#{documentoComunicacaoAction.getLink(row.documento.documentoBin)}'); return false;">
									<h:graphicImage url="#{wiSkin.imageFolder}/link.gif" title="#{infoxMessages['button.copiarLink']}" />
								</a:commandLink>
                                <ui:include src="/WEB-INF/xhtml/components/grid/processoDocumentoBin.xhtml">
                                    <ui:param name="bin" value="#{row.documento.documentoBin}" />
                                    <ui:param name="header" value="#{row.documento.descricao}" />
                                    <ui:param name="row" value="#{row.documento}" />
                                    <ui:param name="hideSignature" value="true" />
                                </ui:include>
                            </h:form> 
						</rich:column>
						<rich:column>
						<f:facet name="header">#{infoxMessages['documentoProcesso.processoDocumento']}</f:facet>
						<h:outputText value="#{row.documento.descricao}" />
					</rich:column>
                    <rich:column>
                        <f:facet name="header">#{infoxMessages['documentoProcesso.pastaDocumento']}</f:facet>
                        <h:outputText value="#{row.documento.pasta}" />
                    </rich:column>
					<rich:column>
						<f:facet name="header">#{infoxMessages['processoDocumento.classificacaoDocumento']}</f:facet>
						<h:outputText value="#{row.documento.classificacaoDocumento.descricao}" />
					</rich:column>
					<rich:column>
						<f:facet name="header">#{infoxMessages['processoDocumento.tamanho']}</f:facet>
						<h:outputText value="#{row.documento.documentoBin.sizeFormatado}" />
					</rich:column>
					</rich:dataTable>
				</rich:panel>
			</rich:collapsiblePanel>
			
			<!-- Ofício da Comunicação -->
			<h:form id="documentoComunicacaoForm">
				<s:div style="display: inline-block; vertical-align: top" rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}">
				<rich:collapsiblePanel id="editorDocumentoComunicacaoPanel" header="#{infoxMessages['comunicacao.panelEditorComunicacaoTitulo']}">
					<s:div>
	    				<wi:selectOneMenuEntity id="classificacaoComunicacao"
	    					label="#{infoxMessages['processoDocumento.classificacaoDocumento']}"
				      		items="#{documentoComunicacaoAction.classificacoes}"
				      		showLabelSelecione="true"
				      		value="#{envioComunicacaoController.modeloComunicacao.classificacaoComunicacao}"
				      		readonly="#{not envioComunicacaoController.modeloComunicacao.minuta}"
	      					disabled="#{not envioComunicacaoController.modeloComunicacao.minuta}">
	      					<a:ajax event="change"
	        					render="tooltipComunicacao"
	        					execute="@this"
	        					limitRender="true" />
	    				</wi:selectOneMenuEntity>
				   		<s:div id="tooltipComunicacao" styleClass="tooltip-parent" style="width: 10px; display:inline;"> 
				  			<h:graphicImage id="imgTootipEditorComunicacao" url="#{wiSkin.imageFolder}/help.gif" />
				  			<s:fragment rendered="#{not empty envioComunicacaoController.modeloComunicacao.classificacaoComunicacao.observacao}">
								<div class="epp-tooltip" style="display:inline;" >
									<div class="tooltip-panel">
										<div><h:outputText value="#{infoxMessages['comunicacao.tooltipObservacao']}"/></div>
										<h:outputText value="#{envioComunicacaoController.modeloComunicacao.classificacaoComunicacao.observacao}"/>
									</div>
								</div>
							</s:fragment>
				   		</s:div>
	  				</s:div>
					<wi:selectOneMenuEntity id="modeloDocumento" value="#{envioComunicacaoController.modeloComunicacao.modeloDocumento}" 
						label="#{infoxMessages['modeloDocumento.modeloDocumento']}"
						readonly="#{not envioComunicacaoController.modeloComunicacao.minuta}"
						disabled="#{not envioComunicacaoController.modeloComunicacao.minuta}"
						noSelectionLabel="[Selecione o modelo]" items="#{documentoComunicacaoAction.modelosDocumento}">
						<a:ajax event="change" render="comunicacaoEditorDiv" execute="@this" limitRender="true"
							listener="#{documentoComunicacaoAction.assignModeloDocumento}"/>
					</wi:selectOneMenuEntity>
					<s:div>
						<wi:selectBooleanRadio id="minuta" value="#{envioComunicacaoController.modeloComunicacao.minuta}"
							label="#{infoxMessages['comunicacao.minutaLabel']}" 
							readonly="#{not envioComunicacaoController.modeloComunicacao.minuta}" 
							disabled="#{not envioComunicacaoController.modeloComunicacao.minuta}" />
					</s:div>
					<s:div id="comunicacaoEditorDiv">
						<wi:editor id="comunicacao" value="#{envioComunicacaoController.modeloComunicacao.textoComunicacao}" 
							readonly="#{not envioComunicacaoController.modeloComunicacao.minuta}"/>
					</s:div>
				</rich:collapsiblePanel>
				</s:div>
				
				<rich:panel id="panelFinalizacaoDaElaboracaoComunicacao">
					<!-- Finalização e Responsáveis pela Expedição da Comunicação -->
					<s:div id="responsaveisAssinatura">
						<wi:selectBooleanCheckbox id="finalizada" label="#{infoxMessages['comunicacao.finalizada']}" 
							value="#{envioComunicacaoController.finalizada}" disabled="#{envioComunicacaoController.modeloComunicacao.finalizada}">
							<a:ajax event="change" execute="@this" render="responsaveisAssinatura" />
						</wi:selectBooleanCheckbox>
						<s:div rendered="#{envioComunicacaoController.finalizada and not envioComunicacaoController.modeloComunicacao.finalizada}"
							style="display:inline-block">
							<div>
								<wi:outputText id="mensagemSelecionarLocalizacaoResponsavelAssinatura"
									label="#{infoxMessages['comunicacao.mensagemLocalizacaoResponsavelAssinatura']}" />
							</div>
							<wi:tree
					            id="localizacoesTree"
					            assignTo="envioComunicacaoController.modeloComunicacao.localizacaoResponsavelAssinatura"
					            tree="#{localizacaoSubTree}"
					            icon="#{wiSkin.imageFolder}/nivelTree.gif"
					            iconLeaf="#{wiSkin.imageFolder}/file.gif"
					            clearRender="@this"
					            label="#{infoxMessages['comunicacao.localizacoes']}" 
					            render="perfisPermitidos" />
				        	<wi:selectOneMenuEntity id="perfisPermitidos"
					            value="#{envioComunicacaoController.modeloComunicacao.perfilResponsavelAssinatura}"
					            label="#{infoxMessages['usuarioPerfil.perfil']}"
					            items="#{destinatarioComunicacaoAction.perfisPermitidos}"
					            showLabelSelecione="true"
					            disabled="#{empty envioComunicacaoController.modeloComunicacao.localizacaoResponsavelAssinatura}" />
				        </s:div>
				        <s:fragment rendered="#{envioComunicacaoController.modeloComunicacao.finalizada}">
				        	<wi:outputText id="localizacaoRespAssinatura" label="#{infoxMessages['comunicacao.localizacaoRespAssinatura']}" 
				        		value="#{envioComunicacaoController.modeloComunicacao.localizacaoResponsavelAssinatura.caminhoCompletoFormatado}"/>
				        	<wi:outputText id="perfilRespAssinatura" label="#{infoxMessages['comunicacao.perfilRespAssinatura']}"
				        		value="#{envioComunicacaoController.modeloComunicacao.perfilResponsavelAssinatura.descricao}"
				        		rendered="#{not empty envioComunicacaoController.modeloComunicacao.perfilResponsavelAssinatura}" />
				        </s:fragment>
			        </s:div>
		        </rich:panel>
		        
		        <!-- Botões de Controle -->
				<wi:commandButton id="gravar" value="#{infoxMessages['crud.update']}" 
					action="envioComunicacaoController.gravar" reRender=":pageBodyDialogMessage comunicacaoDiv"
					rendered="#{not envioComunicacaoController.modeloComunicacao.finalizada}"
					oncomplete="if (opener &amp;&amp; opener['reloadAll']) opener['reloadAll']();"/>
				<s:fragment rendered="#{envioComunicacaoController.expedida and envioComunicacaoController.inTask}">
					<!-- O ui:include tenta incluir o facelet mesmo se o rendered estiver falso -->
					<ui:include src="#{envioComunicacaoController.inTask ? '/WEB-INF/xhtml/components/form/buttons/taskButtonsTaskPage.xhtml' : ''}" />
				</s:fragment>
			</h:form>
		</s:div>
	</s:div>
</ui:composition>
