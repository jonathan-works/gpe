<ui:composition xmlns="http://www.w3.org/1999/xhtml"
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:wi="http://www.itx.com.br/jsf"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:infox="http://www.infox.com.br/jsf"
    xmlns:p="http://primefaces.org/ui">

    <infox:div rendered="#{not checkListView.hasPrestacao}">
        <h:outputText value="#{infoxMessages['checkListPC.pcNotFound']}" />
    </infox:div>

    <infox:div id="checkListMessage">
        <h:outputText value="#{checkListView.message}" rendered="#{not empty checkListView.message}" />
    </infox:div>

    <infox:div rendered="#{checkListView.hasPrestacao}">
        <h:form id="blocoSituacaoForm">
            <wi:selectOneMenuEnum id="blocoSituacaoMenu" label="#{infoxMessages['checkListPC.blocoSituacao.label']}"
                value="#{checkListView.situacaoBloco}"
                items="#{checkListView.situacaoCheckListOptions}"/>

            <a:commandButton id="blocoSituacaoButton" styleClass="buttons"
                value="#{infoxMessages['checkListPC.blocoSituacao.button']}" onclick="infox.showLoading();"
                actionListener="#{checkListView.setBlockSituacao()}"
                oncomplete="infox.hideLoading();" execute="@form"
                render="checkListMessage pageBodyDialogMessage @form checkListTable" />
        </h:form>
        <h:form id="checkListTableform">
            <p:dataTable id="checkListTable" widgetVar="checkListTable"
                var="row" rowKey="#{row.id}" rowIndexVar="rowNumber" value="#{checkListView.documentoList}"
                paginator="true" rows="20" lazy="true" emptyMessage="#{infoxMessages['list.defaultNoDataLabel']}"
                paginatorTemplate="{FirstPageLink} {PreviousPageLink} {PageLinks} {JumpToPageDropdown} {NextPageLink} {LastPageLink} {CurrentPageReport}"
                currentPageReportTemplate="PÃ¡gina {currentPage} de {totalPages} em {totalRecords} registros" >
                
                <p:column styleClass="dt-toolbar-col" exportable="false">
                    <a:commandLink id="downloadDocumentoPC" style="margin-right: 0.5em;"
                        onclick="infox.showLoading();" execute="@this" render="@this" limitRender="true"
                        oncomplete="infox.hideLoading(); window.open('#{pathResolver.contextPath}/PdfReadOnly/downloadDocumento.seam');">
                        <infox:flashcopy />
                        <h:graphicImage url="#{wiSkin.imageFolder}/reopen.png" title="#{row.documentoPC.documentoBin}" styleClass="opacityHover"/>
                        <f:setPropertyActionListener value="#{row.documentoPC.documentoBin}" target="#{flash.documentoBin}" />
                    </a:commandLink>
                </p:column>
                
                <p:column headerText="#{infoxMessages['checkListPC.classificacaoDocumento']}" filterBy="#{row.documentoPC.classificacaoDocumento}">
                    <f:facet name="filter">
                        <h:selectOneMenu id="filterClassificacao" onchange="PF('checkListTable').filter()" style="max-width: 100%;">
                            <f:selectItem itemLabel="[Todos]" noSelectionOption="true" />
                            <f:selectItems value="#{checkListView.classificacoesDocumento}" />
                        </h:selectOneMenu>
                    </f:facet>
                    <h:outputText value="#{row.documentoPC.classificacaoDocumento}" />
                </p:column>
                
                <p:column headerText="#{infoxMessages['checkListPC.documento']}" filterBy="#{row.documentoPC.descricao}">
                    <f:facet name="filter">
                        <h:inputText id="filterNomeDocumento" onchange="PF('checkListTable').filter()" style="max-width: 100%;" />
                    </f:facet>
                    <h:outputText value="#{row.documentoPC.descricao}" />
                </p:column>
                
                <p:column headerText="#{infoxMessages['checkListPC.situacao']}" filterBy="#{row.situacao}" style="width: 345px">
                    <f:facet name="filter">
                        <h:selectOneMenu id="filterSituacao" onchange="PF('checkListTable').filter()" style="max-width: 100%;">
                            <f:selectItem itemLabel="[Todos]" noSelectionOption="true" />
                            <f:selectItems value="#{checkListView.situacoesCompletas}" />
                        </h:selectOneMenu>
                    </f:facet>
                    <h:panelGroup id="selectSituacao">
                        <h:selectOneRadio id="selectSituacaoRadio" value="#{row.situacao}" styleClass="checkListRadio"
                            layout="lineDirection" style="border: none">
                            <f:selectItems value="#{checkListView.situacoes}" />
                            <a:ajax event="change" execute="@this" render="checkListMessage pageBodyDialogMessage :movimentarTabPanel:checkListTableform:checkListTable:#{rowNumber}:textArea :movimentarTabPanel:checkListTableform:checkListTable:#{rowNumber}:selectSituacao"
                                onbegin="infox.showLoading();" oncomplete="infox.hideLoading();"
                                listener="#{checkListView.onChangeSituacao(row)}" />
                        </h:selectOneRadio>
                    </h:panelGroup>
                </p:column>
                
                <p:column headerText="#{infoxMessages['checkListPC.comentarios']}">
                    <h:panelGroup id="textArea" styleClass="textAreaPanel#{row.id}">
                        <h:inputTextarea rows="3" cols="30" rendered="#{row.situacao eq 'NCO' or row.situacao eq 'NVE'}"
                            value="#{row.comentario}">
                            <a:ajax event="change" limitRender="true" execute="@this"
                                render="checkListMessage pageBodyDialogMessage"
                                onbegin="infox.showLoading();" oncomplete="infox.hideLoading();"
                                listener="#{checkListView.onChangeComentario(row)}" />
                        </h:inputTextarea>
                    </h:panelGroup>
                </p:column>
            </p:dataTable>
        </h:form>
    </infox:div>
    
    <h:form id="taskButtonsForm">
        <ui:include src="/WEB-INF/xhtml/components/form/buttons/taskButtons.xhtml">
            <ui:param name="taskEndAction" value="checkListView.endTask" />
        </ui:include>
    </h:form>

    <style type="text/css">
        table.checkListRadio td {
            border: none;
            padding: 0px;
        }
    </style>
</ui:composition>