<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib">

  <h:form>
    <ui:param name="idProcesso" value="#{row.idProcesso}" />
    <ui:param name="tarefaId" value="#{painelUsuarioHome.tarefaId}" />
    <ui:param name="owner"
      value="#{userHandler.getActorIdTarefaAtual(idProcesso)}" />

    <a:outputPanel>

      <rich:dragSource type="task#{tarefaId}" dragValue="#{row}"
        dragIndicator="indicator">
        <rich:dragIndicator
          id="indicator"
          acceptClass="caixa-acpt"
          draggingClass="caixa-drag"
          rejectClass="caixa-rejt"
        >
          <span class="caixa-ind-lbl">#{messages['processo.titlePage']}: #{row.numeroProcesso}</span>
        </rich:dragIndicator>
      </rich:dragSource>

      <h:graphicImage url="/img/annotate.gif" title="#{messages['caixa.moverCaixa']}" />

    </a:outputPanel>

    <a:commandLink execute="@this" target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/visualizarProcesso.seam?idProcesso=#{idProcesso}&amp;tarefaId=#{tarefaId}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">

      <f:param name="idProcesso" value="#{idProcesso}" />

      <f:param name="tarefaId" value="#{tarefaId}" />

      <h:graphicImage url="#{a4jSkin.imgFolder}/view.gif" />

    </a:commandLink>

    <a:commandLink execute="@this" rendered="#{empty owner}"
      target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/movimentar.seam?idProcesso=#{idProcesso}&amp;tarefaId=#{tarefaId}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">

      <f:param name="idProcesso" value="#{idProcesso}" />

      <f:param name="tarefaId" value="#{tarefaId}" />

      <h:graphicImage url="#{a4jSkin.imgFolder}/edit.gif" />

    </a:commandLink>

    <a:commandLink execute="@this"
      rendered="#{owner == authenticator.getUsuarioLogado()}"
      target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/movimentar.seam?idProcesso=#{idProcesso}&amp;tarefaId=#{tarefaId}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">

      <f:param name="idProcesso" value="#{idProcesso}" />

      <f:param name="tarefaId" value="#{tarefaId}" />

      <h:graphicImage url="#{a4jSkin.imgFolder}/task.gif" />

    </a:commandLink>

    <h:graphicImage url="#{a4jSkin.imgFolder}/role.gif"
      rendered="#{(owner != authenticator.getUsuarioLogado() and ! empty owner and !authenticator.isUsuarioAtualResponsavel())}"
      title="Processo bloqueado pelo servidor #{owner}" />

    <a:commandLink
      action="#{taskInstanceHome.removeUsuario(idProcesso,tarefaId)}"
      execute="@this" render="painelProcessos, pageBodyDialogMessage"
      onclick="return confirm(\'#{messages['movimentar.confirmLiberarTarefa']}\');"
      limitRender="true"
      rendered="#{(owner != authenticator.getUsuarioLogado() and ! empty owner and authenticator.isUsuarioAtualResponsavel())}">
      <h:graphicImage url="#{a4jSkin.imgFolder}/role.gif"
        title="#{messages['painel.list.liberarTarefaServidor']} #{owner}" />
    </a:commandLink>
  </h:form>

</ui:composition>