<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib">

  <h:form>
    <ui:param name="idProcesso" value="#{row.idProcesso}" />
    <ui:param name="idTaskInstance" value="#{row.idTaskInstance}" />
    <ui:param name="owner" value="#{row.assignee}" />
    <ui:param name="showMovimentarToolBar" value="#{wi:get(showMovimentarToolBar, true)}" />

    <div style="display: inline-block;">
      <rich:dragSource type="#{row.taskNodeKey.toUpperCase()}" dragValue="#{row}" dragIndicator="indicator">
        <rich:dragIndicator id="indicator" acceptClass="caixa-acpt" draggingClass="caixa-drag" rejectClass="caixa-rejt">
          <span class="caixa-ind-lbl">#{infoxMessages['processo.titlePage']}: #{row.numeroProcessoRoot}</span>
        </rich:dragIndicator>
      </rich:dragSource>
      <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/annotate.png')}" title="#{infoxMessages['caixa.moverCaixa']}" />
    </div>

    <a:commandLink execute="@this" target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/visualizarProcesso.seam?idProcesso=#{idProcesso}&amp;idTaskInstance=#{idTaskInstance}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">
      <f:param name="idProcesso" value="#{idProcesso}" />
      <f:param name="idTaskInstance" value="#{idTaskInstance}" />
      <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/view.png')}" />
    </a:commandLink>

    <a:commandLink execute="@this" rendered="#{empty owner and showMovimentarToolBar}"
      target="#{idProcesso}popUpFluxo"
      render="@form"
      onclick="open('#{pathResolver.contextPath}/Processo/movimentar.seam?idProcesso=#{idProcesso}&amp;idTaskInstance=#{idTaskInstance}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">
      <f:param name="idProcesso" value="#{idProcesso}" />
      <f:param name="idTaskInstance" value="#{idTaskInstance}" />
      <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/mod/edit.png')}" />
    </a:commandLink>

    <a:commandLink execute="@this"
      rendered="#{owner eq authenticator.getUsuarioLogado().login and showMovimentarToolBar}"
      target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/movimentar.seam?idProcesso=#{idProcesso}&amp;idTaskInstance=#{idTaskInstance}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">
      <f:param name="idProcesso" value="#{idProcesso}" />
      <f:param name="idTaskInstance" value="#{idTaskInstance}" />
      <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/processAssigned.png')}" />
    </a:commandLink>

    <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/role.gif')}"
      rendered="#{(owner ne authenticator.getUsuarioLogado().login and not empty owner and not authenticator.isUsuarioAtualResponsavel()) and showMovimentarToolBar}"
      title="Processo bloqueado pelo servidor #{row.nomeUsuarioTarefa}" />

    <a:commandLink
      action="#{painelUsuarioController.liberarTarefa(row)}"
      execute="@this" render="baseBody, pageBodyDialogMessage"
      onclick="return confirm(\'#{infoxMessages['movimentar.confirmLiberarTarefa']}\');"
      limitRender="true"
      rendered="#{(owner ne authenticator.getUsuarioLogado().login and not empty owner and authenticator.isUsuarioAtualResponsavel())}">
      <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/role.gif')}"
        title="#{infoxMessages['painel.list.liberarTarefaServidor']} #{row.nomeUsuarioTarefa}" />
    </a:commandLink>
  </h:form>

</ui:composition>