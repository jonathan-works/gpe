<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib">

  <h:form>
    <ui:param name="idProcesso" value="#{row.idProcesso}" />
    <ui:param name="tarefaId" value="#{painelUsuarioController.tarefaId}" />
    <ui:param name="owner" value="#{userHandler.getUsuarioByIdTarefa(tarefaId, idProcesso)}" />
    <ui:param name="inTabExpedidas" value="#{painelUsuarioController.selectedFluxo.expedida}" />
    <ui:param name="showMovimentarToolBar" value="#{wi:get(showMovimentarToolBar, true)}" />

    <a:outputPanel>

      <rich:dragSource type="task#{tarefaId}" dragValue="#{row}"
        dragIndicator="indicator">
        <rich:dragIndicator
          id="indicator"
          acceptClass="caixa-acpt"
          draggingClass="caixa-drag"
          rejectClass="caixa-rejt"
        >
          <span class="caixa-ind-lbl">#{infoxMessages['processo.titlePage']}: #{row.numeroProcessoRoot}</span>
        </rich:dragIndicator>
      </rich:dragSource>

      <h:graphicImage url="#{wiSkin.imageFolder}/annotate.png" title="#{infoxMessages['caixa.moverCaixa']}" />

    </a:outputPanel>

    <a:commandLink execute="@this" target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/visualizarProcesso.seam?idProcesso=#{idProcesso}&amp;tarefaId=#{tarefaId}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">

      <f:param name="idProcesso" value="#{idProcesso}" />

      <f:param name="tarefaId" value="#{tarefaId}" />

      <h:graphicImage url="#{wiSkin.imageFolder}/view.png" />

    </a:commandLink>

    <a:commandLink execute="@this" rendered="#{empty owner and showMovimentarToolBar}"
      target="#{idProcesso}popUpFluxo"
      render="baseBody"
      onclick="open('#{pathResolver.contextPath}/Processo/movimentar.seam?idProcesso=#{idProcesso}&amp;tarefaId=#{tarefaId}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">

      <f:param name="idProcesso" value="#{idProcesso}" />

      <f:param name="tarefaId" value="#{tarefaId}" />

      <h:graphicImage url="#{wiSkin.imageFolder}/mod/edit.png" />

    </a:commandLink>

    <a:commandLink execute="@this"
      rendered="#{owner == authenticator.getUsuarioLogado() and showMovimentarToolBar}"
      target="#{idProcesso}popUpFluxo"
      onclick="open('#{pathResolver.contextPath}/Processo/movimentar.seam?idProcesso=#{idProcesso}&amp;tarefaId=#{tarefaId}', '#{idProcesso}popUpFluxo', 'fullscreen=1, resizable=yes,scrollbars=1');">

      <f:param name="idProcesso" value="#{idProcesso}" />

      <f:param name="tarefaId" value="#{tarefaId}" />

      <h:graphicImage url="#{wiSkin.imageFolder}/processAssigned.png" />

    </a:commandLink>

    <h:graphicImage url="#{wiSkin.imageFolder}/role.gif"
      rendered="#{(owner != authenticator.getUsuarioLogado() and ! empty owner and !authenticator.isUsuarioAtualResponsavel()) and showMovimentarToolBar}"
      title="Processo bloqueado pelo servidor #{owner}" />

    <a:commandLink
      action="#{taskInstanceHome.removeUsuario(idProcesso,tarefaId)}"
      execute="@this" render="baseBody, pageBodyDialogMessage"
      onclick="return confirm(\'#{infoxMessages['movimentar.confirmLiberarTarefa']}\');"
      limitRender="true"
      rendered="#{(owner != authenticator.getUsuarioLogado() and ! empty owner and authenticator.isUsuarioAtualResponsavel())}">
      <h:graphicImage url="#{wiSkin.imageFolder}/role.gif"
        title="#{infoxMessages['painel.list.liberarTarefaServidor']} #{owner}" />
    </a:commandLink>
  </h:form>

</ui:composition>