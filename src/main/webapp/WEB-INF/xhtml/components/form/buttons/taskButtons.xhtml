<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:wi="http://www.itx.com.br/jsf">

	<!--
	  IBPM - Ferramenta de produtividade Java
	  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
	 
	  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
	  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
	  Free Software Foundation; versão 2 da Licença.
	  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
	  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
	  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
	  
	  Consulte a GNU GPL para mais detalhes.
	  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
	  veja em http://www.gnu.org/licenses/  
	-->

	<s:div
		id="taskButtonsDiv"
		styleClass="actionButtons"
		>
		<ui:param
			name="props"
			value="#{form.buttons.properties}" />
		<ui:param
			name="reRenderSave"
			value="#{empty reRenderSave ? formId : reRenderSave}" />

		<a:commandButton
			id="update"
			status="none"
			rendered="#{!empty form.fields and processoHome.managed and !isUsuarioExterno}"
			onmouseup="showLoading()"
			oncomplete="#{oncomplete};hideLoading()"
			render="#{reRenderSave},:pageBodyDialogMessage"
			value="#{messages['crud.update']}"
			styleClass="buttons"
			action="#{taskInstanceHome.update(home)}" />
		
		<!-- Implementar -->
		<a:commandButton
			id="unlock"
			execute="@this"
			status="none"
			rendered="#{processoHome.managed and !isUsuarioExterno}"
			onmouseup="showLoading()"
			oncomplete="#{oncomplete};hideLoading();close()"
			render="#{reRenderSave}"
			value="Liberar Tarefa"
			styleClass="buttons"
			action="#{taskInstanceHome.removeUsuario()}" />

		<a:commandButton
			id="persist"
			rendered="#{!empty form.fields and !processoHome.managed and !isUsuarioExterno}"
			status="none"
			onmouseup="showLoading()"
			oncomplete="hideLoading()"
			render="#{reRenderSave}"
			value="#{messages['crud.persist']}"
			styleClass="buttons"
			action="#{taskInstanceHome.persist(home)}" />

		<h:outputText
			value="Próxima ação:" />
		<c:if test="#{taskInstanceHome.transitions.size gt 3}">
			<h:selectOneMenu
				value="#{taskInstanceHome.name}">
				<f:selectItems value="#{taskInstanceHome.transtionsSelectItems}" />
			</h:selectOneMenu>
			<a:commandButton
				action="#{taskInstanceHome.end(taskInstanceHome.name)}"
				value="OK"
				status="none"
				onmouseup="showLoading()"
				styleClass="buttons"
				oncomplete="verifyFields();"
				render=":script,#{reRenderSave},:pageBodyDialogMessage" />
		</c:if>
		<c:if test="#{taskInstanceHome.transitions.size le 3}">
			<a:repeat
				value="#{taskInstanceHome.transitions}"
				var="transition">
				<a:commandButton
					status="none"
					onmouseup="showLoading()"
					oncomplete="verifyFields();"
					render=":pageBodyDialogMessage,:script,#{reRenderSave}"
					value="#{transition.name}"
					styleClass="buttons"
					action="#{taskInstanceHome.end(transition.name)}">
				</a:commandButton>
			</a:repeat>
		</c:if>
		
		<ui:fragment rendered="#{jbpmUtil.isUsuarioLogadoResponsavelLocalizacao()}">
			<h:outputText value="Prioridade:" style="font-size: 13px; margin-left: 40px;"/>
			<h:selectOneMenu value="#{processoHome.instance.prioridadeProcesso}">
				<s:selectItems value="#{prioridadeProcessoList.list()}" var="p" label="#{p.descricaoPrioridade}" 
					noSelectionLabel="Selecione..."/>
				<s:convertEntity/>
			</h:selectOneMenu>
		</ui:fragment>
	</s:div>

</ui:composition>
