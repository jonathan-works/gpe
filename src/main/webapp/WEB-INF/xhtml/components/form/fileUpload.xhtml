<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf">
  <ui:param
    name="template"
    value="#{wi:get(template, '/WEB-INF/xhtml/components/templates/edit.xhtml')}" />
  <ui:param name="readonly" value="#{empty readonly ? true : props.readonly}" />
<f:subview id="#{f.id}SubView">
    <s:div id="#{f.id}TipoDocDiv" styleClass="padding-top-10">
      <wi:selectOneMenuEntity
        id="#{f.id}tipoProcessoDocumento"
        label="#{eppmessages['processoDocumento.classificacaoDocumento']}"
        value="#{home.classificacoesVariaveisUpload[id]}"
        items="#{classificacaoDocumentoFacade.getUseableClassificacaoDocumento(false, taskInstanceHome.getVariableName(id), processoEpaHome.instance.naturezaCategoriaFluxo.fluxo.idFluxo)}"
        required="true"
        showLabelSelecione="true"
        rendered="#{not readonly}">
        <a:ajax
         render="#{f.id}TipoDocDiv #{f.id}Decoration #{f.id}ToolTipDivExterna"
         event="change"
         execute="@this"
         limitRender="true" />
      </wi:selectOneMenuEntity>
    </s:div>
    <s:div id="#{f.id}ToolTipDivExterna">
	    <s:div id="#{f.id}ToolTipDiv" styleClass="tooltip-parent" style="width: 10px" rendered="#{not empty home.classificacoesVariaveisUpload[id] and not readonly}">
			<h:graphicImage id="#{id}helpEditTipImg" url="#{a4jSkin.imgFolder}/help.gif" />
			<div class="epp-tooltip">
				<div class="tooltip-panel">
					<s:div rendered="#{empty taskInstanceHome.classificacoesVariaveisUpload[id]}">
						<h:outputText value="Selecione uma classificação de documento" />
					</s:div>
					<s:div rendered="#{not empty taskInstanceHome.classificacoesVariaveisUpload[id]}">
						<div><h:outputText value="Extensões Aceitas:"/></div>
						<ui:repeat var="documento" value="#{taskInstanceHome.classificacoesVariaveisUpload[id].acceptedTypesList}">
							<div><h:outputText value="#{documento}" styleClass="tooltip-panel-div"/></div>
						</ui:repeat>
						<s:div styleClass="tooltip-panel-top" rendered="#{not empty taskInstanceHome.classificacoesVariaveisUpload[id].observacao}">
							<div>
								<h:outputText value="Observação:"/>
							</div>
							<h:outputText value="#{taskInstanceHome.classificacoesVariaveisUpload[id].observacao}" />
						</s:div>
					</s:div>
				</div>
			</div>
		</s:div>
	</s:div>
    <s:decorate
    id="#{id}Decoration"
    template="#{template}">
		<ui:define name="label">#{label}</ui:define>
        <rich:fileUpload
          id="#{id}"
          execute="@this"
          status=":status"
          limitRender="true"
          required="#{wi:get(required, false)}"
          fileUploadListener="#{fileUpload.processFileUpload}"
          addLabel="#{eppmessages['processoDocumento.addLabel']}"
          clearAllLabel="#{eppmessages['processoDocumento.clearAllLabel']}"
          clearLabel="#{eppmessages['processoDocumento.clearLabel']}"
          doneLabel="#{eppmessages['processoDocumento.doneLabel']}"
          uploadLabel="#{eppmessages['processoDocumento.uploadLabel']}"
          sizeExceededLabel="#{eppmessages['processoDocumento.sizeExceededLabel']}"
          maxFilesQuantity="1"
          listHeight="50px"
          immediateUpload="true"
          noDuplicate="true"
          render="#{id}Decoration, #{id}, #{reRender}, pageBodyDialogMessage, #{f.id}TipoDocDiv, #{f.id}documentoExistente"
          acceptedTypes="#{home.classificacoesVariaveisUpload[id].acceptedTypes}"
          rendered="#{not empty home.classificacoesVariaveisUpload[id] and not readonly}"
          ontyperejected="new infox.Messages({'timeout': 3000}).dialog(\'#{eppmessages['processoDocumento.extensaoNaoPermitida']}\')">
        </rich:fileUpload>
    </s:decorate>
    <s:div id="#{f.id}documentoExistente">
        <s:fragment rendered="#{not empty taskInstanceHome.instance[id]}">    
            <fieldset>
                <legend>Documento Anexado</legend>
                <h:outputText value="#{eppmessages['processoDocumento.classificacaoDocumento']}: #{not readonly ? taskInstanceHome.classificacoesVariaveisUpload[id].descricao : props.classificacaoDocumento}"/>
                <br />
                <h:outputText id="file#{id}" value="Documento: #{not readonly ? taskInstanceHome.instance[id] : value}"/>
            </fieldset>
        </s:fragment>
    </s:div>
  </f:subview>
</ui:composition>