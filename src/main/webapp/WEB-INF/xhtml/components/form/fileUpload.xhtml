<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf">
  <ui:param
    name="template"
    value="#{wi:get(template, '/WEB-INF/xhtml/components/templates/edit.xhtml')}" />
  
<f:subview id="#{f.id}SubView">
    <s:div id="#{f.id}TipoDocDiv">
      <wi:selectOneMenuEntity
        id="#{f.id}tipoProcessoDocumento"
        label="#{messages['processoDocumento.classificacaoDocumento']}"
        value="#{home.classificacoesVariaveisUpload[id]}"
        items="#{classificacaoDocumentoFacade.getUseableTipoProcessoDocumento(false, taskInstanceHome.getVariableName(id), processoHome.instance.naturezaCategoriaFluxo.fluxo.idFluxo)}"
        required="#{not readonly}"
        showLabelSelecione="true"
        readonly="#{readonly}"
        disabled="#{readonly}">
        <a:ajax
         render="#{f.id}TipoDocDiv, #{f.id}Decoration"
         event="change"
         execute="@this"
         limitRender="true" />
      </wi:selectOneMenuEntity>
    </s:div>
  
    <s:decorate
    id="#{id}Decoration"
    template="#{template}">
        <ui:param
          name="tipMessage"
          value="#{not empty taskInstanceHome.classificacoesVariaveisUpload[id] ? 'Apenas arquivos '.concat(taskInstanceHome.classificacoesVariaveisUpload[id].acceptedTypes) : 'Selecione uma classificação de documento'}" />
        <ui:define name="label">#{label}</ui:define>
        <rich:fileUpload
          id="#{id}"
          execute="@this"
          status=":status"
          limitRender="true"
          required="#{wi:get(required, false)}"
          fileUploadListener="#{fileUpload.processFileUpload}"
          addLabel="#{messages['processoDocumento.addLabel']}"
          clearAllLabel="#{messages['processoDocumento.clearAllLabel']}"
          clearLabel="#{messages['processoDocumento.clearLabel']}"
          doneLabel="#{messages['processoDocumento.doneLabel']}"
          uploadLabel="#{messages['processoDocumento.uploadLabel']}"
          sizeExceededLabel="#{messages['processoDocumento.sizeExceededLabel']}"
          maxFilesQuantity="1"
          listHeight="50px"
          immediateUpload="true"
          noDuplicate="true"
          render="#{id}Decoration, #{id}, #{reRender}, pageBodyDialogMessage, #{f.id}TipoDocDiv, #{f.id}documentoExistente"
          acceptedTypes="#{home.classificacoesVariaveisUpload[id].acceptedTypes}"
          rendered="#{not empty home.classificacoesVariaveisUpload[id]}"
          ontyperejected="new infox.Messages({'timeout': 6000}).dialog(\'#{messages['processoDocumento.extensaoNaoPermitida']}\')">
        </rich:fileUpload>
    </s:decorate>
    <s:div id="#{f.id}documentoExistente">
        <s:fragment rendered="#{not empty taskInstanceHome.instance[id]}">    
            <fieldset>
                <legend>Documento Anexado</legend>
                <h:outputText value="#{messages['processoDocumento.classificacaoDocumento']}: #{taskInstanceHome.classificacoesVariaveisUpload[id].tipoProcessoDocumento}"/>
                <br />
                <h:outputText id="file#{id}" value="Documento: #{taskInstanceHome.instance[id]}"/>
            </fieldset>
        </s:fragment>
    </s:div>
  </f:subview>
</ui:composition>