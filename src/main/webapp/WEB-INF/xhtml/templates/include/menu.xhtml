<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: menu.xhtml 750 2010-08-24 14:10:58Z danielsilva $ -->
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf">

    <h:form>
        <a:jsFunction status="status" name="refreshPage"
            render="pageBody" limitRender="true" />
    </h:form>
    <script type="text/javascript">
					window.addEventListener("load", function() {
						alert("Remover a referÃªncia para este menu");
					});
				</script>
    <ui:param name="mostrarMenu"
        value="#{identity.loggedIn and !usuarioLogado.provisorio}" />

    <h:form rendered="#{mostrarMenu}">
        <table cellspacing="0" cellpadding="0">
            <tr>
                <td class="modPesqEsq" />
                <td class="modPesqBg"><span>
                        Pesquisar </span> <h:inputText
                        styleClass="modPesqInputText" id="searchText"
                        value="#{search.searchText}" /></td>
                <td class="modPesqBg"><h:commandButton
                        action="/Pesquisa/searchResult.xhtml"
                        image="#{a4jSkin.imgFolder}/imgPes.png" /></td>
                <td class="modPesqBg" valign="top"><h:graphicImage
                        url="#{a4jSkin.imgFolder}/mod/palette.gif"
                        title="Alterar o esquema de cores"
                        onclick="Richfaces.showModalPanel('skinPanel')" />

                    <h:commandButton action="#{skinZoom.setTmNormal()}"
                        image="#{a4jSkin.imgFolder}/zoom-normal.png" />

                    <h:commandButton action="#{skinZoom.setTmMedio()}"
                        image="#{a4jSkin.imgFolder}/zoom-medio.png" />

                    <h:commandButton action="#{skinZoom.setTmGrande()}"
                        image="#{a4jSkin.imgFolder}/zoom-grande.png" />
                </td>
            </tr>
        </table>
    </h:form>

    <s:div>
        <h:outputText value="#{usuarioLogado}"
            rendered="#{identity.loggedIn}" />

        <h:form id="papeisUsuarioForm">
            <wi:selectOneMenuEntity
                value="#{authenticator.localizacaoAtualCombo}"
                rendered="#{authenticator.usuarioLocalizacaoListItems.size() gt 1}"
                id="usuarioLocalizacao"
                template="/WEB-INF/xhtml/components/templates/display.xhtml"
                onchange="this.form.submit()"
                items="#{authenticator.usuarioLocalizacaoListItems}">
            </wi:selectOneMenuEntity>
            <br />
            <h:outputText
                value="#{authenticator.usuarioLocalizacaoListItems[0]}"
                rendered="#{identity.loggedIn and authenticator.usuarioLocalizacaoListItems.size() == 1}" />
        </h:form>

    </s:div>
#{mostrarMenu}
	<rich:toolbar width="100%">
        <c:if test="#{mostrarMenu}">
            <rich:toolbarGroup>
                <s:link view="/home.xhtml" value="Home" />
            </rich:toolbarGroup>
            <c:forEach items="#{mainMenu.dropMenus}" var="drop">
                <c:if test="#{empty drop.url}">
                    <h:form>
                        <rich:dropDownMenu value="#{drop.label}">
                            <ui:include
                                src="/WEB-INF/xhtml/templates/subMenu.xhtml">
                                <ui:param name="subMenu" value="#{drop}" />
                            </ui:include>
                        </rich:dropDownMenu>
                    </h:form>
                </c:if>
                <c:if test="#{!empty drop.url}">
                    <h:form>
                        <rich:menuItem submitMode="server"
                            label="#{drop.label}" action="#{drop.url}">
                            <s:conversationPropagation type="end" />
                        </rich:menuItem>
                    </h:form>
                </c:if>
            </c:forEach>
        </c:if>
        <rich:toolbarGroup location="right">
            <s:link view="/login.xhtml" value="Login"
                rendered="#{not identity.loggedIn}" />
            <s:link view="/home.xhtml" action="#{identity.logout}"
                value="Logout" rendered="#{identity.loggedIn}" />
            <wi:helpIcon />
        </rich:toolbarGroup>
    </rich:toolbar>

    <rich:popupPanel id="skinPanel" height="100">
        <f:facet name="header">#{messages['skin.title']}</f:facet>
        <f:facet name="controls">
            <h:panelGroup>
                <h:graphicImage value="#{a4jSkin.imgFolder}/closeMP.gif"
                    onclick="Richfaces.hideModalPanel('skinPanel')" />
            </h:panelGroup>
        </f:facet>
        <s:decorate
            template="/WEB-INF/xhtml/components/templates/edit.xhtml">
            <ui:define name="label">
                <h:outputText value="#{messages['skin.choice']}"
                    styleClass="label" />
            </ui:define>
            <h:form>
                <h:selectOneMenu value="#{wiSkin.skin}"
                    onchange="this.form.submit()">
                    <f:selectItems value="#{wiSkin.skinList}" />
                </h:selectOneMenu>
            </h:form>
        </s:decorate>
    </rich:popupPanel>

</ui:composition>
