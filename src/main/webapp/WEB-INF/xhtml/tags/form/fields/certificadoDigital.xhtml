<?xml version="1.0" encoding="UTF-8"?>

<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf">

  <h:panelGroup id="#{empty id ? 'divApplet' : id}">
    <s:fragment rendered="#{empty rendered ? true : rendered}">

      <h:inputHidden id="#{id}SignId" value="#{signIdField}" />  
      <h:commandButton type="button" styleClass="buttons" 
      		onclick="infox.CertDig.#{id}.init();"
      		value="#{empty signButtonCaption ? 'Assinar Digitalmente' : signButtonCaption}" />
      <h:outputScript name="cookies.min.js" library="js" />  
      <h:outputScript>
          namespace('infox.CertDig.#{id}', {  
  	          init: function() {  
  	              #{functionPreSign};  
  	        	  location.href='#{pathResolver.contextPath}/certificadodigital/jnlp?md5=#{signableData}';  
  	        	  var intervalId = setInterval(function() {  
  	        	  var signId = Cookies.get('br.com.infox.epp.sign.id');  
  	        	  $.get('#{pathResolver.contextPath}/certificadodigital/checksign?id=' + signId, function(data) {  
  	        		  if (data === 'true') {  
	  	        		  clearInterval(intervalId);  
	  	        		  #{rich:element(id.concat('SignId'))}.value = signId;  
	  	        		  #{functionPosSign};  
  	        	  	  }  
  			  	  });  
  		      }, 2000);  
  		      setTimeout(function() { clearInterval(intervalId); #{functionPosSign}; }, 8000 * 60);  
  		   }  
  	   });  
	  </h:outputScript>
    </s:fragment>
  </h:panelGroup>
</ui:composition>