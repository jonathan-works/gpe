<?xml version="1.0" encoding="UTF-8"?>
<!--
  IBPM - Ferramenta de produtividade Java
  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
 
  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
  Free Software Foundation; versão 2 da Licença.
  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
  
  Consulte a GNU GPL para mais detalhes.
  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
  veja em http://www.gnu.org/licenses/  
-->
<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:wi="http://www.itx.com.br/jsf">
	
	<h:outputScript
		library="js"
		name="tree.js" />
	<ui:param
		name="id"
		value="#{wi:get(gridId, formId)}#{id}" />
	<ui:param
		name="width"
		value="#{wi:get(width, 248)}" />
	<ui:param
		name="folderSelectable"
		value="#{wi:get(folderSelectable, tree.folderSelectable)}" />
	<ui:param
		name="expanded"
		value="#{wi:get(expanded, false)}" />
	<ui:param
		name="template"
		value="#{wi:get(template, '/WEB-INF/xhtml/components/templates/edit.xhtml')}" />

	<s:decorate
		template="#{template}"
		id="#{id}TreeDecoration"
		styleClass="decoration-div tree-div #{wi:get(decorationClass,'')}"
		rendered="#{empty rendered or rendered}">

		<ui:define name="label">#{label}</ui:define>

		<c:if test="#{!empty assignTo}">
			#{tree.setExpression(assignTo)}
		</c:if>

		<s:div
			id="#{id}Form"
			styleClass="tree">

			<s:div id="#{id}HiddenId">
				<h:inputHidden
					id="#{id}Hidden"
					required="#{required and empty tree.selected}"
					rendered="#{required}"
					value="#{tree.selected}">
					<s:convertEntity />
				</h:inputHidden>
				<script>
				//<![CDATA[
				    namespace(["infox.escapeId"],function(escapeId) {
						if (#{empty tree.selected} && #{required}) {
							var id = escapeId("##{rich:clientId(id.concat('Hidden'))}"); 
							$(id).val(-1);
						}
				    });
				//]]>
				</script>
			</s:div>

			<ui:param
				name="border"
				value="#{invalid ? 'red' : 'inherit'}" />

			<rich:collapsiblePanel
				id="#{id}Panel"
				headerClass="tree-hdr"
				bodyClass="tree-b"
				styleClass="tree-p"
				onswitch="setZIndex('#{rich:clientId(id.concat('Panel'))}')"
				immediate="true"
				switchType="client"
				status=":status"
				header="#{tree.getSelectedView(tree.selected)}"
				expanded="#{expanded}">
				
				<wi:treePanel
					switchType="#{switchType}"
					onclick="#{folderSelectable ? '' : 'return false;'};"/>
			</rich:collapsiblePanel>
			
			<s:div
				id="#{id}ClearDiv"
				styleClass="tree-div-clear">
				<a:commandLink
					id="#{id}Close"
					status="status"
					rendered="#{!empty tree.selected}"
					action="#{tree.clearTree(rich:clientId(id.concat('Tree')))}"
					immediate="true"
					render="#{id}Form">
					<h:graphicImage
						value="#{a4jSkin.imgIconClear}"
						title="Limpar" />
				</a:commandLink>
				<h:graphicImage
					value="#{a4jSkin.imgIconClearOff}"
					rendered="#{empty tree.selected}"
					title="Limpar" />
			</s:div>

		</s:div>

	</s:decorate>

</ui:composition>
