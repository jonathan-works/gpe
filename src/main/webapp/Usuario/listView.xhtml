<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
  IBPM - Ferramenta de produtividade Java
  Copyright (c) 1986-2009 Infox Tecnologia da Informação Ltda.
 
  Este programa é software livre; você pode redistribuí-lo e/ou modificá-lo 
  sob os termos da GNU GENERAL PUBLIC LICENSE (GPL) conforme publicada pela 
  Free Software Foundation; versão 2 da Licença.
  Este programa é distribuído na expectativa de que seja útil, porém, SEM 
  NENHUMA GARANTIA; nem mesmo a garantia implícita de COMERCIABILIDADE OU 
  ADEQUAÇÃO A UMA FINALIDADE ESPECÍFICA.
  
  Consulte a GNU GPL para mais detalhes.
  Você deve ter recebido uma cópia da GNU GPL junto com este programa; se não, 
  veja em http://www.gnu.org/licenses/  
-->
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/tabbedTemplate.xhtml">


    <ui:define name="title">#{messages['usuario.titlePage']}</ui:define>

    <ui:param
        name="home"
        value="#{usuarioHome}" />

    <ui:define name="searchGrid">
        <wi:dataTable
            values="#{usuarioLoginList.list(15)}"
            bean="#{usuarioLoginList}"
            tableTitle="#{messages['usuario.titleGrid']}"
            id="usuarioList"
            rowId="#{row.idPessoa}">
            <ui:define name="searchForm">
                <wi:searchForm
                    formId="pesquisarUsuarioForm"
                    formTitle="#{messages['searchForm.title']}">
                    <wi:inputText
                        id="nome"
                        label="#{messages['usuario.nome']}"
                        value="#{usuarioLoginList.entity.nome}"
                        maxlength="255" />
                    <wi:selectSituacaoOneMenu
                        id="ativo"
                        label="#{messages['field.situacao']}"
                        value="#{usuarioLoginList.entity.ativo}" />
                </wi:searchForm>
            </ui:define>
            <wi:columnOutputText
                columnId="nome"
                columnHeader="#{messages['usuario.nome']}"
                value="#{row.nome}" />
            <wi:columnBoolean
                columnId="bloqueio"
                columnHeader="#{messages['usuario.bloqueio']}"
                value="#{row.bloqueio}" />
            <wi:columnBoolean
                columnId="provisorio"
                columnHeader="#{messages['usuario.provisorio']}"
                value="#{row.provisorio}" />
            <wi:columnSituacao
                columnId="ativo"
                columnHeader="#{messages['field.situacao']}"
                value="#{row.ativo}" />
            <ui:define name="headerToolBar" />
        </wi:dataTable>
    </ui:define>
    <ui:define
        name="form"
        action="#{usuarioHome.newInstance()}">
        <c:if test="#{canEdit}">
            <wi:dataForm
                formId="usuarioForm"
                formTitle="#{messages['form.title']}">
                <wi:inputCpf
                    id="cpf"
                    label="CPF"
                    value="#{usuarioHome.instance.cpf}"
                    assignTo="#{usuarioHome.instance.cpf}"
                    required="true">
                    <a:ajax
                        event="blur"
                        listener="#{usuarioHome.searchByCpf(usuarioHome.instance.cpf)}"
                        execute="@this"
                        render="usuarioForm"
                        limitRender="true" />
                </wi:inputCpf>
                <wi:inputText
                    id="nomeUsuario"
                    label="#{messages['usuario.nome']}"
                    value="#{usuarioHome.instance.nome}"
                    required="true" />
                <wi:inputDate
                    id="dataNascimento"
                    value="#{usuarioHome.instance.dataNascimento}"
                    label="#{messages['pessoaFisica.dataNascimento']}"
                    required="true" />
                <wi:inputText
                    id="email"
                    label="E-mail"
                    value="#{usuarioHome.instance.email}"
                    required="true">
                    <f:validator validatorId="emailValidator" />
                </wi:inputText>
                <wi:inputText
                    id="login"
                    label="Login"
                    value="#{usuarioHome.instance.login}"
                    required="true"
                    maxlength="15" />
                <wi:selectOneRadio
                    id="ativo"
                    label="#{messages['field.situacao']}"
                    value="#{usuarioHome.instance.ativo}"
                    valueList="true:Ativo,false:Inativo" />
                <ui:include
                    src="/WEB-INF/xhtml/components/form/usuarioProvisorio.xhtml" />
                <ui:include
                    src="/WEB-INF/xhtml/components/form/bloqueio.xhtml" />
            </wi:dataForm>
        </c:if>
    </ui:define>
    <ui:define name="tabs">
        <rich:tab
            label="#{messages['endereco.titlePage']}"
            status=":status"
            id="endereco2"
            rendered="#{home.isManaged()}"
            action="#{enderecoHome.newInstance()}">
            <s:div>
                <wi:ajaxDiv id="divGridEnd">
                    <c:if test="#{canEdit}">
                        <wi:form
                            columns="3"
                            msgRendered="false"
                            formTitle="Adicionar Endereço - #{(usuarioHome.instance)}"
                            form="#{enderecoForm}"
                            reRenderSave="divGridEnd"
                            home="#{enderecoHome}" />
                    </c:if>
                    <wi:datalist
                        home="#{enderecoHome}"
                        bean="#{enderecoGrid}"
                        gridId="enderecoGridTab"
                        toolBar="toolBarEditRemove"
                        searchBean="#{enderecoSearch}"
                        listReRender="divGridEnd"
                        linkDetalhe="/Endereco/listView.xhtm"
                        headerToolBar="none"
                        columnList="nomeLogradouro, nomeBairro"
                        title="#{messages['endereco.titlePage']} - #{(usuarioHome.instance)}" />
                </wi:ajaxDiv>
            </s:div>
        </rich:tab>
        <rich:tab
            id="localizacaoUsuario"
            label="#{messages['localizacao.usuarioLocalizacaoList']}"
            status=":status"
            rendered="#{home.isManaged()}"
            action="#{usuarioLocalizacaoHome.newInstance()}">
            <s:div>
                <wi:ajaxDiv id="divGridLU">
                    <wi:form
                        columns="3"
                        msgRendered="false"
                        formTitle="Adicionar Localização - #{(usuarioHome.instance)}"
                        form="#{usuarioLocalizacaoForm}"
                        home="#{usuarioLocalizacaoHome}"
                        reRenderSave="divGridLU"
                        mostrarNovo="false"
                        mostrarVoltar="false" />
                    <wi:datalist
                        home="#{usuarioLocalizacaoHome}"
                        bean="#{usuarioLocalizacaoGrid}"
                        gridId="usuarioLocalizacaoGridTab"
                        toolBar="toolBarEditRemove"
                        listReRender="divGridLU"
                        headerToolBar="none"
                        columnList="localizacao, papel"
                        title="#{messages['localizacao.usuarioLocalizacaoList']} - #{(usuarioHome.instance)}" />
                </wi:ajaxDiv>
            </s:div>
        </rich:tab>

        <rich:tab
            id="historicoBloqueioUsuario"
            label="#{messages['bloqueioUsuario.historicoBloqueioList']}"
            rendered="#{home.isManaged()}">
            <s:div>
                <wi:ajaxDiv id="divHistoricoList">
                    <wi:dataTable
                        values="#{bloqueioUsuarioList.list(15)}"
                        bean="#{bloqueioUsuarioList}"
                        tableTitle="#{messages['bloqueioUsuario.titleGrid']}"
                        id="bloqueioUsuarioList"
                        rowId="#{row.idBloqueioUsuario}">
                        <ui:define name="searchForm">
                            <wi:searchForm
                                formId="pesquisarBloqueiosForm"
                                formTitle="#{messages['searchForm.title']}">
                                <wi:inputDate
                                    id="dataBloqueio"
                                    value="#{bloqueioUsuarioList.entity.dataBloqueio}"
                                    label="#{messages['bloqueioUsuario.dataBloqueio']}" />
                                <wi:inputText
                                    id="motivoBloqueio"
                                    label="#{messages['bloqueioUsuario.motivoBloqueio']}"
                                    value="#{bloqueioUsuarioList.entity.motivoBloqueio}"
                                    maxlength="150" />
                                <wi:inputDate
                                    id="dataDesloqueio"
                                    value="#{bloqueioUsuarioList.entity.dataDesbloqueio}"
                                    label="#{messages['bloqueioUsuario.dataDesbloqueio']}" />
                            </wi:searchForm>
                        </ui:define>

                        <wi:columnDateTime
                            columnId="dataBloqueio"
                            columnHeader="#{messages['bloqueioUsuario.dataBloqueio']}"
                            value="#{row.dataBloqueio}" />
                        <wi:columnDateTime
                            columnId="dataPrevisaoDesbloqueio"
                            columnHeader="#{messages['bloqueioUsuario.dataPrevisaoDesbloqueio']}"
                            value="#{row.dataPrevisaoDesbloqueio}" />
                        <wi:columnOutputText
                            columnId="motivoBloqueio"
                            columnHeader="#{messages['bloqueioUsuario.motivoBloqueio']}"
                            value="#{row.motivoBloqueio}" />
                        <wi:columnDateTime
                            columnId="dataDesbloqueio"
                            columnHeader="#{messages['bloqueioUsuario.dataDesbloqueio']}"
                            value="#{row.dataDesbloqueio}" />
                    </wi:dataTable>
                </wi:ajaxDiv>
            </s:div>
        </rich:tab>
    </ui:define>
</ui:composition>
