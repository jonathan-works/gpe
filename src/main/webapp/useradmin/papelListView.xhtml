<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:infox="http://www.infox.com.br/jsf"
	xmlns:wi="http://www.itx.com.br/jsf"
	template="/WEB-INF/xhtml/templates/core/defaultTemplate.xhtml">
	

    <ui:param
		 name="canEdit"
		 value="#{s:hasPermission('seam.role', 'update')}" />

    <ui:param
		 name="home"
		 value="#{papelHome}" />

    <ui:define name="title">Cadastro de Papéis</ui:define>

    <ui:define name="searchGrid">
		
        <wi:dataTable
			 values="#{papelList.list(15)}"
			 bean="#{papelList}"
			 tableTitle="#{messages['papel.titleGrid']}"
			 id="papelList"
			 rowId="#{row.idPapel}">
			
            <ui:define name="searchForm">
				
                <wi:searchForm
					 formId="pesquisarPapelForm"
					 formTitle="#{messages['searchForm.title']}">
					
                    <wi:inputText
						 id="nome"
						 label="#{messages['papel.nome']}"
						 value="#{papelList.entity.nome}"
						 maxlength="100" />
                    <wi:inputText
						 id="identificador"
						 label="#{messages['papel.identificador']}"
						 value="#{papelList.entity.identificador}"
						 maxlength="100" />
                
				</wi:searchForm>
            
			</ui:define>
            <wi:columnOutputText
				 columnId="nome"
				 columnHeader="#{messages['papel.nome']}"
				 value="#{row.nome}" />
            <wi:columnOutputText
				 columnId="identificador"
				 columnHeader="#{messages['papel.identificador']}"
				 value="#{row.identificador}" />
            <ui:define name="headerToolBar" />
            <ui:define name="toolBar">
            	<wi:toolBarEdit id="papelListedit" />
            	<wi:toolBarRemove />
            </ui:define>
        
		</wi:dataTable>

    
	</ui:define>

    <ui:define name="form">
		<wi:dataForm
			formId="papel"
			formTitle="#{messages['form.title']}"
			updateAction="papelHome.save()"
			persistAction="papelHome.save()">
        	<ui:include src="papelEdit.xhtml" />
        </wi:dataForm>
    
	</ui:define>

    <ui:define name="tabs">
		
        <infox:tab
             id="tabPapeis"
             status=":status"
             title="Visão Hierárquica"
             name="tabPapeis"
             rendered="#{home.managed}">
            
            <a:commandButton
                 styleClass="buttons"
                 value="Inverter"
                 render="hForm"
                 action="#{rolesTree.inverter()}">
                
                <f:param
                     name="cid"
                     value="#{conversation.id}" />
            
            </a:commandButton>
            <span >
                 <h:outputText
                     rendered="#{rolesTree.invertida}"
                     value="Estrutura dos papéis que cedem permissões " />
                <h:outputText
                     rendered="#{!rolesTree.invertida}"
                     value="Estrutura dos papéis que recebem permissões " />
            
            </span>
            <rich:tree
                 data="#{item}"
                 selectionType="ajax"
                 render="pageBody"
                 nodeSelectListener="#{rolesTree.processTreeSelectionChange}"
                 
                 var="item">
                
                <rich:treeModelRecursiveAdaptor
                     roots="#{rolesTree.roots}"
                     nodes="#{item.nodes}">
                    
                    <rich:treeNode
                         iconCollapsed="/img/#{item.entity.identificador.startsWith('/') ? 'resource' : 'role'}.gif"
                         iconExpanded="/img/#{item.entity.identificador.startsWith('/') ? 'resource' : 'role'}.gif"
                         iconLeaf="/img/#{item.entity.identificador.startsWith('/') ? 'resource' : 'role'}.gif">
                        
                        <h:outputText value="#{item.entity}" />
                    
                    </rich:treeNode>
                
                </rich:treeModelRecursiveAdaptor>
            
            </rich:tree>
        
        </infox:tab>
    
	</ui:define>

</ui:composition>
