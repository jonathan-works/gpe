<?xml version="1.0" encoding="ISO-8859-1"?>

<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:wi="http://www.itx.com.br/jsf"
	template="/WEB-INF/xhtml/templates/core/baseTemplate.xhtml">
	
	<ui:define name="baseHead">
		<h:outputStylesheet
        library="styleSkinInfox"
        name="login.css" />
	</ui:define>

	<ui:define name="baseBody">
		<h:outputScript library="js/components" name="Modal.js" />
		<script type="text/javascript">
			namespace(["infox.Modal"],function(Modal) {
				$("#btnTrocar").click( function (){
					var isHidden = $(".novaSenha").toggleClass("visible").is(':hidden');
					$("#btnTrocar").val(isHidden ? "#{messages['login.trocarSenhaBtn']}" :"#{messages['login.naoTrocarSenhaBtn']}");
					$(".input_login.passwd").val('');
				});
				var panelTeste = new Modal({id:'panelTeste'});
				$("#btnTrocarSenha").click(panelTeste.show);
				$("#btnTrocarSenha2").click(panelTeste.hide);
				$("##{rich:clientId('closeBtn')}").click(panelTeste.hide);
			});
        </script>
		<s:div id="pageBody" styleClass="loginPageBody">
			<div class="corpoSuperior" />
			<div class="corpoInferior" />
			<ui:param name="useCertLogin"  value="#{(loginComCertificado or producao) and false}" />
			<div id="seletorSkinLogin" class="seletorSkinsLogin" >
				<ui:include src="/WEB-INF/xhtml/templates/seletorSkins.xhtml">
					<ui:param name="id" value="login" />
				    <ui:param name="mostrarMenu" value="true" />
				</ui:include>
			</div>
			<h:form id="login">
				<div id="blocoCentralLogin" class="blocoCentralLogin" >
					<div id="logo" class="logo">
					    <h:graphicImage
							title="Logo"
							styleClass="logo"
							url="#{a4jSkin.imgLogoLogin}"/>
			    	</div>
					<div id="bg_login" class="bg_login login">
						<div>
							<h:outputLabel for="username"
										   rendered="#{not useCertLogin}"
										   class="login-lbl"
										   value="#{messages['login.nomeUsuario']}">
							</h:outputLabel>
							<h:inputText id="username"
										 value="#{credentials.username}"
										 class="input_login"
										 rendered="#{not useCertLogin}"/>
						</div>
						<div>
							<h:outputLabel for="password"
									       rendered="#{not useCertLogin}"
									       class="login-lbl"
									       value="#{messages['login.senha']}">
							</h:outputLabel>
							<h:inputSecret id="password" 
										   value="#{credentials.password}"
										   rendered="#{not useCertLogin}"
										   class="input_login" />
						</div>
						<c:if test="#{not useCertLogin}">
							<div class="novaSenha">
								<h:outputLabel for="newPassword1"
											   rendered="#{not useCertLogin}"
											   class="login-lbl"
											   value="#{messages['login.novaSenha']}">
								</h:outputLabel>
								<h:inputSecret id="newPassword1"
											   class="input_login passwd"
											   value="#{authenticator.newPassword1}" />
							</div>
							<div class="novaSenha">
								<h:outputLabel for="newPassword2"
											   rendered="#{not useCertLogin}"
											   class="login-lbl"
											   value="#{messages['login.confirmacaoNovaSenha']}">
								</h:outputLabel>	
								<h:inputSecret id="newPassword2"
											   class="input_login passwd"
											   value="#{authenticator.newPassword2}"/>							
							</div>
						</c:if>
					</div>
					<div id="bg_login_inferior" class="bg_login_inferior login">
						<c:if test="#{not useCertLogin}">
							<h:commandButton
								id="btnEntrar"
								value="#{messages['login.entrarBtn']}" 
								class="input_button"
								action="#{authenticator.login()}"/>
					
					        <input
					        	class="input_button"
					        	id="btnTrocar"
								type="button"
								value="#{messages['login.trocarSenhaBtn']}" />
							
							<input
								class="input_button"
								id="btnTrocarSenha"
								type="button"
								value="#{messages['login.requisitarSenhaBtn']}"/>
						</c:if>
						
						<c:if test="#{useCertLogin}">
							<wi:appletAssinatura 
								width="80"
								id="certificacao" 
								formId="login"
								signButtonCaption="Entrar"
								certificationChainField="login:certChain"
								signatureField="login:signature"
								functionPreSign="#{rich:component('mp_formValidar')}.show();"	
								functionPosSign="#{rich:component('mp_formValidar')}.hide();"
								functionPosSignOk="submitForm();"	
								loginMode="true" />
						</c:if>
			        </div>
				</div>
				
				<h:inputHidden id="signature" 
					rendered="#{useCertLogin}"
					value="#{authenticator.assinatura}" />
					
				<h:inputHidden id="certChain" 
					rendered="#{useCertLogin}"
					value="#{authenticator.certChain}" />				
						
				<h:inputHidden id="certChainStringLog" 
					rendered="#{useCertLogin}"
					value="#{authenticator.certChainStringLog}" />	
										
		        <a:jsFunction 
		        	rendered="#{useCertLogin}"
		        	name="submitForm" 
		        	status="status"
		        	action="#{authenticator.authenticateSC()}" 
		        	oncomplete="mostrarInconsistencia();"
		        	render="pagina"
                    limitRender="true" />
				
			</h:form>
			
			<rich:popupPanel id="panelTeste" width="370" height="255">
				<f:facet name="header">#{messages['login.requisitarSenha']}</f:facet>			
				<f:facet name="controls">
					<h:panelGroup>
						<h:graphicImage
							id="closeBtn" 
							value="/img/closeMP.gif"/>
					</h:panelGroup>
				</f:facet>			
				<h:form id="gerarSenha" rendered="#{not useCertLogin}">
					<div class="bg_login">
						<div>
							<h:outputLabel for="login"
										   class="login-lbl"
										   value="#{messages['login.nomeUsuario']}">
							</h:outputLabel>
							<h:inputText id="login"
										 class="input_login"
										 value="#{usuarioHome.login}" />
						</div>
						<div>
							<h:outputLabel for="email"
										   class="login-lbl"
										   value="#{messages['login.emailUsuario']}">
							</h:outputLabel>
							<h:inputText id="email"
										 class="input_login"
										 value="#{usuarioHome.email}"/>
						</div>
					</div>
					<div class="bg_login_inferior">
						<h:commandButton id="confirma"
										 class="input_button"
										 value="#{messages['login.confirmaTrocaSenhaBtn']}"
										 action="#{usuarioHome.requisitarNovaSenha()}" /> 
					
						<input class="input_button"
							   id="btnTrocarSenha2" 
						       type="button"
						       value="#{messages['login.cancelaTrocaSenhaBtn']}" />
					</div>
				</h:form>
			</rich:popupPanel>
			
			<rich:popupPanel id="mp_formValidar" height="100" width="250"
							 rendered="#{useCertLogin}" resizeable="false">
				<f:facet name="header">
					<h:outputText value="Aguarde a incialização do SmartCard." />
				</f:facet>
				<div >
					<h:graphicImage url="/img/ajax-loader.gif" />
				</div>
			</rich:popupPanel>					
					
			<wi:messages></wi:messages>
		</s:div>
	</ui:define>
	
</ui:composition>