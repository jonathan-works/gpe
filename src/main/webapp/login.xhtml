<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE composition PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<ui:composition
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:p="http://primefaces.org/ui"
  xmlns:infox="http://www.infox.com.br/jsf"
  template="/WEB-INF/xhtml/templates/core/baseTemplate.xhtml">
  <ui:define name="baseHead">
  <ui:param
      name="useCertLogin"
      value="#{certificateAuthenticator.certificateLogin}" />
  </ui:define>
  <ui:define name="scripts">
  	<style>
		.recaptchatable {
			display: inline-block;
		}  	
  	</style>
    <h:outputScript library="js/components" name="Modal.js" />
  </ui:define>
  <ui:define name="baseBody">
    <s:div id="pageBody" styleClass="loginPageBody">
      <div class="corpoSuperior" />
      <div class="corpoInferior">
        <h:outputText
          styleClass="versao"
          value="VERSÃƒO: #{gitRepository.describe} / #{gitRepository.buildTime}" />
      </div>
      <div id="seletorSkinLogin" class="seletorSkinsLogin">
        <button
          id="consultaExterna"
          class="input-button-login input_button"
          onclick="location.href='#{pathResolver.getContextPath()}/ConsultaExterna/listView.seam';">#{infoxMessages['consultaExterna.titlePage']}</button>
        <ui:include src="/WEB-INF/xhtml/templates/seletorSkins.xhtml">
          <ui:param
            name="id"
            value="login" />
          <ui:param
            name="mostrarMenu"
            value="true" />
        </ui:include>
      </div>
      <h:form id="login">
        <div
          id="blocoCentralLogin"
          class="blocoCentralLogin">
          <div id="logo" class="logo">
            <h:graphicImage title="Logo" styleClass="logo-img" url="#{layoutController.getResourceUrl('LOGO_LOGIN')}" />
          </div>
          <div class="logo_inferior"></div>
          <div id="bg_login" class="bg_login login">
            <s:div rendered="#{not useCertLogin}">
              <div>
                <h:outputLabel
                  for="username"
                  rendered="#{not useCertLogin}"
                  class="login-lbl"
                  value="#{infoxMessages['login.nomeUsuario']}">
                </h:outputLabel>
                <h:inputText
                  id="username"
                  value="#{credentials.username}"
                  class="input-text-login"
                  rendered="#{not useCertLogin}" />
              </div>
              <div>
                <h:outputLabel
                  for="password"
                  rendered="#{not useCertLogin}"
                  class="login-lbl"
                  value="#{infoxMessages['login.senha']}">
                </h:outputLabel>
                <h:inputSecret
                  id="password"
                  value="#{credentials.password}"
                  rendered="#{not useCertLogin}"
                  class="input-text-login" />
              </div>
            </s:div>
            <s:div
              styleClass="cert-div"
              rendered="#{useCertLogin}">
               <wi:certificadoDigital
					id="certificacao"
					tokenField="#{certificateAuthenticator.token}"
					signableData=""
					functionPreSign="infox.showLoading();"
					functionPosSign="submitForm();"
					signButtonCaption="#{infoxMessages['signature.loginBtn']}">
				</wi:certificadoDigital>
               <a:jsFunction
					name="submitForm"
					action="#{certificateAuthenticator.authenticate()}"
					execute="certificacaoToken, @this"
					render="DialogMessage"
					limitRender="true" />
            </s:div>
          </div>
          <div id="bg_login_inferior" class="bg_login_inferior login">

			<h:panelGroup rendered="#{loginView.mostrarCaptcha and not useCertLogin}">
	          	<div style="margin-bottom: 2em; padding-left: 35px; width: 302px">
		          	<p:captcha id="captcha" label="Captcha" language="pt_BR" validatorMessage="#{infoxMessages['captcha.incorreto']}" requiredMessage="#{infoxMessages['captcha.obrigatorio']}" />
		          	<p:messages for="captcha" severity="error"/>
	          	</div>
          	</h:panelGroup>
          	
            <h:panelGroup rendered="#{not useCertLogin}">
              <h:commandButton
                id="btnEntrar"
                value="#{infoxMessages['login.entrarBtn']}"
                styleClass="input-button-login input_button"
                action="#{loginView.login()}" />
              <h:commandButton
                styleClass="input-button-login input_button"
                id="btnTrocar"
                type="button"
                value="#{infoxMessages['login.trocarSenhaBtn']}" 
                onclick="#{rich:component('alterPasswordModal')}.show();" />
              <h:commandButton
                styleClass="input-button-login input_button"
                id="btnTrocarSenha"
                type="button"
                value="#{infoxMessages['login.esqueciSenhaBtn']}"
                onclick="#{rich:component('requestPasswordPanel')}.show();" />
            </h:panelGroup>
          </div>
        </div>
      </h:form>
    <rich:popupPanel id="requestPasswordPanel" resizeable="false"
        header="#{infoxMessages['login.esqueciSenhaBtn']}"
        minWidth="330" minHeight="450"
        styleClass="gradiente-background">
    
        <f:facet name="controls">	
            <div style="cursor: pointer;">
            <h:graphicImage id="requestPasswordPanelCloseBtn" value="#{layoutController.getResourceUrlByPath('/imagens/closeMP.gif')}" 
        		onclick="#{rich:component('requestPasswordPanel')}.hide();" />
            </div>
        </f:facet>
        
        <p:accordionPanel id="esqueciSenhaAccordion" activeIndex="-1">
            <p:tab title="#{infoxMessages['login.solicitarCodigo']}" >
                <h:outputText value="#{infoxMessages['login.msgSolicitarCodigo']}" />
                <h:form>
                    <div>
                        <div>
                            <h:outputLabel for="login" class="login-lbl-popup" value="#{infoxMessages['login.nomeUsuario']}" />
                            <h:inputText id="login" class="input-text-login-popup" value="#{passwordRequester.login}" />
                        </div>
                    </div>
                    
                    <div style="margin-top:3px;" >
                        <a:commandButton id="confirma" styleClass="input-button-login input_button"
                            value="#{infoxMessages['login.requisitarCodigoSenhaBtn']}"
                            action="#{passwordRequester.requisitarCodigoRecuperacao()}"
                            onclick="infox.showLoading();" oncomplete="infox.hideLoading();"
                            limitRender="true" render="esqueciSenhaAccordion DialogMessage" />
                        <h:commandButton id="cancelar" styleClass="input-button-login input_button"
                            type="button"
                            value="#{infoxMessages['login.cancelaTrocaSenhaBtn']}"
                            onclick="#{rich:component('requestPasswordPanel')}.hide();" />
                    </div>
                </h:form>
            </p:tab>
            
            <p:tab title="#{infoxMessages['login.jaPossuoCodigo']}">
                <h:outputText value="#{infoxMessages['login.msgJaPossuoCodigo']}"/>
                <h:form id="requestPasswordPanelGerarSenhaForm">
                    <div>
                        <div>
                            <h:outputLabel for="login" class="login-lbl-popup" value="#{infoxMessages['login.nomeUsuario']}" />
                            <h:inputText id="login" class="input-text-login-popup" value="#{passwordRequester.login}" />
                        </div>
                        <div>
                            <h:outputLabel class="login-lbl-popup" for="codigo" value="#{infoxMessages['login.codigo']}" />
                            <h:inputText id="codigo" styleClass="input-text-login-popup" value="#{passwordRequester.codigo}"/>
                        </div>
                        <div>
                            <h:outputLabel for="newPass1" class="login-lbl-popup" value="#{infoxMessages['login.novaSenha']}" />
                            <h:inputSecret id="newPass1" styleClass="input-text-login-popup" value="#{passwordRequester.newPass1}" />
                        </div>
                        <div>
                            <h:outputLabel for="newPass2" class="login-lbl-popup" value="#{infoxMessages['login.confirmacaoNovaSenha']}" />
                            <h:inputSecret id="newPass2" styleClass="input-text-login-popup" value="#{passwordRequester.newPass2}" />
                        </div>
                    </div>
      
                    <div style="margin-top:3px;" >
                        <a:commandButton id="confirma" styleClass="input-button-login input_button"
                            value="#{infoxMessages['login.trocarSenhaBtn']}"
                            action="#{passwordRequester.trocarSenha()}"
                            execute="@form" onclick="infox.showLoading();"
                            oncomplete="infox.hideLoading(); if(#{not (facesContext.validationFailed)}){#{rich:component('requestPasswordPanel')}.hide();}"
                            limitRender="true" render="DialogMessage @form" />
                        <h:commandButton id="cancelar" styleClass="input-button-login input_button"
                            type="button"
                            value="#{infoxMessages['login.cancelaTrocaSenhaBtn']}"
                            onclick="#{rich:component('requestPasswordPanel')}.hide();" />
                    </div>
                </h:form>
            </p:tab>
        </p:accordionPanel>
    </rich:popupPanel>
      
      <rich:popupPanel id="alterPasswordModal" minWidth="370" minHeight="325" headerClass="login-header-modal"
        header="#{infoxMessages['login.trocarSenhaBtn']}">
        <f:facet name="controls">
          <div style="cursor: pointer;" > 
            <h:graphicImage id="alterPasswordCloseBtn" value="#{layoutController.getResourceUrlByPath('/imagens/closeMP.gif')}" 
            				onclick="#{rich:component('alterPasswordModal')}.hide();" />
          </div>
        </f:facet>	
        <h:form id="alterPasswordGerarSenhaForm" rendered="#{not useCertLogin}">
          <div>
            <div>
               <h:outputLabel for="username" styleClass="login-lbl-popup" value="#{infoxMessages['login.nomeUsuario']}" />
               <h:inputText id="username" value="#{credentials.username}" styleClass="input-text-login-popup" />
            </div>
            <div>
               <h:outputLabel for="password" styleClass="login-lbl-popup" value="#{infoxMessages['login.senha']}" />
               <h:inputSecret id="password" value="#{credentials.password}" styleClass="input-text-login-popup" />
            </div>
	        <div>
	           <h:outputLabel for="newPassword1" styleClass="login-lbl-popup" value="#{infoxMessages['login.novaSenha']}" />
	           <h:inputSecret id="newPassword1" styleClass="input-text-login-popup passwd" value="#{authenticator.newPassword1}" />
	        </div>
	        <div>
	           <h:outputLabel for="newPassword2" styleClass="login-lbl-popup" value="#{infoxMessages['login.confirmacaoNovaSenha']}" />
               <h:inputSecret id="newPassword2" styleClass="input-text-login-popup passwd" value="#{authenticator.newPassword2}" />
	        </div>
          </div>
          <div style="margin-top:3px; text-align: center;" >
            <h:commandButton
              id="confirma"
              styleClass="input-button-login input_button"
              value="#{infoxMessages['login.trocarSenhaBtn']}"
              action="#{authenticator.login()}" />
            <h:commandButton
              styleClass="input-button-login input_button"
              id="cancelar"
              type="button"
              value="#{infoxMessages['login.cancelaTrocaSenhaBtn']}" 
              onclick="#{rich:component('alterPasswordModal')}.hide();" />
          </div>
        </h:form>
      </rich:popupPanel>
      <rich:popupPanel
        id="mp_formValidar"
        height="100"
        width="250"
        rendered="#{useCertLogin}"
        resizeable="false">
        <f:facet name="header">
          <h:outputText value="#{infoxMessages['certificate.waitInit']}" />
        </f:facet>
        <div>
          <h:graphicImage url="#{layoutController.getResourceUrlByPath('/imagens/ajax-loader.gif')}" />
        </div>
      </rich:popupPanel>
      <wi:messages />
    </s:div>
  </ui:define>
</ui:composition>
