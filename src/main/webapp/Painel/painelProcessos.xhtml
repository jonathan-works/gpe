<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:a="http://richfaces.org/a4j"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich"
	xmlns:s="http://jboss.org/schema/seam/taglib"
	xmlns:wi="http://www.itx.com.br/jsf"
	xmlns:infox="http://www.infox.com.br/jsf">
	
	<s:div id="painelProcessos" rendered="#{painelUsuarioController.showPainelProcessosComum}"
		style="display: inline-block; width: 100%; vertical-align: top;  margin-left: 0.5em;">
		<s:div id="processos" rendered="#{painelUsuarioController.canShowProcessoList()}">

			<wi:dataTable values="#{consultaProcessoList.list(10)}"
				styleClass="p-list-dtable"
				tableTitle="#{infoxMessages['consultaProcesso.processos']}"
				id="consultaProcessoList" rowId="#{row.idProcesso}"
				searchFormStyleClass="p-list-search"
				panelStyleClass="p-list-panel" hideOrder="true">

				<ui:define name="searchForm">
					<wi:searchForm opened="false" formId="consultaProcessoForm"
						formTitle="#{infoxMessages['searchForm.title']}"	
						searchReRender="painelProcessos"
						clearAction="consultaProcessoList.newInstance()"
						clearReRender="painelProcessos">

						<wi:inputText id="numeroProcesso"
							label="#{infoxMessages['consultaProcesso.numeroProcesso']}"
							value="#{consultaProcessoList.numeroProcesso}" />

						<wi:inputDataPeriodo id="periodo"
							label="#{infoxMessages['data.inputPeriodo']}"
							valueDateFrom="#{consultaProcessoList.dataInicio}"
							valueDateTo="#{consultaProcessoList.dataFim}" />

						<wi:selectOneMenuEntity id="natureza"
							label="#{infoxMessages['natureza.tableTitle']}"
							value="#{consultaProcessoList.natureza}"
							showLabelSelecione="true"
							items="#{naturezaCategoriaFluxoFacade.getNaturezaList()}" >
							<a:ajax execute="@this" render="natureza categoriaOutPutPanel"
								listener="#{naturezaCategoriaFluxoFacade.loadCategoriaList(consultaProcessoList.natureza)}"></a:ajax>
                            <a:ajax execute="@none" render="categoriaOutputPanel"
                                listener="#{consultaProcessoList.setCategoria(null)}" />
						</wi:selectOneMenuEntity>

						<a:outputPanel id="categoriaOutPutPanel">

							<wi:selectOneMenuEntity disabled="#{empty consultaProcessoList.natureza}"
								label="#{infoxMessages['categoria.tableTitle']}"
								value="#{consultaProcessoList.categoria}" showLabelSelecione="true"
								inNewLine="true" items="#{naturezaCategoriaFluxoFacade.getCategoriaList()}" />
						</a:outputPanel>
					</wi:searchForm>
				</ui:define>

				<wi:columnOutputText columnId="numeroProcesso"
					columnHeader="#{infoxMessages['consultaProcesso.numeroProcesso']}"
					value="#{row.numeroProcessoRoot}" 
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}"/>
					
				<wi:columnOutputText columnId="usuarioSolicitante"
					columnHeader="#{infoxMessages['consultaProcesso.usuarioCadastroProcesso']}"
					value="#{row.nomeUsuarioSolicitante}"
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}"/>
					
				<wi:columnDateTime columnId="dataInicio"
					columnHeader="#{infoxMessages['consultaProcesso.dataInicio']}"
					value="#{row.dataInicio}" 
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}"/>
					
				<wi:columnOutputText columnId="natureza"
					columnHeader="#{infoxMessages['consultaProcesso.natureza']}"
					value="#{row.nomeNatureza}"
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}" />
					
				<wi:columnOutputText columnId="categoria"
					columnHeader="#{infoxMessages['consultaProcesso.categoria']}"
					value="#{row.nomeCategoria}"
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}" />
					
				<wi:columnOutputText columnId="itemDoProcesso"
					columnHeader="#{infoxMessages['consultaProcesso.item']}"
					value="#{consultaProcessoList.getVariavelProcesso(row, 'itemProcesso')}" 
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}"/>
					
				<wi:columnOutputText columnId="prioridadeProcesso"
					columnHeader="#{infoxMessages['prioridadeProcesso.tableTitle']}"
					value="#{row.prioridadeProcesso}"
					columnRendered="#{painelUsuarioController.exibirColunasPadrao}" />
					
				<infox:dynamicColumns columns="#{consultaProcessoList.dynamicColumns}" />
					
				<ui:define name="headerToolBar">
					<ui:include	src="/WEB-INF/xhtml/components/grid/header/tools/toolBarProcessoJbpm.xhtml" />
				</ui:define>
				
				<ui:define name="toolBar">
					<ui:include	src="/WEB-INF/xhtml/components/grid/tools/toolBarProcessoJbpm.xhtml" />
				</ui:define>
				
			</wi:dataTable>
		</s:div>
	</s:div>
</ui:composition>
