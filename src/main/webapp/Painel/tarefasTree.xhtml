<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: tarefasTree.xhtml 750 2010-08-24 14:10:58Z danielsilva $ -->
<ui:composition xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf">

  <h:form id="#{id}Form">

    <s:div id="TarefasTree" styleClass="p-caixas-b">

      <rich:tree status="status" toggleType="client" execute="@this"
        selectionType="ajax"
        selectionChangeListener="#{tarefasTree.processTreeSelectionChange}"
        render="painelProcessos,:pesquisaListForm" var="node">

        <rich:treeModelAdaptor nodes="#{tarefasTree.tarefasRoots}">

          <rich:treeNode iconCollapsed="/img/globe16.png"
            iconExpanded="/img/globe16.png" iconLeaf="/img/messages.gif">

            <h:outputText value="#{node.entity.nomeFluxo}" />

          </rich:treeNode>

          <rich:treeModelAdaptor nodes="#{node.nodesTarefas}">

            <rich:treeNode id="taskNode"
              iconCollapsed="/img/messages.gif"
              iconExpanded="/img/messages.gif"
              iconLeaf="/img/messages.gif">

              <h:outputText value="#{node.entity.nomeTarefa}" />

              <h:outputText
                rendered="#{node.entity.qtd - node.entity.qtdEmCaixa gt 0}"
                value="(#{node.entity.qtd - node.entity.qtdEmCaixa})" />

              <h:outputText rendered="#{node.entity.qtdEmCaixa gt 0}"
                value=" (Em caixas: #{node.entity.qtdEmCaixa})" />

              <rich:contextMenu mode="ajax" target="taskNode"
                id="menuTaskNode"
                rendered="#{s:hasPermission('/pages/Caixa/listView.seam', 'access')}">

                <rich:menuItem
                  label="#{messages['caixa.menu.novaCaixa']}"
                  icon="#{a4jSkin.imgFolder}/add.gif"
                  onclick="#{rich:component('novaCaixaPanel')}.show()" />

              </rich:contextMenu>

            </rich:treeNode>

            <rich:treeModelAdaptor nodes="#{node.caixas}">

              <rich:treeNode id="caixaNode"
                iconCollapsed="/img/message.gif"
                iconExpanded="/img/message.gif"
                iconLeaf="/img/message.gif">

                <h:outputText value="#{node.entity.nomeCaixa}" />

                <h:outputText value="(#{node.entity.qtd})" />

                <rich:contextMenu id="menuCaixa" mode="ajax"
                  target="caixaNode"
                  rendered="#{s:hasPermission('/pages/Caixa/listView.seam', 'access')}">

                  <rich:menuItem label="#{messages['caixa.menu.editaCaixa']}"
                    icon="#{a4jSkin.imgFolder}/edit.gif"
                    action="#{painelUsuarioHome.editaCaixa()}" />

                  <rich:menuItem label="#{messages['caixa.menu.removerCaixa']}"
                    icon="/img/remove.png"
                    onclick="return confirm(\'#{messages['caixa.confirm.remove']}\');" render="tarefasDiv"
                    action="#{caixaCrudAction.remove}">

                    <f:setPropertyActionListener
                      target="#{caixaCrudAction.id}"
                      value="#{painelUsuarioHome.selected.idCaixa}" />

                  </rich:menuItem>

                </rich:contextMenu>

                <rich:dropTarget
                  acceptedTypes="task#{node.entity.idTarefa}"
                  dropListener="#{painelUsuarioHome.processoCaixa}"
                  dropValue="#{node.entity.idCaixa}"
                  render="painelProcessos, tarefasDiv"
                  limitRender="true" />

              </rich:treeNode>

            </rich:treeModelAdaptor>

          </rich:treeModelAdaptor>

        </rich:treeModelAdaptor>

      </rich:tree>

    </s:div>

  </h:form>

</ui:composition>