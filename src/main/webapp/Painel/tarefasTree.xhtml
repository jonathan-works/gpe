<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf">
    <rich:panel header="${infoxMessages['painel.tarefas']}" id="TarefasTree" styleClass="tree-tarefas" style="width: 100%; padding-bottom: 110px;">
        <h:outputText rendered="#{empty painelTreeHandler.tarefasRoots}" value="#{infoxMessages['process.noAvailableProcesses']}"/>
        <rich:tree
            id="selectTarefaTree"
            status=":status"
            toggleType="client"
            execute="@this"
            selectionType="ajax"
            onbegin=" PF('pollAtualizarPainel').stop(); if(!#{security.checkPage('/pages/Caixa/listView.seam')}){infox.showLoading('Buscando processos...');}"
            oncomplete="PF('pollAtualizarPainel').start(); if(!#{security.checkPage('/pages/Caixa/listView.seam')}){infox.hideLoading(); }"
            selectionChangeListener="#{painelTreeHandler.processTreeSelectionChange}"
            render="divPainelProcessosInterna, :pesquisaListForm"
            var="node">
            <rich:treeModelAdaptor id="tarefaTreeModelAdaptor" nodes="#{painelTreeHandler.tarefasRoots}">
                <rich:treeNode
                    id="taskNode"
                    iconCollapsed="#{wiSkin.imageFolder}/messages.gif"
                    iconExpanded="#{wiSkin.imageFolder}/messages.gif"
                    expanded="#{node.expanded}"
                    iconLeaf="#{wiSkin.imageFolder}/messages.gif"
                    iconClass="tarefa-tree-icon"
                    labelClass="tarefa-tree-lbl">
                    <h:outputText value="#{node.entity.get('nomeTarefa')}" />
                    <h:outputText
                        rendered="#{node.entity.get('qtd') - node.entity.get('qtdEmCaixa') gt 0}"
                        value="(#{node.entity.get('qtd') - node.entity.get('qtdEmCaixa')})" />
                    <h:outputText
                        rendered="#{node.entity.get('qtdEmCaixa') gt 0}"
                        value=" (Em caixas: #{node.entity.get('qtdEmCaixa')})" />
                    <rich:contextMenu
                        mode="ajax"
                        target="taskNode"
                        id="menuTaskNode"
                        rendered="#{security.checkPage('/pages/Caixa/listView.seam')}"> 
                        <rich:menuItem
                            label="#{infoxMessages['caixa.menu.novaCaixa']}"
                            icon="#{wiSkin.imageFolder}/add.gif"
                            onclick="#{rich:component('novaCaixaPanel')}.show()" />
                    </rich:contextMenu>
                </rich:treeNode>
                <rich:treeModelAdaptor id="caixaTreeModelAdaptor" nodes="#{node.caixas}">
                    <rich:treeNode
                        id="caixaNode"
                        iconCollapsed="#{wiSkin.imageFolder}/message.gif"
                        iconExpanded="#{wiSkin.imageFolder}/message.gif"
                        expanded="#{node.expanded}"
                        iconLeaf="#{wiSkin.imageFolder}/message.gif"
                        iconClass="tarefa-tree-icon"
                        labelClass="tarefa-tree-lbl">
                        <h:outputText value="#{node.entity.get('nomeCaixa')}" />
                        <h:outputText value="(#{node.entity.get('qtd')})" />
                        <rich:contextMenu
                            id="menuCaixa"
                            mode="ajax"
                            target="caixaNode"
                            rendered="#{security.checkPage('/pages/Caixa/listView.seam')}">
                            <rich:menuItem
                                label="#{infoxMessages['caixa.menu.editaCaixa']}"
                                icon="#{wiSkin.imageFolder}/mod/edit.gif"
                                action="#{painelUsuarioController.editarCaixa()}" />
                            <rich:menuItem
                                label="#{infoxMessages['caixa.menu.removerCaixa']}"
                                icon="#{wiSkin.imageFolder}/remove.png"
                                onclick="return confirm(\'#{infoxMessages['caixa.confirm.remove']}\');"
                                render="divPainelProcessos, TarefasTree, pageBodyDialogMessage"
                                action="#{caixaCrudAction.removerCaixaNoPainel()}">
                                <f:setPropertyActionListener
                                    target="#{caixaCrudAction.id}"
                                    value="#{painelUsuarioController.selected.get('idCaixa')}" />
                            </rich:menuItem>
                        </rich:contextMenu>
                        <rich:dropTarget
                            acceptedTypes="task#{node.entity.get('idTarefa')}"
                            dropListener="#{painelUsuarioController.moverProcessoParaCaixaDropEventListener}"
                            dropValue="#{node.entity.get('idCaixa')}"
                            render="divPainelProcessos, TarefasTree"
                            limitRender="true" />
                    </rich:treeNode>
                </rich:treeModelAdaptor>
            </rich:treeModelAdaptor>
        </rich:tree>
    </rich:panel>
</ui:composition>