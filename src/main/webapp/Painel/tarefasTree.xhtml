<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:wi="http://www.itx.com.br/jsf">
    <s:div
        id="TarefasTree"
        styleClass="p-caixas-b">
        <h:outputText rendered="#{empty painelTreeHandler.tarefasRoots}" value="#{infoxMessages['process.noAvailableProcesses']}"/>
        <rich:tree
            status="status"
            toggleType="client"
            execute="@this"
            selectionType="ajax"
            selectionChangeListener="#{painelTreeHandler.processTreeSelectionChange}"
            render="painelProcessos, painelProcessosDocumento, :pesquisaListForm, #{painelCustomizado}"
            var="node">
            <rich:treeModelAdaptor nodes="#{painelTreeHandler.tarefasRoots}">
                <rich:treeNode
                    iconCollapsed="#{wiSkin.imageFolder}/globe16.png"
                    iconExpanded="#{wiSkin.imageFolder}/globe16.png"
                    iconLeaf="#{wiSkin.imageFolder}/messages.gif"
                    iconClass="tarefa-tree-icon"
                    labelClass="tarefa-tree-lbl">
                    <h:outputText value="#{node.entity.get('nomeFluxo')}" />
                </rich:treeNode>
                <rich:treeModelAdaptor nodes="#{node.nodesTarefas}">
                    <rich:treeNode
                        id="taskNode"
                        iconCollapsed="#{wiSkin.imageFolder}/messages.gif"
                        iconExpanded="#{wiSkin.imageFolder}/messages.gif"
                        iconLeaf="#{wiSkin.imageFolder}/messages.gif"
                        iconClass="tarefa-tree-icon"
                        labelClass="tarefa-tree-lbl">
                        <h:outputText value="#{node.entity.get('nomeTarefa')}" />
                        <h:outputText
                            rendered="#{node.entity.get('qtd') - node.entity.get('qtdEmCaixa') gt 0}"
                            value="(#{node.entity.get('qtd') - node.entity.get('qtdEmCaixa')})" />
                        <h:outputText
                            rendered="#{node.entity.get('qtdEmCaixa') gt 0}"
                            value=" (Em caixas: #{node.entity.get('qtdEmCaixa')})" />
                        <rich:contextMenu
                            mode="ajax"
                            target="taskNode"
                            id="menuTaskNode"
                            rendered="#{s:hasPermission('/pages/Caixa/listView.seam', 'access')}">
                            <rich:menuItem
                                label="#{infoxMessages['caixa.menu.novaCaixa']}"
                                icon="#{wiSkin.imageFolder}/add.gif"
                                onclick="#{rich:component('novaCaixaPanel')}.show()" />
                        </rich:contextMenu>
                    </rich:treeNode>
                    <rich:treeModelAdaptor nodes="#{node.caixas}">
                        <rich:treeNode
                            id="caixaNode"
                            iconCollapsed="#{wiSkin.imageFolder}/message.gif"
                            iconExpanded="#{wiSkin.imageFolder}/message.gif"
                            iconLeaf="#{wiSkin.imageFolder}/message.gif"
                            iconClass="tarefa-tree-icon"
                            labelClass="tarefa-tree-lbl">
                            <h:outputText value="#{node.entity.get('nomeCaixa')}" />
                            <h:outputText value="(#{node.entity.get('qtd')})" />
                            <rich:contextMenu
                                id="menuCaixa"
                                mode="ajax"
                                target="caixaNode"
                                rendered="#{s:hasPermission('/pages/Caixa/listView.seam', 'access')}">
                                <rich:menuItem
                                    label="#{infoxMessages['caixa.menu.editaCaixa']}"
                                    icon="#{wiSkin.imageFolder}/mod/edit.gif"
                                    action="#{painelUsuarioController.editarCaixa()}" />
                                <rich:menuItem
                                    label="#{infoxMessages['caixa.menu.removerCaixa']}"
                                    icon="#{wiSkin.imageFolder}/remove.png"
                                    onclick="return confirm(\'#{infoxMessages['caixa.confirm.remove']}\');"
                                    render="tabPainelUsuario, pageBodyDialogMessage"
                                    action="#{caixaCrudAction.removerCaixaNoPainel()}">
                                    <f:setPropertyActionListener
                                        target="#{caixaCrudAction.id}"
                                        value="#{painelUsuarioController.selected.get('idCaixa')}" />
                                </rich:menuItem>
                            </rich:contextMenu>
                            <rich:dropTarget
                                acceptedTypes="task#{node.entity.get('idTarefa')}"
                                dropListener="#{painelUsuarioController.moverProcessoParaCaixaDropEventListener}"
                                dropValue="#{node.entity.get('idCaixa')}"
                                render="tabPainelUsuario"
                                limitRender="true" />
                        </rich:treeNode>
                    </rich:treeModelAdaptor>
                </rich:treeModelAdaptor>
            </rich:treeModelAdaptor>
        </rich:tree>
    </s:div>
</ui:composition>