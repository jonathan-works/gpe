<?xml version="1.0" encoding="UTF-8"?>
<!-- $Id: list.xhtml 750 2010-08-24 14:10:58Z danielsilva $ -->
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:infox="http://www.infox.com.br/jsf"
  template="/WEB-INF/xhtml/templates/core/menuTemplate.xhtml"
>
  <ui:param
    name="pageTitle"
    value="#{eppmessages['painel.titlePage']}"
  />
  <ui:define name="title">#{pageTitle}</ui:define>
  <ui:define name="body">
    <a:region>
      <h:outputScript>
        function atualizaPainelFluxo() { 
          location = '#{pathResolver.contextPath}/Painel/list.seam'; 
        }
      </h:outputScript>
      <div class="p-caixas">
        <infox:tabPanel
          id="tabPainelUsuario"
          switchType="ajax"
          status=":status"
        >
          <h:form>
            <infox:tabHeaders />
          </h:form>
          <infox:tab
            id="caixas"
            name="caixas"
            render="painelProcessos"
            limitRender="true"
            action="#{tarefasTree.clearTree()}"
            title="#{eppmessages['caixa.tab']}"
          >
            <s:div id="tarefasDiv">
              <ui:include src="tarefasTree.xhtml" />
            </s:div>
          </infox:tab>
        </infox:tabPanel>
      </div>
      <s:div
        id="painelProcessos"
        styleClass="p-list"
      >
        <s:div
          id="processos"
          rendered="#{not empty painelUsuarioHome.processoIdList or not empty painelUsuarioHome.idCaixa}"
        >
          <wi:dataTable
            values="#{consultaProcessoList.list(10)}"
            bean="#{consultaProcessoList}"
            styleClass="p-list-dtable"
            tableTitle="#{eppmessages['consultaProcesso.processos']}"
            id="consultaProcessoEpaList"
            rowId="#{row.idProcesso}"
            searchFormStyleClass="p-list-search"
            panelStyleClass="p-list-panel"
            hideOrder="true"
          >
            <ui:define name="searchForm">
              <wi:searchForm
                opened="false"
                formId="consultaProcessoForm"
                formTitle="#{eppmessages['searchForm.title']}"
                searchReRender="painelProcessos"
                clearAction="consultaProcessoList.newInstance()"
                clearReRender="painelProcessos"
              >
                <wi:inputText
                  id="numeroProcesso"
                  label="#{eppmessages['consultaProcesso.numeroProcesso']}"
                  value="#{consultaProcessoList.entity.numeroProcesso}"
                />
                <wi:inputDataPeriodo
                  id="periodo"
                  label="#{eppmessages['data.inputPeriodo']}"
                  valueDateFrom="#{consultaProcessoList.dataInicio}"
                  valueDateTo="#{consultaProcessoList.dataFim}"
                />
                <wi:selectOneMenuEntity
                  id="natureza"
                  label="#{eppmessages['natureza.tableTitle']}"
                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.natureza}"
                  showLabelSelecione="true"
                  items="#{naturezaCategoriaFluxoFacade.getNaturezaList()}"
                />
                <wi:selectOneMenuEntity
                  id="categoria"
                  label="#{eppmessages['categoria.tableTitle']}"
                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.categoria}"
                  showLabelSelecione="true"
                  inNewLine="true"
                  items="#{naturezaCategoriaFluxoFacade.getCategoriaList()}"
                />
              </wi:searchForm>
            </ui:define>
            <wi:columnOutputText
              columnId="numeroProcesso"
              columnHeader="#{eppmessages['consultaProcesso.numeroProcesso']}"
              value="#{row.numeroProcesso}"
            />
            <wi:columnOutputText
              columnId="usuarioSolicitante"
              columnHeader="#{eppmessages['consultaProcesso.usuarioCadastroProcesso']}"
              value="#{row.usuarioCadastro}"
            />
            <wi:columnDateTime
              columnId="dataInicio"
              columnHeader="#{eppmessages['consultaProcesso.dataInicio']}"
              value="#{row.dataInicio}"
            />
            <wi:columnOutputText
              columnId="natureza"
              columnHeader="#{eppmessages['consultaProcesso.natureza']}"
              value="#{row.naturezaCategoriaFluxo.natureza}"
            />
            <wi:columnOutputText
              columnId="categoria"
              columnHeader="#{eppmessages['consultaProcesso.categoria']}"
              value="#{row.naturezaCategoriaFluxo.categoria}"
            />
            <wi:columnOutputText
              columnId="itemDoProcesso"
              columnHeader="#{eppmessages['consultaProcesso.item']}"
              value="Precisa ALterar"  />
              <!--  value="#{row.itemDoProcesso}" -->
            <wi:columnOutputText
              columnId="prioridadeProcesso"
              columnHeader="#{eppmessages['prioridadeProcesso.tableTitle']}"
              value="#{row.prioridadeProcesso}"
            />
            <infox:dynamicColumns
              columns="#{painelUsuarioHome.dynamicColumns}"
            />
            <ui:define name="headerToolBar">
              <ui:include
                src="/WEB-INF/xhtml/components/grid/header/tools/toolBarProcessoJbpm.xhtml"
              />
            </ui:define>
            <ui:define name="toolBar">
              <ui:include
                src="/WEB-INF/xhtml/components/grid/tools/toolBarProcessoJbpm.xhtml"
              />
            </ui:define>
          </wi:dataTable>
        </s:div>
      </s:div>
      <rich:popupPanel
        id="novaCaixaPanel"
        height="150"
        left="40"
        onbeforeshow="infox.util.popupclear();"
      >
        <f:facet name="header">
          <h:outputText value="#{eppmessages['caixa.titleNovaCaixa']}" />
        </f:facet>
        <f:facet name="controls">
          <span onclick="#{rich:component('novaCaixaPanel')}.hide()">X</span>
        </f:facet>
        <h:form id="modalForm">
          <wi:inputText
            id="nomeCaixa"
            label="#{eppmessages['caixa.nomeCaixa']}"
            value="#{caixaCrudAction.instance.nomeCaixa}"
            required="true"
          />
          <a:commandButton
            value="#{eppmessages['crud.persist']}"
            styleClass="buttons"
            action="#{caixaCrudAction.addCaixa(painelUsuarioHome.tarefaId)}"
            oncomplete="if(#{not facesContext.isValidationFailed()}){#{rich:component('novaCaixaPanel')}.hide()}"
            render="tarefasDiv, painelProcessos, nomeCaixaDecoration, pageBodyDialogMessage"
          />
        </h:form>
        <h:outputScript>
	        namespace("infox.util.popupclear",function onpopupshow(){
		        $("#modalForm .inputText").val(null);
		      	if ($("#modalForm label.errors").length != 0) {
					$("#modalForm span.errorFields.errors").remove();
					$("#modalForm .errors").each(function(){$(this).removeClass("errors")});
				}
		    });
        </h:outputScript>
      </rich:popupPanel>
    </a:region>
    
  </ui:define>
</ui:composition>
