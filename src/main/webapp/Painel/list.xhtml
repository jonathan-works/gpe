<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:infox="http://www.infox.com.br/jsf"
  template="/WEB-INF/xhtml/templates/core/baseTemplate.xhtml"
>
  <ui:param
    name="pageTitle"
    value="#{infoxMessages['painel.titlePage']}"
  />
  <ui:define name="title">#{pageTitle}</ui:define>
  <ui:define name="baseBody">
  
    <ui:include src="/WEB-INF/xhtml/templates/core/include/header.xhtml" />
    <ui:param
      name="showMenu"
      value="#{not empty showMenu ? showMenu : identity.loggedIn}" />
    <c:if test="#{showMenu}">
      <ui:include src="/WEB-INF/xhtml/templates/core/include/menu.xhtml" />
      <ui:param
        name="required"
        value="false" />
    </c:if>
    <a:region>
      <h:outputScript>
        function atualizaPainelFluxo() { 
          location = '#{pathResolver.contextPath}/Painel/list.seam'; 
        }
      </h:outputScript>
      
      <infox:tabPanel id="tabPainelUsuario" switchType="ajax"
        status=":status" activeTab="#{painelUsuarioController.tab}" >
        
        <h:form>
          <infox:tabHeaders />
        </h:form>
        
        <infox:tab id="processo"
          	name="processo" render="painelProcessos"
          	limitRender="true" action="#{painelTreeHandler.clearTree()}"
          	title="#{infoxMessages['caixa.tab']}" >
          <s:div rendered="#{painelUsuarioController.tab eq 'processo'}">
	          <s:div id="tarefasDiv" styleClass="p-caixas">
	          	<h:form id="treeProcessoForm">
	            	<ui:include src="tarefasTree.xhtml" />
	            </h:form>
	          </s:div>
	          
	       	  <s:div id="painelProcessos" styleClass="p-list" >
	            <s:div id="processos" 
	        		rendered="#{(not empty painelUsuarioController.processoIdList or not empty painelUsuarioController.idCaixa) 
	        					 and painelUsuarioController.tab eq 'processo'}" >
	        
		            <wi:dataTable
		              values="#{consultaProcessoList.list(10)}"
		              bean="#{consultaProcessoList}"
		              styleClass="p-list-dtable"
		              tableTitle="#{infoxMessages['consultaProcesso.processos']}"
		              id="consultaProcessoList"
		              rowId="#{row.idProcesso}"
		              searchFormStyleClass="p-list-search"
		              panelStyleClass="p-list-panel"
		              hideOrder="true" >
		            
		            <ui:define name="searchForm">
		              <wi:searchForm
		                opened="false"
		                formId="consultaProcessoForm"
		                formTitle="#{infoxMessages['searchForm.title']}"
		                searchReRender="painelProcessos"
		                clearAction="consultaProcessoList.newInstance()"
		                clearReRender="painelProcessos" >
		                
		                <wi:inputText
		                  id="numeroProcesso"
		                  label="#{infoxMessages['consultaProcesso.numeroProcesso']}"
		                  value="#{consultaProcessoList.entity.numeroProcesso}" />
		                  
		                <wi:inputDataPeriodo
		                  id="periodo"
		                  label="#{infoxMessages['data.inputPeriodo']}"
		                  valueDateFrom="#{consultaProcessoList.entity.dataInicio}"
		                  valueDateTo="#{consultaProcessoList.dataFim}" />
		                  
		                <wi:selectOneMenuEntity
		                  id="natureza"
		                  label="#{infoxMessages['natureza.tableTitle']}"
		                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.natureza}"
		                  showLabelSelecione="true"
		                  items="#{naturezaCategoriaFluxoFacade.getNaturezaList()}" />
		                  
		                <wi:selectOneMenuEntity
		                  id="categoria"
		                  label="#{infoxMessages['categoria.tableTitle']}"
		                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.categoria}"
		                  showLabelSelecione="true"
		                  inNewLine="true"
		                  items="#{naturezaCategoriaFluxoFacade.getCategoriaList()}" />
		                  
		              </wi:searchForm>
		            </ui:define>
		            
		            <wi:columnOutputText
		              columnId="numeroProcesso"
		              columnHeader="#{infoxMessages['consultaProcesso.numeroProcesso']}"
		              value="#{row.numeroProcesso}"
		            />
		            <wi:columnOutputText
		              columnId="usuarioSolicitante"
		              columnHeader="#{infoxMessages['consultaProcesso.usuarioCadastroProcesso']}"
		              value="#{row.usuarioCadastro}"
		            />
		            <wi:columnDateTime
		              columnId="dataInicio"
		              columnHeader="#{infoxMessages['consultaProcesso.dataInicio']}"
		              value="#{row.dataInicio}"
		            />
		            <wi:columnOutputText
		              columnId="natureza"
		              columnHeader="#{infoxMessages['consultaProcesso.natureza']}"
		              value="#{row.naturezaCategoriaFluxo.natureza}"
		            />
		            <wi:columnOutputText
		              columnId="categoria"
		              columnHeader="#{infoxMessages['consultaProcesso.categoria']}"
		              value="#{row.naturezaCategoriaFluxo.categoria}"
		            />
		            <wi:columnOutputText
		              columnId="itemDoProcesso"
		              columnHeader="#{infoxMessages['consultaProcesso.item']}"
		              value="#{consultaProcessoList.getItemDoProcesso(row)}"  />
		            <wi:columnOutputText
		              columnId="prioridadeProcesso"
		              columnHeader="#{infoxMessages['prioridadeProcesso.tableTitle']}"
		              value="#{row.prioridadeProcesso}"
		            />
		            <infox:dynamicColumns
		              columns="#{painelUsuarioController.dynamicColumns}"
		            />
		            <ui:define name="headerToolBar">
		              <ui:include
		                src="/WEB-INF/xhtml/components/grid/header/tools/toolBarProcessoJbpm.xhtml"
		              />
		            </ui:define>
		            <ui:define name="toolBar">
		              <ui:include
		                src="/WEB-INF/xhtml/components/grid/tools/toolBarProcessoJbpm.xhtml"
		              />
		            </ui:define>
	              </wi:dataTable>
	            </s:div>
	          </s:div>
          </s:div>
        </infox:tab>
        
        <infox:tab id="comunicacoes"
          	name="comunicacao" render="painelProcessosComunicacao"
          	limitRender="true" action="#{painelTreeHandler.clearTree()}"
          	title="#{infoxMessages['painel.comunicacaoTab']}" >
          <s:div rendered="#{painelUsuarioController.tab eq 'comunicacao'}">
	          <s:div id="comunicacoesTarefasDiv" styleClass="p-caixas" >
	          	<h:form id="treeProcessoComunicacaoForm">
	            	<ui:include src="tarefasTree.xhtml" />
	            </h:form>
	          </s:div>
	          
	       	  <s:div id="painelProcessosComunicacao" styleClass="p-list" >
	            <s:div id="processosComunicacao" 
	        		rendered="#{(not empty painelUsuarioController.processoIdList or not empty painelUsuarioController.idCaixa) 
	        					and painelUsuarioController.tab eq 'comunicacao'}" >
	        
		            <wi:dataTable
		              values="#{consultaProcessoList.list(10)}"
		              bean="#{consultaProcessoList}"
		              styleClass="p-list-dtable"
		              tableTitle="#{infoxMessages['consultaProcesso.processos']}"
		              id="consultaProcessoComunicacaoList"
		              rowId="#{row.idProcesso}"
		              searchFormStyleClass="p-list-search"
		              panelStyleClass="p-list-panel"
		              hideOrder="true" >
		            
		            <ui:define name="searchForm">
		              <wi:searchForm
		                opened="false"
		                formId="consultaProcessoComunicacaoForm"
		                formTitle="#{infoxMessages['searchForm.title']}"
		                searchReRender="painelProcessos"
		                clearAction="consultaProcessoList.newInstance()"
		                clearReRender="painelProcessos" >
		                
		                <wi:inputText
		                  id="numeroProcesso"
		                  label="#{infoxMessages['consultaProcesso.numeroProcesso']}"
		                  value="#{consultaProcessoList.entity.numeroProcesso}" />
		                  
		                <wi:inputDataPeriodo
		                  id="periodo"
		                  label="#{infoxMessages['data.inputPeriodo']}"
		                  valueDateFrom="#{consultaProcessoList.entity.dataInicio}"
		                  valueDateTo="#{consultaProcessoList.dataFim}" />
		                  
		                <wi:selectOneMenuEntity
		                  id="natureza"
		                  label="#{infoxMessages['natureza.tableTitle']}"
		                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.natureza}"
		                  showLabelSelecione="true"
		                  items="#{naturezaCategoriaFluxoFacade.getNaturezaList()}" />
		                  
		                <wi:selectOneMenuEntity
		                  id="categoria"
		                  label="#{infoxMessages['categoria.tableTitle']}"
		                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.categoria}"
		                  showLabelSelecione="true"
		                  inNewLine="true"
		                  items="#{naturezaCategoriaFluxoFacade.getCategoriaList()}" />
		                  
		              </wi:searchForm>
		            </ui:define>
		            
		            <wi:columnOutputText
		              columnId="numeroProcesso"
		              columnHeader="#{infoxMessages['consultaProcesso.numeroProcesso']}"
		              value="#{row.numeroProcesso}"
		            />
		            <wi:columnOutputText
		              columnId="usuarioSolicitante"
		              columnHeader="#{infoxMessages['consultaProcesso.usuarioCadastroProcesso']}"
		              value="#{row.usuarioCadastro}"
		            />
		            <wi:columnDateTime
		              columnId="dataInicio"
		              columnHeader="#{infoxMessages['consultaProcesso.dataInicio']}"
		              value="#{row.dataInicio}"
		            />
		            <wi:columnOutputText
		              columnId="natureza"
		              columnHeader="#{infoxMessages['consultaProcesso.natureza']}"
		              value="#{row.naturezaCategoriaFluxo.natureza}"
		            />
		            <wi:columnOutputText
		              columnId="categoria"
		              columnHeader="#{infoxMessages['consultaProcesso.categoria']}"
		              value="#{row.naturezaCategoriaFluxo.categoria}"
		            />
		            <wi:columnOutputText
		              columnId="itemDoProcesso"
		              columnHeader="#{infoxMessages['consultaProcesso.item']}"
		              value="#{consultaProcessoList.getItemDoProcesso(row)}"  />
		            <wi:columnOutputText
		              columnId="prioridadeProcesso"
		              columnHeader="#{infoxMessages['prioridadeProcesso.tableTitle']}"
		              value="#{row.prioridadeProcesso}"
		            />
		            <infox:dynamicColumns
		              columns="#{painelUsuarioController.dynamicColumns}"
		            />
		            <ui:define name="headerToolBar">
		              <ui:include
		                src="/WEB-INF/xhtml/components/grid/header/tools/toolBarProcessoJbpm.xhtml"
		              />
		            </ui:define>
		            <ui:define name="toolBar">
		              <ui:include
		                src="/WEB-INF/xhtml/components/grid/tools/toolBarProcessoJbpm.xhtml"
		              />
		            </ui:define>
	              </wi:dataTable>
	            </s:div>
	          </s:div>
          </s:div>
        </infox:tab>
        
        <infox:tab id="documentos"
          	name="documento" render="painelProcessosDocumento"
          	limitRender="true" action="#{painelTreeHandler.clearTree()}"
          	title="#{infoxMessages['painel.documentoTab']}" >
          <s:div rendered="#{painelUsuarioController.tab eq 'documento'}">
	          <s:div id="documentosTarefasDiv" styleClass="p-caixas" >
	          	<h:form id="treeProcessoDocumentoForm">
	            	<ui:include src="tarefasTree.xhtml" />
	            </h:form>
	          </s:div>
	          
	       	  <s:div id="painelProcessosDocumento" styleClass="p-list" >
	            <s:div id="processosDocumento" 
	        		rendered="#{(not empty painelUsuarioController.processoIdList or not empty painelUsuarioController.idCaixa) 
	        					 and painelUsuarioController.tab eq 'documento'}" >
	        
		            <wi:dataTable
		              values="#{consultaProcessoList.list(10)}"
		              bean="#{consultaProcessoList}"
		              styleClass="p-list-dtable"
		              tableTitle="#{infoxMessages['consultaProcesso.processos']}"
		              id="consultaProcessoDocumentoList"
		              rowId="#{row.idProcesso}"
		              searchFormStyleClass="p-list-search"
		              panelStyleClass="p-list-panel"
		              hideOrder="true" >
		            
		            <ui:define name="searchForm">
		              <wi:searchForm
		                opened="false"
		                formId="consultaProcessoDocumentoForm"
		                formTitle="#{infoxMessages['searchForm.title']}"
		                searchReRender="painelProcessos"
		                clearAction="consultaProcessoList.newInstance()"
		                clearReRender="painelProcessos" >
		                
		                <wi:inputText
		                  id="numeroProcesso"
		                  label="#{infoxMessages['consultaProcesso.numeroProcesso']}"
		                  value="#{consultaProcessoList.entity.numeroProcesso}" />
		                  
		                <wi:inputDataPeriodo
		                  id="periodo"
		                  label="#{infoxMessages['data.inputPeriodo']}"
		                  valueDateFrom="#{consultaProcessoList.entity.dataInicio}"
		                  valueDateTo="#{consultaProcessoList.dataFim}" />
		                  
		                <wi:selectOneMenuEntity
		                  id="natureza"
		                  label="#{infoxMessages['natureza.tableTitle']}"
		                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.natureza}"
		                  showLabelSelecione="true"
		                  items="#{naturezaCategoriaFluxoFacade.getNaturezaList()}" />
		                  
		                <wi:selectOneMenuEntity
		                  id="categoria"
		                  label="#{infoxMessages['categoria.tableTitle']}"
		                  value="#{consultaProcessoList.entity.naturezaCategoriaFluxo.categoria}"
		                  showLabelSelecione="true"
		                  inNewLine="true"
		                  items="#{naturezaCategoriaFluxoFacade.getCategoriaList()}" />
		                  
		              </wi:searchForm>
		            </ui:define>
		            
		            <wi:columnOutputText
		              columnId="numeroProcesso"
		              columnHeader="#{infoxMessages['consultaProcesso.numeroProcesso']}"
		              value="#{row.numeroProcesso}"
		            />
		            <wi:columnOutputText
		              columnId="usuarioSolicitante"
		              columnHeader="#{infoxMessages['consultaProcesso.usuarioCadastroProcesso']}"
		              value="#{row.usuarioCadastro}"
		            />
		            <wi:columnDateTime
		              columnId="dataInicio"
		              columnHeader="#{infoxMessages['consultaProcesso.dataInicio']}"
		              value="#{row.dataInicio}"
		            />
		            <wi:columnOutputText
		              columnId="natureza"
		              columnHeader="#{infoxMessages['consultaProcesso.natureza']}"
		              value="#{row.naturezaCategoriaFluxo.natureza}"
		            />
		            <wi:columnOutputText
		              columnId="categoria"
		              columnHeader="#{infoxMessages['consultaProcesso.categoria']}"
		              value="#{row.naturezaCategoriaFluxo.categoria}"
		            />
		            <wi:columnOutputText
		              columnId="itemDoProcesso"
		              columnHeader="#{infoxMessages['consultaProcesso.item']}"
		              value="#{consultaProcessoList.getItemDoProcesso(row)}"  />
		            <wi:columnOutputText
		              columnId="prioridadeProcesso"
		              columnHeader="#{infoxMessages['prioridadeProcesso.tableTitle']}"
		              value="#{row.prioridadeProcesso}"
		            />
		            <wi:columnOutputText
		              columnId="numeroProcessoPai"
		              columnHeader="#{infoxMessages['consultaProcesso.numeroProcessoPai']}"
		              value="#{row.processoPai.numeroProcesso}" />
		            <infox:dynamicColumns
		              columns="#{painelUsuarioController.dynamicColumns}"
		            />
		            <ui:define name="headerToolBar">
		              <ui:include
		                src="/WEB-INF/xhtml/components/grid/header/tools/toolBarProcessoJbpm.xhtml"
		              />
		            </ui:define>
		            <ui:define name="toolBar">
		              <ui:include
		                src="/WEB-INF/xhtml/components/grid/tools/toolBarProcessoJbpm.xhtml"
		              />
		            </ui:define>
	              </wi:dataTable>
	            </s:div>
	          </s:div>
          </s:div>
        </infox:tab>
        <ui:include src="/Painel/abasCustomizadas.xhtml" />
      </infox:tabPanel>
      
      <rich:popupPanel
        id="novaCaixaPanel"
        height="150"
        left="40"
        onbeforeshow="infox.util.popupclear();"
      >
        <f:facet name="header">
          <h:outputText value="#{infoxMessages['caixa.titleNovaCaixa']}" />
        </f:facet>
        <f:facet name="controls">
          <span onclick="#{rich:component('novaCaixaPanel')}.hide()">X</span>
        </f:facet>
        
        <h:form id="modalForm">
          <wi:inputText
            id="nomeCaixa"
            label="#{infoxMessages['caixa.nomeCaixa']}"
            value="#{caixaCrudAction.instance.nomeCaixa}"
            required="true"
          />
          <a:commandButton
            value="#{infoxMessages['crud.persist']}"
            styleClass="buttons"
            action="#{caixaCrudAction.adicionarCaixaNoPainel(painelUsuarioController.tarefaId)}"
            oncomplete="if(#{not facesContext.isValidationFailed()}){#{rich:component('novaCaixaPanel')}.hide()}"
            render="tabPainelUsuario, nomeCaixaDecoration, pageBodyDialogMessage"
          />
        </h:form>
        
        <h:outputScript>
	        namespace("infox.util.popupclear",function onpopupshow(){
		        $("#modalForm .input.text.crud").val(null);
		      	if ($("#modalForm .property-error.property-msg").length != 0) {
					$("#modalForm span.property-error.property-msg").remove();
					$("#modalForm .property-error").each(function(){$(this).removeClass("property-error")});
				}
		    });
        </h:outputScript>
        
      </rich:popupPanel>
    </a:region>
    
  </ui:define>
</ui:composition>
