<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
  xmlns:ui="http://java.sun.com/jsf/facelets"
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:a="http://richfaces.org/a4j"
  xmlns:c="http://java.sun.com/jsp/jstl/core"
  xmlns:f="http://java.sun.com/jsf/core"
  xmlns:h="http://java.sun.com/jsf/html"
  xmlns:rich="http://richfaces.org/rich"
  xmlns:s="http://jboss.org/schema/seam/taglib"
  xmlns:wi="http://www.itx.com.br/jsf"
  xmlns:infox="http://www.infox.com.br/jsf"
  xmlns:p="http://primefaces.org/ui"
  template="/WEB-INF/xhtml/templates/core/baseTemplate.xhtml">
  
  <ui:param name="pageTitle" value="#{infoxMessages['painel.titlePage']}"/>
  <ui:define name="title">#{pageTitle}</ui:define>
  
  <ui:define name="baseBody">
    <h:form>
        <p:poll listener="#{painelUsuarioController.atualizarPainelProcessos}" interval="10" process="@this" update="@none" immediate="true" widgetVar="pollAtualizarPainel" partialSubmit="true"/>
    </h:form>
    
    <s:div id="baseBody">
	    <wi:messages formId="pageBody" globalOnly="true" />
	  
	    <ui:include src="/WEB-INF/xhtml/templates/core/include/header.xhtml" />
	    <ui:param name="showMenu" value="#{not empty showMenu ? showMenu : identity.loggedIn}" />
	    
	    <c:if test="#{showMenu}">
	      <ui:include src="/WEB-INF/xhtml/templates/core/include/menu.xhtml" />
	      <ui:param name="required" value="false" />
	    </c:if>
	    
	    <h:outputScript>
	      function atualizaPainelFluxo() { 
	        location = '#{pathResolver.contextPath}/Painel/list.seam'; 
	      }
	      function selectFluxoStyle(component) {
	      	$('.fluxo-sel').removeClass('fluxo-sel');
	      	$(component).addClass('fluxo-sel');
	      }
	    </h:outputScript>
	    
	    <div class="ui-tabs-panel ui-corner-bottom" style="padding: 0.8em; margin-top: 1em;">
	    
	    	<rich:panel id="panelFluxos" style="width: 15%; display: inline-block; margin-right: 0.5em; vertical-align: top">
	    		<f:facet name="header">
	    			<div style="position:relative;">
		    			<h:outputText value="#{infoxMessages[painelUsuarioController.localeTitleKey]}"/>
	    				<h:graphicImage url="#{wiSkin.imageFolder}/filter16x16.png" 
	    					rendered="#{not painelUsuarioController.showFiltroInfo}"
	    					styleClass="ui-icone-filtro-global-painel"
	    					title="#{infoxMessages['painel.adicionarFiltro']}"
	    					onclick="#{rich:component('modalFiltrosPainel')}.show()"/>
	    				<h:graphicImage url="#{wiSkin.imageFolder}/filterOn16x16.png"
	    					rendered="#{painelUsuarioController.showFiltroInfo}"
	    					styleClass="ui-icone-filtro-global-painel"
	    					title="#{infoxMessages['painel.editarFiltro']}"
	    					onclick="#{rich:component('modalFiltrosPainel')}.show()"/>
	    			</div>
	    		</f:facet>
		    	<h:form id="form-fluxo">	
		    		<a:jsFunction id="selectFluxo" name="selectFluxo" immediate="true" execute="@this" onbegin="infox.showLoading('Buscando Tarefas...');"
		    			oncomplete="infox.hideLoading();" render="divPainelProcessos" action="#{painelUsuarioController.selectFluxo}" >
						<a:param name="fluxo" assignTo="#{painelUsuarioController.idProcessDefinition}" />
						<a:param name="expedida" assignTo="#{painelUsuarioController.expedida}" />
					</a:jsFunction>
					<s:div rendered="#{not empty painelUsuarioController.fluxosDisponiveis and painelUsuarioController.showFiltroInfo}"
						style="border: 1px solid #c0c0c0; padding:0.5em;">
						<h:outputLabel id="labelFiltroGlobalPainelUsuario" 
							for="labelNumeroProcessoRootFiltro" 
							value="#{infoxMessages['painel.filtrandoPor']}"/>
						<div>
							<h:outputText id="labelNumeroProcessoRootFiltro" 
								value="#{infoxMessages['painel.filtroGlobal.numeroProcesso']} "/>
							<h:outputText id="numeroProcessoFiltrado"
								value="#{painelUsuarioController.numeroProcesso}"/>
						</div>
					</s:div>
					<h:outputText value="#{infoxMessages['process.noAvailableProcesses']}" rendered="#{empty painelUsuarioController.fluxosDisponiveis}" />
			    	<ui:repeat var="fluxo" value="#{painelUsuarioController.fluxosDisponiveis}" >
			    	  	  <div onmouseup="selectFluxo(#{fluxo.processDefinitionId}, #{fluxo.expedida}); selectFluxoStyle(this);" 
			    	  	      style="padding: 0.5em; cursor:pointer; margin-top: 0.5em;" >
			    	  	  	<h:outputText value="#{fluxo.name} (#{fluxo.quantidadeProcessos})" styleClass="fluxo-div" />
			    	  	  </div>
			    	</ui:repeat>
		    	</h:form>
	    	</rich:panel>
		    	
		    <s:div id="divPainelProcessos" style="display: inline-block; width: 83%; vertical-align: top;">	
		    
	    		<s:div id="tarefasDiv" style="display: inline-block; width: calc(26% - 10px);" rendered="#{painelUsuarioController.showTarefasTree}">
		           <h:form id="treeProcessoForm"  >
		               <ui:include src="tarefasTree.xhtml" />
		           </h:form>
		     	</s:div>
		     	
		     	<s:div id="divPainelProcessosInterna" style="display: inline-block; width: #{painelUsuarioController.showTarefasTree ? '74%' : '100%'}; vertical-align: top; margin-left: 0.5em;" >
					<ui:include src="/Painel/painelProcessos.xhtml" />
		    		
		    		<s:div rendered="#{painelUsuarioController.showPainelComunicacoesEletronicasComum}" style="display: inline-block; width: 100%; vertical-align: top;">
		    			<ui:include src="/Painel/painelComunicacaoEletronica.xhtml" />
		    		</s:div>
		    		
		    		<s:div rendered="#{painelUsuarioController.showPainelComunicacoesNaoEletronicasComum}" style="display: inline-block; width: 100%; vertical-align: top;">
		    			<ui:include src="/Painel/painelComunicacaoNaoEletronica.xhtml" />
		    		</s:div>
		    		
		    		<s:div rendered="#{painelUsuarioController.showPainelDocumentosComum}" style="display: inline-block; width: 100%; vertical-align: top;">
		    			<ui:include src="/Painel/painelDocumentos.xhtml" />
		    		</s:div>
		    		
			    	<ui:include src="/Painel/abasCustomizadas.xhtml" />
		    	</s:div>
		    </s:div>
		    
		</div>
		       
	    <rich:popupPanel id="novaCaixaPanel" height="150" left="40" onbeforeshow="infox.util.popupclear();" >
	      
	      <f:facet name="header">
	          <h:outputText value="#{infoxMessages['caixa.titleNovaCaixa']}" />
	      </f:facet>
	      
	      <f:facet name="controls">
	      	  <span onclick="#{rich:component('novaCaixaPanel')}.hide()">X</span>
	      </f:facet>
	      
	      <h:form id="modalForm">
	      
		      <wi:inputText
		          id="nomeCaixa"
		          label="#{infoxMessages['caixa.nomeCaixa']}"
		          required="true" />
		        
		      <a:commandButton
		          value="#{infoxMessages['crud.persist']}"
		          styleClass="buttons"
		          execute="@form"
		          limitRender="true"
		          actionListener="#{painelUsuarioController.adicionarCaixa}"
		          oncomplete="if(#{not facesContext.isValidationFailed()}){#{rich:component('novaCaixaPanel')}.hide()}"
		          render="divPainelProcessos, nomeCaixaDecoration, pageBodyDialogMessage">
		          <f:attribute name="inputNomeCaixa" value="#{rich:clientId('nomeCaixa')}" />
		      </a:commandButton>
	          
	      </h:form>
	      
	      <h:outputScript>
		      namespace("infox.util.popupclear",function onpopupshow() {
			      $("#modalForm .input.text.crud").val(null);
			      if ($("#modalForm .property-error.property-msg").length != 0) {
				    $("#modalForm span.property-error.property-msg").remove();
					$("#modalForm .property-error").each(function(){$(this).removeClass("property-error")});
				  }
		      });
	      </h:outputScript>
	      
	    </rich:popupPanel>
	</s:div>
	<ui:include src="/Painel/filtroPainelModal.xhtml"></ui:include>
  </ui:define>
</ui:composition>
