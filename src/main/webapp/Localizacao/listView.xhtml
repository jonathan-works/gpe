<?xml version="1.0" encoding="UTF-8"?>
<ui:composition
    xmlns:ui="http://java.sun.com/jsf/facelets"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:a="http://richfaces.org/a4j"
    xmlns:c="http://java.sun.com/jsp/jstl/core"
    xmlns:f="http://java.sun.com/jsf/core"
    xmlns:h="http://java.sun.com/jsf/html"
    xmlns:rich="http://richfaces.org/rich"
    xmlns:s="http://jboss.org/schema/seam/taglib"
    xmlns:infox="http://www.infox.com.br/jsf"
    xmlns:wi="http://www.itx.com.br/jsf"
    template="/WEB-INF/xhtml/templates/core/defaultTemplate.xhtml">
    <ui:define name="title">#{messages['localizacao.titlePage']}</ui:define>
    <ui:param
        name="home"
        value="#{localizacaoCrudAction}" />
    <ui:define name="searchGrid">
        <wi:dataTable
            values="#{localizacaoList.list(15)}"
            bean="#{localizacaoList}"
            tableTitle="#{messages['localizacao.tableTitle']}"
            id="localizacaoList"
            rowId="#{row.idLocalizacao}">
            <ui:define name="searchForm">
                <wi:searchForm
                    formId="pesquisarLocalizacaoForm"
                    formTitle="#{messages['searchForm.title']}">
                    <wi:inputText
                        id="codigoItem"
                        value="#{localizacaoList.entity.localizacao}"
                        label="#{messages['localizacao.localizacao']}" />
                    <wi:tree
                        id="localizacaoPai"
                        assignTo="localizacaoList.entity.localizacaoPai"
                        tree="#{localizacaoTree}"
                        icon="#{a4jSkin.imgFolder}/nivelTree.gif"
                        iconLeaf="#{a4jSkin.imgFolder}/file.gif"
                        label="#{messages['localizacao.localizacaoPai']}" />
                    <wi:selectBooleanMenu
                        id="estrutura"
                        label="#{messages['localizacao.estrutura']}"
                        value="#{localizacaoList.entity.estrutura}" />
                    <wi:selectSituacaoOneMenu
                        id="ativo"
                        label="#{messages['field.situacao']}"
                        value="#{localizacaoList.entity.ativo}" />
                </wi:searchForm>
            </ui:define>
            <wi:columnOutputTextIdent
                hideOrder="true"
                columnId="localizacao"
                columnHeader="#{messages['localizacao.localizacao']}"
                value="#{row.localizacao}"
                fullPath="#{row.caminhoCompleto}" />
            <wi:columnOutputText
                hideOrder="true"
                columnId="localizacaoPai"
                columnHeader="#{messages['localizacao.localizacaoPai']}"
                value="#{row.localizacaoPai}" />
            <wi:columnBoolean
                hideOrder="true"
                columnId="estrutura"
                columnHeader="#{messages['localizacao.estrutura']}"
                value="#{row.estrutura}" />
            <wi:columnSituacao
                hideOrder="true"
                columnId="ativo"
                columnHeader="#{messages['field.situacao']}"
                value="#{row.ativo}" />
        </wi:dataTable>
    </ui:define>
    <ui:define name="form">
        <ui:param
            name="isEditable"
            value="#{not authenticator.getLocalizacaoAtual().equals(localizacaoCrudAction.instance)}" />
        <wi:dataForm
            formId="localizacaoForm"
            formTitle="#{messages['form.title']}">
            <wi:inputText
                id="localizacao"
                required="true"
                label="#{messages['localizacao.localizacao']}"
                value="#{localizacaoCrudAction.instance.localizacao}"
                readonly="#{not isEditable}" />
            <wi:selectBooleanRadio
                id="estrutura"
                required="true"
                label="#{messages['localizacao.estrutura']}"
                value="#{localizacaoCrudAction.instance.estrutura}"
                disabled="#{not isEditable}">
                <a:ajax
                    event="change"
                    execute="@this"
                    render="notEstrutura"
                    limitRender="true" />
            </wi:selectBooleanRadio>
            <wi:outputText
                id="localizacaoPaiOut"
                value="#{localizacaoCrudAction.instance.localizacaoPai}"
                label="#{messages['localizacao.localizacaoPai']}"
                rendered="#{authenticator.getLocalizacaoAtual().equals(localizacaoCrudAction.instance)}" />
            <h:panelGroup id="notEstrutura">
                <wi:tree
                    id="localizacaoPai"
                    assignTo="localizacaoCrudAction.instance.localizacaoPai"
                    tree="#{localizacaoTree}"
                    icon="#{a4jSkin.imgFolder}/nivelTree.gif"
                    iconLeaf="#{a4jSkin.imgFolder}/file.gif"
                    required="true"
                    rendered="#{isEditable and not localizacaoCrudAction.instance.estrutura}"
                    label="#{messages['localizacao.localizacaoPai']}" />
                <wi:selectOneMenuEntity
                    id="estruturaFilho"
                    value="#{localizacaoCrudAction.instance.estruturaFilho}"
                    label="#{messages['localizacao.estruturaFilho']}"
                    items="#{localizacaoCrudAction.getLocalizacoesEstrutura()}"
                    rendered="#{not localizacaoCrudAction.instance.estrutura}"
                    readonly="#{not isEditable}"
                    showLabelSelecione="true" />
            </h:panelGroup>
            <wi:selectSituacaoRadio
                id="ativo"
                label="#{messages['field.situacao']}"
                required="true"
                value="#{localizacaoCrudAction.instance.ativo}"
                disabled="#{not isEditable}" />
            <ui:define name="buttons">
                <s:fragment rendered="#{isEditable}">
                    <wi:commandButtonSave />
                    <wi:commandButtonNew />
                </s:fragment>
            </ui:define>
        </wi:dataForm>
    </ui:define>
    <ui:define name="tabs">
        <infox:tab
            status=":status"
            id="localizacaoTurnoTab"
            action="#{localizacaoTurnoAction.newInstance(localizacaoCrudAction.instance)}"
            rendered="#{home.managed and !home.instance.estrutura}"
            title="#{messages['localizacao.localizacaoTurno']}"
            name="localizacaoTurnoTab">
            <h:form>
                <wi:turnoCalendar
                    handler="#{localizacaoTurnoAction.turnoHandler}" />
                <a:commandButton
                    action="#{localizacaoTurnoAction.gravarTurnos()}"
                    render="pageBodyDialogMessage"
                    limitRender="true"
                    execute="@form"
                    value="#{messages['crud.update']}" />
            </h:form>
        </infox:tab>
    </ui:define>
</ui:composition>
